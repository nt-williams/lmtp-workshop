<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Defining General, Hypothetical Interventions â€“ Beyond the Average Treatment Effect</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-79108a0fc1995748cbd19a5b0e3e3e7c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/editor/editor.main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
<style type="text/css">
.monaco-editor pre {
  background-color: unset !important;
}

.qwebr-editor-toolbar {
  width: 100%;
  display: flex;
  justify-content: space-between;
  box-sizing: border-box;
}

.qwebr-editor-toolbar-left-buttons, .qwebr-editor-toolbar-right-buttons {
  display: flex;
}

.qwebr-non-interactive-loading-container.qwebr-cell-needs-evaluation, .qwebr-non-interactive-loading-container.qwebr-cell-evaluated {
  justify-content: center;
  display: flex;
  background-color: rgba(250, 250, 250, 0.65);
  border: 1px solid rgba(233, 236, 239, 0.65);
  border-radius: 0.5rem;
  margin-top: 15px;
  margin-bottom: 15px;
}

.qwebr-r-project-logo {
  color: #2767B0; /* R Project's blue color */
}

.qwebr-icon-status-spinner {
  color: #7894c4;
}

.qwebr-icon-run-code {
  color: #0d9c29
}

body.quarto-light .qwebr-output-code-stdout {
  color: #111;
}

body.quarto-dark .qwebr-output-code-stdout {
  color: #EEE;
}

.qwebr-output-code-stderr {
  color: #db4133;
}

body.quarto-light .qwebr-editor {
  border: 1px solid #EEEEEE;
}

body.quarto-light .qwebr-editor-toolbar {
  background-color: #EEEEEE;
  padding: 0.2rem 0.5rem;
}

body.quarto-dark .qwebr-editor {
  border: 1px solid #111;
}

body.quarto-dark .qwebr-editor-toolbar {
  background-color: #111;
  padding: 0.2rem 0.5rem;
}

.qwebr-button {
  display: inline-block;
  font-weight: 400;
  line-height: 1;
  text-decoration: none;
  text-align: center;
  padding: 0.375rem 0.75rem;
  font-size: .9rem;
  border-radius: 0.25rem;
  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
}

body.quarto-light .qwebr-button {
  background-color: #EEEEEE;
  color: #000;
  border-color: #dee2e6;
  border: 1px solid rgba(0,0,0,0);
}

body.quarto-dark .qwebr-button {
  background-color: #111;
  color: #EEE;
  border-color: #dee2e6;
  border: 1px solid rgba(0,0,0,0);
}

body.quarto-light .qwebr-button:hover {
  color: #000;
  background-color: #d9dce0;
  border-color: #c8ccd0;
}

body.quarto-dark .qwebr-button:hover {
  color: #d9dce0;
  background-color: #323232;
  border-color: #d9dce0;
}

.qwebr-button:disabled,.qwebr-button.disabled,fieldset:disabled .qwebr-button {
  pointer-events: none;
  opacity: .65
}

.qwebr-button-reset {
  color: #696969; /*#4682b4;*/
}

.qwebr-button-copy {
  color: #696969;
}

/* Style the code highlight lines */
body.quarto-light .qwebr-editor-highlight-line {
  background-color: lightblue;
}

body.quarto-dark .qwebr-editor-highlight-line {
  background-color: darkblue;
}

/* Style the modal pop-up */

/* The Modal (background) */
.qwebr-modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  padding-top: 60px;
}

/* Modal Content */
.qwebr-modal-content {
  background-color: #fefefe;
  margin: 5% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 80%; /* Could be more or less, depending on screen size */
}

.qwebr-modal-content-code {
  max-height: 50vh;
  min-height: 5vh;
  overflow: scroll;
  border: 1px solid #888;
}

/* The Close Button */
.qwebr-modal-close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.qwebr-modal-close:hover,
.qwebr-modal-close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.qwebr-download-btn {
  margin-top: 10px;
  text-decoration: none !important;
}

/* Styling to download image that is created */

.qwebr-canvas-image {
  position: relative;
  display: inline-block;
  margin: 10px;
}

.qwebr-canvas-image-download-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 5px 10px;
  background-color: #007BFF;
  color: white;
  border: none;
  cursor: pointer;
  display: none;
}

figure:hover .qwebr-canvas-image-download-btn {
  display: block;
}

/* Custom styling for RevealJS Presentations*/

/* Reset the style of the interactive area */
.reveal div.qwebr-interactive-area {
  display: block;
  box-shadow: none;
  max-width: 100%;
  max-height: 100%;
  margin: 0;
  padding: 0;
}

/* Provide space to entries */
.reveal div.qwebr-output-code-area pre div {
  margin: 1px 2px 1px 10px;
}

/* Collapse the inside code tags to avoid extra space between line outputs */
.reveal pre div code.qwebr-output-code-stdout, .reveal pre div code.qwebr-output-code-stderr {
  padding: 0;
  display: contents;
}

body.reveal.quarto-light pre div code.qwebr-output-code-stdout {
  color: #111;
}

body.reveal.quarto-dark pre div code.qwebr-output-code-stdout {
  color: #EEEEEE;
}

.reveal pre div code.qwebr-output-code-stderr {
  color: #db4133;
}


/* Create a border around console and output (does not effect graphs) */
body.reveal.quarto-light div.qwebr-console-area {
  border: 1px solid #EEEEEE;
  box-shadow: 2px 2px 10px #EEEEEE;
}

body.reveal.quarto-dark div.qwebr-console-area {
  border: 1px solid #111;
  box-shadow: 2px 2px 10px #111;
}


/* Cap output height and allow text to scroll */
/* TODO: Is there a better way to fit contents/max it parallel to the monaco editor size? */
.reveal div.qwebr-output-code-area pre {
  max-height: 400px;
  overflow: scroll;
}

iframe.qwebr-output-code-browse {
  width: 100%;

  /*
    TODO: How to make the height automatic according to the widget size,
    or respect the quarto code block options?
  */
  min-height: 500px;
}

</style>
<script type="module">
// Document level settings ----

// Determine if we need to install R packages
globalThis.qwebrInstallRPackagesList = ['lmtp', 'dplyr'];

// Specify possible locations to search for the repository
globalThis.qwebrPackageRepoURLS = ['https://repo.r-wasm.org/'];

// Check to see if we have an empty array, if we do set to skip the installation.
globalThis.qwebrSetupRPackages = !(qwebrInstallRPackagesList.indexOf("") !== -1);
globalThis.qwebrAutoloadRPackages = true;

// Display a startup message?
globalThis.qwebrShowStartupMessage = true;
globalThis.qwebrShowHeaderMessage = false;

// Describe the webR settings that should be used
globalThis.qwebrCustomizedWebROptions = {
  "baseURL": "https://webr.r-wasm.org/v0.4.0/",
  "serviceWorkerUrl": "",
  "homedir": "/home/web_user", 
  "channelType": "ChannelType.Automatic"
};

// Store cell data
globalThis.qwebrCellDetails = [{"code":"set.seed(786543)\nn <- 1000\nl0 <- rnorm(n)\na1 <- rbinom(n, 1, plogis(-1 + l0*1.5))\nl1 <- rnorm(n)\na2 <- rbinom(n, 1, plogis(-1 + l1*1.5 + a1*2))\ny <- rnorm(n, -1 - 1.2*l0 + 2.4*a1 - 2*l1 + 1.2*a2)\nfoo <- data.frame(\n  L1 = l0, \n  A1 = a1, \n  L2 = l1, \n  A2 = a2, \n  Y = y\n)","id":1,"options":{"autorun":"true","classes":"","comment":"","context":"setup","dpi":72,"editor-font-scale":"1","editor-max-height":"","editor-quick-suggestions":"false","editor-word-wrap":"true","fig-cap":"","fig-height":5,"fig-width":7,"label":"unnamed-chunk-1","message":"true","out-height":"","out-width":"700px","output":"true","read-only":"false","results":"markup","warning":"true"}},{"code":"d <- function(a) {\n  epsilon <- runif(length(a))\n  ifelse(epsilon < 0.5 & a == 1, 0, a)\n}","id":2,"options":{"autorun":"false","classes":"","comment":"","context":"interactive","dpi":72,"editor-font-scale":"1","editor-max-height":"","editor-quick-suggestions":"false","editor-word-wrap":"true","fig-cap":"","fig-height":5,"fig-width":7,"label":"unnamed-chunk-2","message":"true","out-height":"","out-width":"700px","output":"true","read-only":"false","results":"markup","warning":"true"}},{"code":"m3_d <- foo$Y","id":3,"options":{"autorun":"false","classes":"","comment":"","context":"interactive","dpi":72,"editor-font-scale":"1","editor-max-height":"","editor-quick-suggestions":"false","editor-word-wrap":"true","fig-cap":"","fig-height":5,"fig-width":7,"label":"unnamed-chunk-3","message":"true","out-height":"","out-width":"700px","output":"true","read-only":"false","results":"markup","warning":"true"}},{"code":"m2 <- glm(m3_d ~ L1 + A1 + L2 + A2, data = foo)","id":4,"options":{"autorun":"false","classes":"","comment":"","context":"interactive","dpi":72,"editor-font-scale":"1","editor-max-height":"","editor-quick-suggestions":"false","editor-word-wrap":"true","fig-cap":"","fig-height":5,"fig-width":7,"label":"unnamed-chunk-4","message":"true","out-height":"","out-width":"700px","output":"true","read-only":"false","results":"markup","warning":"true"}},{"code":"m2_d <- predict(m2, mutate(foo, A2 = d(A2)))","id":5,"options":{"autorun":"false","classes":"","comment":"","context":"interactive","dpi":72,"editor-font-scale":"1","editor-max-height":"","editor-quick-suggestions":"false","editor-word-wrap":"true","fig-cap":"","fig-height":5,"fig-width":7,"label":"unnamed-chunk-5","message":"true","out-height":"","out-width":"700px","output":"true","read-only":"false","results":"markup","warning":"true"}},{"code":"m1 <- glm(m2_d ~ L1 + A1, data = mutate(foo, m2_d = m2_d))","id":6,"options":{"autorun":"false","classes":"","comment":"","context":"interactive","dpi":72,"editor-font-scale":"1","editor-max-height":"","editor-quick-suggestions":"false","editor-word-wrap":"true","fig-cap":"","fig-height":5,"fig-width":7,"label":"unnamed-chunk-6","message":"true","out-height":"","out-width":"700px","output":"true","read-only":"false","results":"markup","warning":"true"}},{"code":"m1_d <- predict(m1, mutate(foo, A1 = d(A1)))","id":7,"options":{"autorun":"false","classes":"","comment":"","context":"interactive","dpi":72,"editor-font-scale":"1","editor-max-height":"","editor-quick-suggestions":"false","editor-word-wrap":"true","fig-cap":"","fig-height":5,"fig-width":7,"label":"unnamed-chunk-7","message":"true","out-height":"","out-width":"700px","output":"true","read-only":"false","results":"markup","warning":"true"}},{"code":"mean(m1_d)","id":8,"options":{"autorun":"false","classes":"","comment":"","context":"interactive","dpi":72,"editor-font-scale":"1","editor-max-height":"","editor-quick-suggestions":"false","editor-word-wrap":"true","fig-cap":"","fig-height":5,"fig-width":7,"label":"unnamed-chunk-8","message":"true","out-height":"","out-width":"700px","output":"true","read-only":"false","results":"markup","warning":"true"}}];

</script>
<script type="module">
// Declare startupMessageQWebR globally
globalThis.qwebrStartupMessage = document.createElement("p");

// Verify if OffScreenCanvas is supported
globalThis.qwebrOffScreenCanvasSupport = function() {
  return typeof OffscreenCanvas !== 'undefined'
}

// Function to set the button text
globalThis.qwebrSetInteractiveButtonState = function(buttonText, enableCodeButton = true) {
  document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
    btn.innerHTML = buttonText;
    btn.disabled = !enableCodeButton;
  });
}

// Function to update the status message in non-interactive cells
globalThis.qwebrUpdateStatusMessage = function(message) {
  document.querySelectorAll(".qwebr-status-text.qwebr-cell-needs-evaluation").forEach((elem) => {
    elem.innerText = message;
  });
}

// Function to update the status message
globalThis.qwebrUpdateStatusHeader = function(message) {
  qwebrStartupMessage.innerHTML = `
    <i class="fa-solid fa-spinner fa-spin qwebr-icon-status-spinner"></i>
    <span>${message}</span>`;
}

// Function to return true if element is found, false if not
globalThis.qwebrCheckHTMLElementExists = function(selector) {
  const element = document.querySelector(selector);
  return !!element;
}

// Function that detects whether reveal.js slides are present
globalThis.qwebrIsRevealJS = function() {
  // If the '.reveal .slides' selector exists, RevealJS is likely present
  return qwebrCheckHTMLElementExists('.reveal .slides');
}

// Initialize the Quarto sidebar element
function qwebrSetupQuartoSidebar() {
  var newSideBarDiv = document.createElement('div');
  newSideBarDiv.id = 'quarto-margin-sidebar';
  newSideBarDiv.className = 'sidebar margin-sidebar';
  newSideBarDiv.style.top = '0px';
  newSideBarDiv.style.maxHeight = 'calc(0px + 100vh)';

  return newSideBarDiv;
}

// Position the sidebar in the document
function qwebrPlaceQuartoSidebar() {
  // Get the reference to the element with id 'quarto-document-content'
  var referenceNode = document.getElementById('quarto-document-content');

  // Create the new div element
  var newSideBarDiv = qwebrSetupQuartoSidebar();

  // Insert the new div before the 'quarto-document-content' element
  referenceNode.parentNode.insertBefore(newSideBarDiv, referenceNode);
}

function qwebrPlaceMessageContents(content, html_location = "title-block-header", revealjs_location = "title-slide") {

  // Get references to header elements
  const headerHTML = document.getElementById(html_location);
  const headerRevealJS = document.getElementById(revealjs_location);

  // Determine where to insert the quartoTitleMeta element
  if (headerHTML || headerRevealJS) {
    // Append to the existing "title-block-header" element or "title-slide" div
    (headerHTML || headerRevealJS).appendChild(content);
  } else {
    // If neither headerHTML nor headerRevealJS is found, insert after "webr-monaco-editor-init" script
    const monacoScript = document.getElementById("qwebr-monaco-editor-init");
    const header = document.createElement("header");
    header.setAttribute("id", "title-block-header");
    header.appendChild(content);
    monacoScript.after(header);
  }
}



function qwebrOffScreenCanvasSupportWarningMessage() {
  
  // Verify canvas is supported.
  if(qwebrOffScreenCanvasSupport()) return;

  // Create the main container div
  var calloutContainer = document.createElement('div');
  calloutContainer.classList.add('callout', 'callout-style-default', 'callout-warning', 'callout-titled');

  // Create the header div
  var headerDiv = document.createElement('div');
  headerDiv.classList.add('callout-header', 'd-flex', 'align-content-center');

  // Create the icon container div
  var iconContainer = document.createElement('div');
  iconContainer.classList.add('callout-icon-container');

  // Create the icon element
  var iconElement = document.createElement('i');
  iconElement.classList.add('callout-icon');

  // Append the icon element to the icon container
  iconContainer.appendChild(iconElement);

  // Create the title container div
  var titleContainer = document.createElement('div');
  titleContainer.classList.add('callout-title-container', 'flex-fill');
  titleContainer.innerText = 'Warning: Web Browser Does Not Support Graphing!';

  // Append the icon container and title container to the header div
  headerDiv.appendChild(iconContainer);
  headerDiv.appendChild(titleContainer);

  // Create the body container div
  var bodyContainer = document.createElement('div');
  bodyContainer.classList.add('callout-body-container', 'callout-body');

  // Create the paragraph element for the body content
  var paragraphElement = document.createElement('p');
  paragraphElement.innerHTML = 'This web browser does not have support for displaying graphs through the <code>quarto-webr</code> extension since it lacks an <code>OffScreenCanvas</code>. Please upgrade your web browser to one that supports <code>OffScreenCanvas</code>.';

  // Append the paragraph element to the body container
  bodyContainer.appendChild(paragraphElement);

  // Append the header div and body container to the main container div
  calloutContainer.appendChild(headerDiv);
  calloutContainer.appendChild(bodyContainer);

  // Append the main container div to the document depending on format
  qwebrPlaceMessageContents(calloutContainer, "title-block-header"); 

}


// Function that attaches the document status message and diagnostics
function displayStartupMessage(showStartupMessage, showHeaderMessage) {
  if (!showStartupMessage) {
    return;
  }

  // Create the outermost div element for metadata
  const quartoTitleMeta = document.createElement("div");
  quartoTitleMeta.classList.add("quarto-title-meta");

  // Create the first inner div element
  const firstInnerDiv = document.createElement("div");
  firstInnerDiv.setAttribute("id", "qwebr-status-message-area");

  // Create the second inner div element for "WebR Status" heading and contents
  const secondInnerDiv = document.createElement("div");
  secondInnerDiv.setAttribute("id", "qwebr-status-message-title");
  secondInnerDiv.classList.add("quarto-title-meta-heading");
  secondInnerDiv.innerText = "WebR Status";

  // Create another inner div for contents
  const secondInnerDivContents = document.createElement("div");
  secondInnerDivContents.setAttribute("id", "qwebr-status-message-body");
  secondInnerDivContents.classList.add("quarto-title-meta-contents");

  // Describe the WebR state
  qwebrStartupMessage.innerText = "ðŸŸ¡ Loading...";
  qwebrStartupMessage.setAttribute("id", "qwebr-status-message-text");
  // Add `aria-live` to auto-announce the startup status to screen readers
  qwebrStartupMessage.setAttribute("aria-live", "assertive");

  // Append the startup message to the contents
  secondInnerDivContents.appendChild(qwebrStartupMessage);

  // Add a status indicator for COOP and COEP Headers if needed
  if (showHeaderMessage) {
    const crossOriginMessage = document.createElement("p");
    crossOriginMessage.innerText = `${crossOriginIsolated ? 'ðŸŸ¢' : 'ðŸŸ¡'} COOP & COEP Headers`;
    crossOriginMessage.setAttribute("id", "qwebr-coop-coep-header");
    secondInnerDivContents.appendChild(crossOriginMessage);
  }

  // Combine the inner divs and contents
  firstInnerDiv.appendChild(secondInnerDiv);
  firstInnerDiv.appendChild(secondInnerDivContents);
  quartoTitleMeta.appendChild(firstInnerDiv);

  // Place message on webpage
  qwebrPlaceMessageContents(quartoTitleMeta); 
}

function qwebrAddCommandHistoryModal() {
  // Create the modal div
  var modalDiv = document.createElement('div');
  modalDiv.id = 'qwebr-history-modal';
  modalDiv.className = 'qwebr-modal';

  // Create the modal content div
  var modalContentDiv = document.createElement('div');
  modalContentDiv.className = 'qwebr-modal-content';

  // Create the span for closing the modal
  var closeSpan = document.createElement('span');
  closeSpan.id = 'qwebr-command-history-close-btn';
  closeSpan.className = 'qwebr-modal-close';
  closeSpan.innerHTML = '&times;';

  // Create the h1 element for the modal
  var modalH1 = document.createElement('h1');
  modalH1.textContent = 'R History Command Contents';

  // Create an anchor element for downloading the Rhistory file 
  var downloadLink = document.createElement('a');
  downloadLink.href = '#';
  downloadLink.id = 'qwebr-download-history-btn';
  downloadLink.className = 'qwebr-download-btn';

  // Create an 'i' element for the icon
  var icon = document.createElement('i');
  icon.className = 'bi bi-file-code';

  // Append the icon to the anchor element
  downloadLink.appendChild(icon);

  // Add the text 'Download R History' to the anchor element
  downloadLink.appendChild(document.createTextNode(' Download R History File'));

  // Create the pre for command history contents
  var commandContentsPre = document.createElement('pre');
  commandContentsPre.id = 'qwebr-command-history-contents';
  commandContentsPre.className = 'qwebr-modal-content-code';

  // Append the close span, h1, and history contents pre to the modal content div
  modalContentDiv.appendChild(closeSpan);
  modalContentDiv.appendChild(modalH1);
  modalContentDiv.appendChild(downloadLink);
  modalContentDiv.appendChild(commandContentsPre);

  // Append the modal content div to the modal div
  modalDiv.appendChild(modalContentDiv);

  // Append the modal div to the body
  document.body.appendChild(modalDiv);
}

function qwebrRegisterRevealJSCommandHistoryModal() {
  // Select the <ul> element inside the <div> with data-panel="Custom0"
  let ulElement = document.querySelector('div[data-panel="Custom0"] > ul.slide-menu-items');

  // Find the last <li> element with class slide-tool-item
  let lastItem = ulElement.querySelector('li.slide-tool-item:last-child');

  // Calculate the next data-item value
  let nextItemValue = 0;
  if (lastItem) {
      nextItemValue = parseInt(lastItem.dataset.item) + 1;
  }

  // Create a new <li> element
  let newListItem = document.createElement('li');
  newListItem.className = 'slide-tool-item';
  newListItem.dataset.item = nextItemValue.toString(); // Set the next available data-item value

  // Create the <a> element inside the <li>
  let newLink = document.createElement('a');
  newLink.href = '#';
  newLink.id = 'qwebrRHistoryButton'; // Set the ID for the new link
  
  // Create the <kbd> element inside the <a>
  let newKbd = document.createElement('kbd');
  newKbd.textContent = ' '; // Set to empty as we are not registering a keyboard shortcut

  // Create text node for the link text
  let newText = document.createTextNode(' View R History');

  // Append <kbd> and text node to <a>
  newLink.appendChild(newKbd);
  newLink.appendChild(newText);

  // Append <a> to <li>
  newListItem.appendChild(newLink);

  // Append <li> to <ul>
  ulElement.appendChild(newListItem);
}

// Handle setting up the R history modal
function qwebrCodeLinks() {

  if (qwebrIsRevealJS()) {
    qwebrRegisterRevealJSCommandHistoryModal();
    return;
  }

  // Create the container div
  var containerDiv = document.createElement('div');
  containerDiv.className = 'quarto-code-links';

  // Create the h2 element
  var h2 = document.createElement('h2');
  h2.textContent = 'webR Code Links';

  // Create the ul element
  var ul = document.createElement('ul');

  // Create the li element
  var li = document.createElement('li');

  // Create the a_history_btn element
  var a_history_btn = document.createElement('a');
  a_history_btn.href = 'javascript:void(0)';
  a_history_btn.setAttribute('id', 'qwebrRHistoryButton');

  // Create the i_history_btn element
  var i_history_btn = document.createElement('i');
  i_history_btn.className = 'bi bi-file-code';

  // Create the text node for the link text
  var text_history_btn = document.createTextNode('View R History');

  // Append the icon element and link text to the a element
  a_history_btn.appendChild(i_history_btn);
  a_history_btn.appendChild(text_history_btn);

  // Append the a element to the li element
  li.appendChild(a_history_btn);

  // Append the li element to the ul element
  ul.appendChild(li);

  // Append the h2 and ul elements to the container div
  containerDiv.appendChild(h2);
  containerDiv.appendChild(ul);

  // Append the container div to the element with the ID 'quarto-margin-sidebar'
  var sidebar = document.getElementById('quarto-margin-sidebar');
    
  // If the sidebar element is not found, create it
  if(!sidebar) {
    qwebrPlaceQuartoSidebar();
  }
  
  // Re-select the sidebar element (if it was just created)
  sidebar = document.getElementById('quarto-margin-sidebar');   


  // If the sidebar element exists, append the container div to it
  if(sidebar) {
    // Append the container div to the sidebar
    sidebar.appendChild(containerDiv);
    // Force the sidebar to be clickable by removing the 'zindex-bottom' class
    // added in pre-release: https://github.com/quarto-dev/quarto-cli/commit/f0c53a1ffcaa1de4eccbf07803b096898248adcc
    sidebar.className = 'sidebar margin-sidebar';
  } else {
    // Get a debugger ...
    console.warn('Element with ID "quarto-margin-sidebar" not found.');
  }
}

// Call the function to append the code links for qwebR into the right sidebar
qwebrCodeLinks();

// Add the command history modal
qwebrAddCommandHistoryModal();

displayStartupMessage(qwebrShowStartupMessage, qwebrShowHeaderMessage);
qwebrOffScreenCanvasSupportWarningMessage();
</script>
<script type="module">
// Define a global storage and retrieval solution ----

// Store commands executed in R
globalThis.qwebrRCommandHistory = [];

// Function to retrieve the command history
globalThis.qwebrFormatRHistory = function() {
   return qwebrRCommandHistory.join("\n\n");
}

// Retrieve HTML Elements ----

// Get the command modal
const command_history_modal = document.getElementById("qwebr-history-modal");

// Get the button that opens the command modal
const command_history_btn = document.getElementById("qwebrRHistoryButton");

// Get the <span> element that closes the command modal
const command_history_close_span = document.getElementById("qwebr-command-history-close-btn");

// Get the download button for r history information
const command_history_download_btn = document.getElementById("qwebr-download-history-btn");

// Plug in command history into modal/download button ----

// Function to populate the modal with command history
function populateCommandHistoryModal() {
    document.getElementById("qwebr-command-history-contents").innerHTML = qwebrFormatRHistory() || "No commands have been executed yet.";
}

// Function to format the current date and time to
// a string with the format YYYY-MM-DD-HH-MM-SS
function formatDateTime() {
    const now = new Date();

    const year = now.getFullYear();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are zero-based
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');

    return `${year}-${month}-${day}-${hours}-${minutes}-${seconds}`;
}


// Function to convert document title with datetime to a safe filename
function safeFileName() {
    // Get the current page title
    let pageTitle = document.title;

    // Combine the current page title with the current date and time
    let pageNameWithDateTime = `Rhistory-${pageTitle}-${formatDateTime()}`;

    // Replace unsafe characters with safe alternatives
    let safeFilename = pageNameWithDateTime.replace(/[\\/:\*\?! "<>\|]/g, '-');

    return safeFilename;
}


// Function to download list contents as text file
function downloadRHistory() {
    // Get the current page title + datetime and use it as the filename
    const filename = `${safeFileName()}.R`;

    // Get the text contents of the R History list
    const text = qwebrFormatRHistory();

    // Create a new Blob object with the text contents
    const blob = new Blob([text], { type: 'text/plain' });
  
    // Create a new anchor element for the download
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = URL.createObjectURL(blob);
    a.download = filename;

    // Append the anchor to the body, click it, and remove it
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

// Register event handlers ----

// When the user clicks the View R History button, open the command modal
command_history_btn.onclick = function() {
    populateCommandHistoryModal();
    command_history_modal.style.display = "block";
}

// When the user clicks on <span> (x), close the command modal
command_history_close_span.onclick = function() {
    command_history_modal.style.display = "none";
}

// When the user clicks anywhere outside of the command modal, close it
window.onclick = function(event) {
    if (event.target == command_history_modal) {
        command_history_modal.style.display = "none";
    }
}

// Add an onclick event listener to the download button so that
// the user can download the R history as a text file
command_history_download_btn.onclick = function() {
    downloadRHistory();
};
</script>
<script type="module">
// Supported Evaluation Types for Context
globalThis.EvalTypes = Object.freeze({
  Interactive: 'interactive',
  Setup: 'setup',
  Output: 'output',
});

// Function that obtains the font size for a given element 
globalThis.qwebrCurrentFontSizeOnElement = function(element, cssProperty = 'font-size') {

  const currentFontSize = parseFloat(
    window
    .getComputedStyle(element)
    .getPropertyValue(cssProperty)
  );
  
  return currentFontSize;
}

// Function to determine font scaling
globalThis.qwebrScaledFontSize = function(div, qwebrOptions) {
  // Determine if we should compute font-size using RevealJS's `--r-main-font-size` 
  // or if we can directly use the document's `font-size`.
  const cssProperty = document.body.classList.contains('reveal') ? 
    "--r-main-font-size" : "font-size";
  
  // Get the current font size on the div element
  const elementFontSize = qwebrCurrentFontSizeOnElement(div, cssProperty);

  // Determine the scaled font size value
  const scaledFontSize = ((qwebrOptions['editor-font-scale'] ?? 1) * elementFontSize) ?? 17.5;

  return scaledFontSize;
}


// Function that dispatches the creation request
globalThis.qwebrCreateHTMLElement = function (
  cellData
) {

  // Extract key components
  const evalType = cellData.options.context;
  const qwebrCounter = cellData.id;

  // We make an assumption that insertion points are defined by the Lua filter as:
  // qwebr-insertion-location-{qwebrCounter} 
  const elementLocator = document.getElementById(`qwebr-insertion-location-${qwebrCounter}`);

  // Figure out the routine to use to insert the element.
  let qwebrElement;
  switch ( evalType ) {
    case EvalTypes.Interactive:
      qwebrElement = qwebrCreateInteractiveElement(qwebrCounter, cellData.options);
      break;
    case EvalTypes.Output: 
      qwebrElement = qwebrCreateNonInteractiveOutputElement(qwebrCounter, cellData.options);
      break;
    case EvalTypes.Setup: 
      qwebrElement = qwebrCreateNonInteractiveSetupElement(qwebrCounter, cellData.options);
      break;
    default: 
      qwebrElement = document.createElement('div');
      qwebrElement.textContent = 'Error creating `quarto-webr` element';
  }

  // Insert the dynamically generated object at the document location.
  elementLocator.appendChild(qwebrElement);
};

// Function that setups the interactive element creation
globalThis.qwebrCreateInteractiveElement = function (qwebrCounter, qwebrOptions) {

  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = 'qwebr-interactive-area-' + qwebrCounter;
  mainDiv.className = `qwebr-interactive-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }

  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }

  // Create toolbar div
  var toolbarDiv = document.createElement('div');
  toolbarDiv.className = 'qwebr-editor-toolbar';
  toolbarDiv.id = 'qwebr-editor-toolbar-' + qwebrCounter;

  // Create a div to hold the left buttons
  var leftButtonsDiv = document.createElement('div');
  leftButtonsDiv.className = 'qwebr-editor-toolbar-left-buttons';

  // Create a div to hold the right buttons
  var rightButtonsDiv = document.createElement('div');
  rightButtonsDiv.className = 'qwebr-editor-toolbar-right-buttons';

  // Create Run Code button
  var runCodeButton = document.createElement('button');
  runCodeButton.className = 'btn btn-default qwebr-button qwebr-button-run';
  runCodeButton.disabled = true;
  runCodeButton.type = 'button';
  runCodeButton.id = 'qwebr-button-run-' + qwebrCounter;
  runCodeButton.textContent = 'ðŸŸ¡ Loading webR...';
  runCodeButton.title = `Run code (Shift + Enter)`;

  // Append buttons to the leftButtonsDiv
  leftButtonsDiv.appendChild(runCodeButton);

  // Create Reset button
  var resetButton = document.createElement('button');
  resetButton.className = 'btn btn-light btn-xs qwebr-button qwebr-button-reset';
  resetButton.type = 'button';
  resetButton.id = 'qwebr-button-reset-' + qwebrCounter;
  resetButton.title = 'Start over';
  resetButton.innerHTML = '<i class="fa-solid fa-arrows-rotate"></i>';

  // Create Copy button
  var copyButton = document.createElement('button');
  copyButton.className = 'btn btn-light btn-xs qwebr-button qwebr-button-copy';
  copyButton.type = 'button';
  copyButton.id = 'qwebr-button-copy-' + qwebrCounter;
  copyButton.title = 'Copy code';
  copyButton.innerHTML = '<i class="fa-regular fa-copy"></i>';

  // Append buttons to the rightButtonsDiv
  rightButtonsDiv.appendChild(resetButton);
  rightButtonsDiv.appendChild(copyButton);

  // Create console area div
  var consoleAreaDiv = document.createElement('div');
  consoleAreaDiv.id = 'qwebr-console-area-' + qwebrCounter;
  consoleAreaDiv.className = 'qwebr-console-area';

  // Create editor div
  var editorDiv = document.createElement('div');
  editorDiv.id = 'qwebr-editor-' + qwebrCounter;
  editorDiv.className = 'qwebr-editor';

  // Create output code area div
  var outputCodeAreaDiv = document.createElement('div');
  outputCodeAreaDiv.id = 'qwebr-output-code-area-' + qwebrCounter;
  outputCodeAreaDiv.className = 'qwebr-output-code-area';
  outputCodeAreaDiv.setAttribute('aria-live', 'assertive');

  // Create pre element inside output code area
  var preElement = document.createElement('pre');
  preElement.style.visibility = 'hidden';
  outputCodeAreaDiv.appendChild(preElement);

  // Create output graph area div
  var outputGraphAreaDiv = document.createElement('div');
  outputGraphAreaDiv.id = 'qwebr-output-graph-area-' + qwebrCounter;
  outputGraphAreaDiv.className = 'qwebr-output-graph-area';

  // Append buttons to the toolbar
  toolbarDiv.appendChild(leftButtonsDiv);
  toolbarDiv.appendChild(rightButtonsDiv);

  // Append all elements to the main div
  mainDiv.appendChild(toolbarDiv);
  consoleAreaDiv.appendChild(editorDiv);
  consoleAreaDiv.appendChild(outputCodeAreaDiv);
  mainDiv.appendChild(consoleAreaDiv);
  mainDiv.appendChild(outputGraphAreaDiv);

  return mainDiv;
}

// Function that adds output structure for non-interactive output
globalThis.qwebrCreateNonInteractiveOutputElement = function(qwebrCounter, qwebrOptions) {
  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = 'qwebr-noninteractive-area-' + qwebrCounter;
  mainDiv.className = `qwebr-noninteractive-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }
  
  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }
  
  // Create a status container div
  var statusContainer = createLoadingContainer(qwebrCounter);

  // Create output code area div
  var outputCodeAreaDiv = document.createElement('div');
  outputCodeAreaDiv.id = 'qwebr-output-code-area-' + qwebrCounter;
  outputCodeAreaDiv.className = 'qwebr-output-code-area';
  outputCodeAreaDiv.setAttribute('aria-live', 'assertive');

  // Create pre element inside output code area
  var preElement = document.createElement('pre');
  preElement.style.visibility = 'hidden';
  outputCodeAreaDiv.appendChild(preElement);

  // Create output graph area div
  var outputGraphAreaDiv = document.createElement('div');
  outputGraphAreaDiv.id = 'qwebr-output-graph-area-' + qwebrCounter;
  outputGraphAreaDiv.className = 'qwebr-output-graph-area';

  // Append all elements to the main div
  mainDiv.appendChild(statusContainer);
  mainDiv.appendChild(outputCodeAreaDiv);
  mainDiv.appendChild(outputGraphAreaDiv);

  return mainDiv;
};

// Function that adds a stub in the page to indicate a setup cell was used.
globalThis.qwebrCreateNonInteractiveSetupElement = function(qwebrCounter, qwebrOptions) {
  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = `qwebr-noninteractive-setup-area-${qwebrCounter}`;
  mainDiv.className = `qwebr-noninteractive-setup-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }


  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }

  // Create a status container div
  var statusContainer = createLoadingContainer(qwebrCounter);

  // Append status onto the main div
  mainDiv.appendChild(statusContainer);

  return mainDiv;
}


// Function to create loading container with specified ID
globalThis.createLoadingContainer = function(qwebrCounter) {

  // Create a status container
  const container = document.createElement('div');
  container.id = `qwebr-non-interactive-loading-container-${qwebrCounter}`;
  container.className = 'qwebr-non-interactive-loading-container qwebr-cell-needs-evaluation';

  // Create an R project logo to indicate its a code space
  const rProjectIcon = document.createElement('i');
  rProjectIcon.className = 'fa-brands fa-r-project fa-3x qwebr-r-project-logo';

  // Setup a loading icon from font awesome
  const spinnerIcon = document.createElement('i');
  spinnerIcon.className = 'fa-solid fa-spinner fa-spin fa-1x qwebr-icon-status-spinner';

  // Add a section for status text
  const statusText = document.createElement('p');
  statusText.id = `qwebr-status-text-${qwebrCounter}`;
  statusText.className = `qwebr-status-text qwebr-cell-needs-evaluation`;
  statusText.innerText = 'Loading webR...';

  // Incorporate an inner container
  const innerContainer = document.createElement('div');

  // Append elements to the inner container
  innerContainer.appendChild(spinnerIcon);
  innerContainer.appendChild(statusText);

  // Append elements to the main container
  container.appendChild(rProjectIcon);
  container.appendChild(innerContainer);

  return container;
}
</script>
<script type="module">
// Function to install a single package
async function qwebrInstallRPackage(packageName) {
  await mainWebR.evalRVoid(`webr::install('${packageName}');`);
}

// Function to load a single package
async function qwebrLoadRPackage(packageName) {
  await mainWebR.evalRVoid(`require('${packageName}', quietly = TRUE)`);
}

// Generic function to process R packages
async function qwebrProcessRPackagesWithStatus(packages, processType, displayStatusMessageUpdate = true) {
  // Switch between contexts
  const messagePrefix = processType === 'install' ? 'Installing' : 'Loading';

  // Modify button state
  qwebrSetInteractiveButtonState(`ðŸŸ¡ ${messagePrefix} package ...`, false);

  // Iterate over packages
  for (let i = 0; i < packages.length; i++) {
    const activePackage = packages[i];
    const formattedMessage = `${messagePrefix} package ${i + 1} out of ${packages.length}: ${activePackage}`;

    // Display the update in header
    if (displayStatusMessageUpdate) {
      qwebrUpdateStatusHeader(formattedMessage);
    }

    // Display the update in non-active areas
    qwebrUpdateStatusMessage(formattedMessage);

    // Run package installation
    if (processType === 'install') {
      await qwebrInstallRPackage(activePackage);
    } else {
      await qwebrLoadRPackage(activePackage);
    }
  }

  // Clean slate
  if (processType === 'load') {
    await mainWebR.flush();
  }
}

// Start a timer
const initializeWebRTimerStart = performance.now();

// Encase with a dynamic import statement
globalThis.qwebrInstance = import(qwebrCustomizedWebROptions.baseURL + "webr.mjs").then(
  async ({ WebR, ChannelType }) => {
    // Populate WebR options with defaults or new values based on `webr` meta
    globalThis.mainWebR = new WebR(qwebrCustomizedWebROptions);

    // Initialization WebR
    await mainWebR.init();

    // Setup a shelter
    globalThis.mainWebRCodeShelter = await new mainWebR.Shelter();

    // Setup a pager to allow processing help documentation
    await mainWebR.evalRVoid('webr::pager_install()');

    // Setup a viewer to allow processing htmlwidgets.
    // This might not be available in old webr version
    await mainWebR.evalRVoid('try({ webr::viewer_install() })');

    // Override the existing install.packages() to use webr::install()
    await mainWebR.evalRVoid('webr::shim_install()');

    // Specify the repositories to pull from
    // Note: webR does not use the `repos` option, but instead uses `webr_pkg_repos`
    // inside of `install()`. However, other R functions still pull from `repos`.
    await mainWebR.evalRVoid(`
      options(
        webr_pkg_repos = c(${qwebrPackageRepoURLS.map(repoURL => `'${repoURL}'`).join(',')}),
        repos = c(${qwebrPackageRepoURLS.map(repoURL => `'${repoURL}'`).join(',')})
      )
    `);

    // Check to see if any packages need to be installed
    if (qwebrSetupRPackages) {
      // Obtain only a unique list of packages
      const uniqueRPackageList = Array.from(new Set(qwebrInstallRPackagesList));

      // Install R packages one at a time (either silently or with a status update)
      await qwebrProcessRPackagesWithStatus(uniqueRPackageList, 'install', qwebrShowStartupMessage);

      if (qwebrAutoloadRPackages) {
        // Load R packages one at a time (either silently or with a status update)
        await qwebrProcessRPackagesWithStatus(uniqueRPackageList, 'load', qwebrShowStartupMessage);
      }
    }
  }
);

// Stop timer
const initializeWebRTimerEnd = performance.now();

</script>
<script type="module">
// Function to verify a given JavaScript Object is empty
globalThis.qwebrIsObjectEmpty = function (arr) {
    return Object.keys(arr).length === 0;
}

// Global version of the Escape HTML function that converts HTML
// characters to their HTML entities.
globalThis.qwebrEscapeHTMLCharacters = function(unsafe) {
    return unsafe
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
};

// Passthrough results
globalThis.qwebrIdentity = function(x) {
    return x;
};

// Append a comment
globalThis.qwebrPrefixComment = function(x, comment) {
    return `${comment}${x}`;
};

// Function to store the code in the history
globalThis.qwebrLogCodeToHistory = function(codeToRun, options) {
    qwebrRCommandHistory.push(
        `# Ran code in ${options.label} at ${new Date().toLocaleString()} ----\n${codeToRun}`
    );
};

// Function to attach a download button onto the canvas
// allowing the user to download the image.
function qwebrImageCanvasDownloadButton(canvas, canvasContainer) {

    // Create the download button
    const downloadButton = document.createElement('button');
    downloadButton.className = 'qwebr-canvas-image-download-btn';
    downloadButton.textContent = 'Download Image';
    canvasContainer.appendChild(downloadButton);

    // Trigger a download of the image when the button is clicked
    downloadButton.addEventListener('click', function() {
        const image = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.href = image;
        link.download = 'qwebr-canvas-image.png';
        link.click();
    });
}


// Function to parse the pager results
globalThis.qwebrParseTypePager = async function (msg) {

    // Split out the event data
    const { path, title, deleteFile } = msg.data;

    // Process the pager data by reading the information from disk
    const paged_data = await mainWebR.FS.readFile(path).then((data) => {
        // Obtain the file content
        let content = new TextDecoder().decode(data);

        // Remove excessive backspace characters until none remain
        while(content.match(/.[\b]/)){
            content = content.replace(/.[\b]/g, '');
        }

        // Returned cleaned data
        return content;
    });

    // Unlink file if needed
    if (deleteFile) {
        await mainWebR.FS.unlink(path);
    }

    // Return extracted data with spaces
    return paged_data;
};


// Function to parse the browse results
globalThis.qwebrParseTypeBrowse = async function (msg) {

    // msg.type === "browse"
    const path = msg.data.url;

    // Process the browse data by reading the information from disk
    const browse_data = await mainWebR.FS.readFile(path).then((data) => {
        // Obtain the file content
        let content = new TextDecoder().decode(data);

        return content;
    });

    // Return extracted data as-is
    return browse_data;
};

// Function to run the code using webR and parse the output
globalThis.qwebrComputeEngine = async function(
    codeToRun,
    elements,
    options) {

    // Call into the R compute engine that persists within the document scope.
    // To be prepared for all scenarios, the following happens:
    // 1. We setup a canvas device to write to by making a namespace call into the {webr} package
    // 2. We use values inside of the options array to set the figure size.
    // 3. We capture the output stream information (STDOUT and STERR)
    // 4. We disable the current device's image creation.
    // 5. Piece-wise parse the results into the different output areas

    // Create a pager variable for help/file contents
    let pager = [];

    // Handle how output is processed
    let showMarkup = options.results === "markup" && options.output !== "asis";
    let processOutput;

    if (showMarkup) {
        processOutput = qwebrEscapeHTMLCharacters;
    } else {
        processOutput = qwebrIdentity;
    }

    // ----
    // Convert from Inches to Pixels by using DPI (dots per inch)
    // for bitmap devices (dpi * inches = pixels)
    let fig_width = options["fig-width"] * options["dpi"];
    let fig_height = options["fig-height"] * options["dpi"];

    // Initialize webR
    await mainWebR.init();

    // Configure capture output
    let captureOutputOptions = {
        withAutoprint: true,
        captureStreams: true,
        captureConditions: false,
        // env: webR.objs.emptyEnv, // maintain a global environment for webR v0.2.0
    };

    // Determine if the browser supports OffScreen
    if (qwebrOffScreenCanvasSupport()) {
        // Mirror default options of webr::canvas()
        // with changes to figure height and width.
        captureOutputOptions.captureGraphics = {
            width: fig_width,
            height: fig_height,
            bg: "white", // default: transparent
            pointsize: 12,
            capture: true
        };
    }  else {
        // Disable generating graphics
        captureOutputOptions.captureGraphics = false;
    }

    // Store the code to run in history
    qwebrLogCodeToHistory(codeToRun, options);

    // Setup a webR canvas by making a namespace call into the {webr} package
    // Evaluate the R code
    // Remove the active canvas silently
    const result = await mainWebRCodeShelter.captureR(
        `${codeToRun}`,
        captureOutputOptions
    );

    // -----

    // Start attempting to parse the result data
    processResultOutput:try {

        // Avoid running through output processing
        if (options.results === "hide" || options.output === "false") {
            break processResultOutput;
        }

        // Merge output streams of STDOUT and STDErr (messages and errors are combined.)
        // Require both `warning` and `message` to be true to display `STDErr`.
        const out = result.output
        .filter(
            evt => evt.type === "stdout" ||
            ( evt.type === "stderr" && (options.warning === "true" && options.message === "true"))
        )
        .map((evt, index) => {
            const className = `qwebr-output-code-${evt.type}`;
            const outputResult = qwebrPrefixComment(processOutput(evt.data), options.comment);
            return `<code id="${className}-editor-${elements.id}-result-${index + 1}" class="${className}">${outputResult}</code>`;
        })
        .join("\n");


        // Clean the state
        // We're now able to process pager events.
        // As a result, we cannot maintain a true 1-to-1 output order
        // without individually feeding each line
        const msgs = await mainWebR.flush();

        // Use `map` to process the filtered "pager" events asynchronously
        const pager = [];
        const browse = [];

        await Promise.all(
            msgs.map(
                async (msg) => {

                    const msgType = msg.type || "unknown";

                    switch(msgType) {
                        case 'pager':
                            const pager_data = await qwebrParseTypePager(msg);
                            pager.push(pager_data);
                            break;
                        case 'browse':
                            const browse_data = await qwebrParseTypeBrowse(msg);
                            browse.push(browse_data);
                            break;
                    }
                    return;
                }
            )
        );

        // Nullify the output area of content
        elements.outputCodeDiv.innerHTML = "";
        elements.outputGraphDiv.innerHTML = "";

        // Design an output object for messages
        const pre = document.createElement("pre");
        if (/\S/.test(out)) {
            // Display results as HTML elements to retain output styling
            const div = document.createElement("div");
            div.innerHTML = out;

            // Calculate a scaled font-size value
            const scaledFontSize = qwebrScaledFontSize(
                elements.outputCodeDiv, options);

            // Override output code cell size
            pre.style.fontSize = `${scaledFontSize}px`;
            pre.appendChild(div);
        } else {
            // If nothing is present, hide the element.
            pre.style.visibility = "hidden";
        }

        elements.outputCodeDiv.appendChild(pre);

        // Determine if we have graphs to display
        if (result.images.length > 0) {

            // Create figure element
            const figureElement = document.createElement("figure");
            figureElement.className = "qwebr-canvas-image";

            // Place each rendered graphic onto a canvas element
            result.images.forEach((img) => {

                // Construct canvas for object
                const canvas = document.createElement("canvas");

                // Add an image download button
                qwebrImageCanvasDownloadButton(canvas, figureElement);

                // Set canvas size to image
                canvas.width = img.width;
                canvas.height = img.height;

                // Apply output truncations
                canvas.style.width = options["out-width"] ? options["out-width"] : `${fig_width}px`;
                if (options["out-height"]) {
                    canvas.style.height = options["out-height"];
                }

                // Apply styling
                canvas.style.display = "block";
                canvas.style.margin = "auto";

                // Draw image onto Canvas
                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, img.width, img.height);

                // Append canvas to figure output area
                figureElement.appendChild(canvas);

            });

            if (options['fig-cap']) {
                // Create figcaption element
                const figcaptionElement = document.createElement('figcaption');
                figcaptionElement.innerText = options['fig-cap'];
                // Append figcaption to figure
                figureElement.appendChild(figcaptionElement);
            }

            elements.outputGraphDiv.appendChild(figureElement);

        }

        // Display the pager data
        if (pager.length > 0) {
            // Use the `pre` element to preserve whitespace.
            pager.forEach((paged_data, index) => {
                const pre_pager = document.createElement("pre");
                pre_pager.innerText = paged_data;
                pre_pager.classList.add("qwebr-output-code-pager");
                pre_pager.setAttribute("id", `qwebr-output-code-pager-editor-${elements.id}-result-${index + 1}`);
                elements.outputCodeDiv.appendChild(pre_pager);
            });
        }

        // Display the browse data
        if (browse.length > 0) {
            // Use the `pre` element to preserve whitespace.
            browse.forEach((browse_data, index) => {
                const iframe_browse = document.createElement('iframe');
                iframe_browse.classList.add("qwebr-output-code-browse");
                iframe_browse.setAttribute("id", `qwebr-output-code-browse-editor-${elements.id}-result-${index + 1}`);
                iframe_browse.style.width = "100%";
                iframe_browse.style.minHeight = "500px";
                elements.outputCodeDiv.appendChild(iframe_browse);

                iframe_browse.contentWindow.document.open();
                iframe_browse.contentWindow.document.write(browse_data);
                iframe_browse.contentWindow.document.close();
            });
        }
    } finally {
        // Clean up the remaining code
        mainWebRCodeShelter.purge();
    }
};

// Function to execute the code (accepts code as an argument)
globalThis.qwebrExecuteCode = async function (
    codeToRun,
    id,
    options = {}) {

    // If options are not passed, we fall back on the bare minimum to handle the computation
    if (qwebrIsObjectEmpty(options)) {
        options = {
            "context": "interactive",
            "fig-width": 7, "fig-height": 5,
            "out-width": "700px", "out-height": "",
            "dpi": 72,
            "results": "markup",
            "warning": "true", "message": "true",
        };
    }

    // Next, we access the compute areas values
    const elements = {
        runButton: document.getElementById(`qwebr-button-run-${id}`),
        outputCodeDiv: document.getElementById(`qwebr-output-code-area-${id}`),
        outputGraphDiv: document.getElementById(`qwebr-output-graph-area-${id}`),
        id: id,
    }

    // Disallowing execution of other code cells
    document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
        btn.disabled = true;
    });

    if (options.context == EvalTypes.Interactive) {
        // Emphasize the active code cell
        elements.runButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin qwebr-icon-status-spinner"></i> <span>Run Code</span>';
    }

    // Evaluate the code and parse the output into the document
    await qwebrComputeEngine(codeToRun, elements, options);

    // Switch to allowing execution of code
    document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
        btn.disabled = false;
    });

    if (options.context == EvalTypes.Interactive) {
        // Revert to the initial code cell state
        elements.runButton.innerHTML = '<i class="fa-solid fa-play qwebr-icon-run-code"></i> <span>Run Code</span>';
    }
}

</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Beyond the Average Treatment Effect</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./00_instructors.html"> 
<span class="menu-text">Instructors</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title">Defining General, Hypothetical Interventions</h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
        <div class="sidebar-tools-collapse">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-collapse-item" href="https://github.com/nt-williams/lmtp-workshop">
            Source Code
            </a>
          </li>
      </ul>
    </div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_info_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_info_d.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">2. Defining Interventions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_info_estimators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Estimators</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">4. Estimating Effects with lmtp</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_lmtp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The lmtp package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_R_static.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Static effects and the ATE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_R_dtr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Treatment Regimes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_R_mtp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modified Treatment Policies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_R_ipsi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IPSI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_R_survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Survival Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_R_multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate Exposures</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_info_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Final Remarks</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#static-interventions" id="toc-static-interventions" class="nav-link active" data-scroll-target="#static-interventions">Static Interventions</a></li>
  <li><a href="#dynamic-treatment-regime" id="toc-dynamic-treatment-regime" class="nav-link" data-scroll-target="#dynamic-treatment-regime">Dynamic Treatment Regime</a></li>
  <li><a href="#modified-treatment-policies" id="toc-modified-treatment-policies" class="nav-link" data-scroll-target="#modified-treatment-policies">Modified Treatment Policies</a>
  <ul class="collapse">
  <li><a href="#additive-and-multiplicative-shift-mtp" id="toc-additive-and-multiplicative-shift-mtp" class="nav-link" data-scroll-target="#additive-and-multiplicative-shift-mtp">Additive and multiplicative shift MTP</a></li>
  </ul></li>
  <li><a href="#randomized-interventions" id="toc-randomized-interventions" class="nav-link" data-scroll-target="#randomized-interventions">Randomized Interventions</a></li>
  <li><a href="#incremental-propensity-score-interventions-based-on-the-risk-ratio" id="toc-incremental-propensity-score-interventions-based-on-the-risk-ratio" class="nav-link" data-scroll-target="#incremental-propensity-score-interventions-based-on-the-risk-ratio">Incremental Propensity Score Interventions Based on the Risk Ratio</a></li>
  <li><a href="#identification-of-the-causal-parameter" id="toc-identification-of-the-causal-parameter" class="nav-link" data-scroll-target="#identification-of-the-causal-parameter">Identification of the causal parameter</a>
  <ul class="collapse">
  <li><a href="#identification-assumptions" id="toc-identification-assumptions" class="nav-link" data-scroll-target="#identification-assumptions">Identification Assumptions</a></li>
  <li><a href="#example-5" id="toc-example-5" class="nav-link" data-scroll-target="#example-5">Example</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/loader.js"></script>
<script type="module" id="qwebr-monaco-editor-init">

  // Configure the Monaco Editor's loader
  require.config({
    paths: {
      'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs'
    }
  });
</script>
<script type="module">
// Function to update Monaco Editors when body class changes
function updateMonacoEditorsOnBodyClassChange() {
    // Select the body element
    const body = document.querySelector('body');

    // Options for the observer (which mutations to observe)
    const observerOptions = {
        attributes: true,  // Observe changes to attributes
        attributeFilter: ['class'] // Only observe changes to the 'class' attribute
    };

    // Callback function to execute when mutations are observed
    const bodyClassChangeCallback = function(mutationsList, observer) {
        for(let mutation of mutationsList) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                // Class attribute has changed
                // Update all Monaco Editors on the page
                updateMonacoEditorTheme();
            }
        }
    };

    // Create an observer instance linked to the callback function
    const observer = new MutationObserver(bodyClassChangeCallback);

    // Start observing the target node for configured mutations
    observer.observe(body, observerOptions);
}

// Function to update all instances of Monaco Editors on the page
function updateMonacoEditorTheme() {
    // Determine what VS Theme to use
    const vsThemeToUse = document.body.classList.contains("quarto-dark") ? 'vs-dark' : 'vs' ;

    // Iterate through all initialized Monaco Editors
    qwebrEditorInstances.forEach( function(editorInstance) { 
        editorInstance.updateOptions({ theme: vsThemeToUse }); 
    });
}

// Call the function to start observing changes to body class
updateMonacoEditorsOnBodyClassChange();
</script>
<script type="module">
// Global array to store Monaco Editor instances
globalThis.qwebrEditorInstances = [];

function isValidCodeLineNumbers(stringCodeLineNumbers) {
  // Regular expression to match valid input strings
  const regex = /^(\d+(-\d+)?)(,\d+(-\d+)?)*$/;
  return regex.test(stringCodeLineNumbers);
}

// Function that builds and registers a Monaco Editor instance    
globalThis.qwebrCreateMonacoEditorInstance = function (cellData) {

  const initialCode = cellData.code;
  const qwebrCounter = cellData.id;
  const qwebrOptions = cellData.options;

  // Retrieve the previously created document elements
  let runButton = document.getElementById(`qwebr-button-run-${qwebrCounter}`);
  let resetButton = document.getElementById(`qwebr-button-reset-${qwebrCounter}`);
  let copyButton = document.getElementById(`qwebr-button-copy-${qwebrCounter}`);
  let editorDiv = document.getElementById(`qwebr-editor-${qwebrCounter}`);

  // Load the Monaco Editor and create an instance
  let editor;
  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(editorDiv, {
      value: initialCode,
      language: 'r',
      theme: 'vs-light',
      automaticLayout: true,           // Works wonderfully with RevealJS
      scrollBeyondLastLine: false,
      minimap: {
        enabled: false
      },
      fontSize: qwebrScaledFontSize(editorDiv, qwebrOptions),         
      renderLineHighlight: "none",      // Disable current line highlighting
      hideCursorInOverviewRuler: true,  // Remove cursor indictor in right hand side scroll bar
      readOnly: qwebrOptions['read-only'] ?? false,
      quickSuggestions: qwebrOptions['editor-quick-suggestions'] ?? false,
      wordWrap: (qwebrOptions['editor-word-wrap'] == 'true' ? "on" : "off")
    });

    // Store the official counter ID to be used in keyboard shortcuts
    editor.__qwebrCounter = qwebrCounter;

    // Store the official div container ID
    editor.__qwebrEditorId = `qwebr-editor-${qwebrCounter}`;

    // Store the initial code value and options
    editor.__qwebrinitialCode = initialCode;
    editor.__qwebrOptions = qwebrOptions;

    // Set at the model level the preferred end of line (EOL) character to LF.
    // This prevent `\r\n` from being given to the webR engine if the user is on Windows.
    // See details in: https://github.com/coatless/quarto-webr/issues/94
    // Associated error text: 
    // Error: <text>:1:7 unexpected input

    // Retrieve the underlying model
    const model = editor.getModel();
    // Set EOL for the model
    model.setEOL(monaco.editor.EndOfLineSequence.LF);
    
    // Dynamically modify the height of the editor window if new lines are added.
    let ignoreEvent = false;
    const updateHeight = () => {
      // Increment editor height by 2 to prevent vertical scroll bar from appearing
      const contentHeight = editor.getContentHeight() + 2;

      // Retrieve editor-max-height option
      const maxEditorHeight = qwebrOptions['editor-max-height'];

      // If editor-max-height is missing, allow infinite growth. Otherwise, threshold.
      const editorHeight = !maxEditorHeight ?  contentHeight : Math.min(contentHeight, maxEditorHeight);

      // We're avoiding a width change
      //editorDiv.style.width = `${width}px`;
      editorDiv.style.height = `${editorHeight}px`;
      try {
        ignoreEvent = true;

        // The key to resizing is this call
        editor.layout();
      } finally {
        ignoreEvent = false;
      }
    };

    // Function to generate decorations to highlight lines
    // in the editor based on input string.
    function decoratorHighlightLines(codeLineNumbers) {
      // Store the lines to be lighlight
      let linesToHighlight = [];
      
      // Parse the codeLineNumbers string to get the line numbers to highlight
      // First, split the string by commas
      codeLineNumbers.split(',').forEach(part => {
        // Check if we have a range of lines
        if (part.includes('-')) {
            // Handle range of lines (e.g., "6-8")
            const [start, end] = part.split('-').map(Number);
            for (let i = start; i <= end; i++) {
                linesToHighlight.push(i);
            }
        } else {
            // Handle single line (e.g., "7")
            linesToHighlight.push(Number(part));
        }
      });
  
      // Create monaco decorations for the lines to highlight
      const decorations = linesToHighlight.map(lineNumber => ({
          range: new monaco.Range(lineNumber, 1, lineNumber, 1),
          options: {
              isWholeLine: true,
              className: 'qwebr-editor-highlight-line'
          }
      }));
  
      // Return decorations to be applied to the editor
      return decorations;
    }

    // Ensure that the editor-code-line-numbers option is set and valid
    // then apply styling
    if (qwebrOptions['editor-code-line-numbers']) {
      // Remove all whitespace from the string
      const codeLineNumbers = qwebrOptions['editor-code-line-numbers'].replace(/\s/g,'');
      // Check if the string is valid for line numbers, e.g., "1,3-5,7"
      if (isValidCodeLineNumbers(codeLineNumbers)) {
        // Apply the decorations to the editor
        editor.createDecorationsCollection(decoratorHighlightLines(codeLineNumbers));
      } else {
        // Warn the user that the input is invalid
        console.warn(`Invalid "editor-code-line-numbers" value in code cell ${qwebrOptions['label']}: ${codeLineNumbers}`);
      }
    }

    // Helper function to check if selected text is empty
    function isEmptyCodeText(selectedCodeText) {
      return (selectedCodeText === null || selectedCodeText === undefined || selectedCodeText === "");
    }

    // Registry of keyboard shortcuts that should be re-added to each editor window
    // when focus changes.
    const addWebRKeyboardShortCutCommands = () => {
      // Add a keydown event listener for Shift+Enter to run all code in cell
      editor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {

        // Retrieve all text inside the editor
        qwebrExecuteCode(editor.getValue(), editor.__qwebrCounter, editor.__qwebrOptions);
      });

      // Add a keydown event listener for CMD/Ctrl+Enter to run selected code
      editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, () => {

        // Get the selected text from the editor
        const selectedText = editor.getModel().getValueInRange(editor.getSelection());
        // Check if no code is selected
        if (isEmptyCodeText(selectedText)) {
          // Obtain the current cursor position
          let currentPosition = editor.getPosition();
          // Retrieve the current line content
          let currentLine = editor.getModel().getLineContent(currentPosition.lineNumber);

          // Propose a new position to move the cursor to
          let newPosition = new monaco.Position(currentPosition.lineNumber + 1, 1);

          // Check if the new position is beyond the last line of the editor
          if (newPosition.lineNumber > editor.getModel().getLineCount()) {
            // Add a new line at the end of the editor
            editor.executeEdits("addNewLine", [{
            range: new monaco.Range(newPosition.lineNumber, 1, newPosition.lineNumber, 1),
            text: "\n", 
            forceMoveMarkers: true,
            }]);
          }
          
          // Run the entire line of code.
          qwebrExecuteCode(currentLine, editor.__qwebrCounter, editor.__qwebrOptions);

          // Move cursor to new position
          editor.setPosition(newPosition);
        } else {
          // Code to run when Ctrl+Enter is pressed with selected code
          qwebrExecuteCode(selectedText, editor.__qwebrCounter, editor.__qwebrOptions);
        }
      });
    }

    // Register an on focus event handler for when a code cell is selected to update
    // what keyboard shortcut commands should work.
    // This is a workaround to fix a regression that happened with multiple
    // editor windows since Monaco 0.32.0 
    // https://github.com/microsoft/monaco-editor/issues/2947
    editor.onDidFocusEditorText(addWebRKeyboardShortCutCommands);

    // Register an on change event for when new code is added to the editor window
    editor.onDidContentSizeChange(updateHeight);

    // Manually re-update height to account for the content we inserted into the call
    updateHeight();

    // Store the editor instance in the global dictionary
    qwebrEditorInstances[editor.__qwebrCounter] = editor;

  });

  // Add a click event listener to the run button
  runButton.onclick = function () {
    qwebrExecuteCode(editor.getValue(), editor.__qwebrCounter, editor.__qwebrOptions);
  };

  // Add a click event listener to the reset button
  copyButton.onclick = function () {
    // Retrieve current code data
    const data = editor.getValue();
    
    // Write code data onto the clipboard.
    navigator.clipboard.writeText(data || "");
  };
  
  // Add a click event listener to the copy button
  resetButton.onclick = function () {
    editor.setValue(editor.__qwebrinitialCode);
  };
  
}
</script>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Defining General, Hypothetical Interventions</h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">June 4, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<div class="hidden">
<p><span class="math display">\[
\renewcommand{\P}{\mathsf{P}}
\newcommand{\m}{\mathsf{m}}
\newcommand{\p}{\mathsf{p}}
\newcommand{\q}{\mathsf{q}}
\newcommand{\bb}{\mathsf{b}}
\newcommand{\g}{\mathsf{g}}
\newcommand{\rr}{\mathsf{r}}
\newcommand{\IF}{\mathbb{IF}}
\newcommand{\dd}{\mathsf{d}}
\newcommand{\Pn}{$\mathsf{P}_n$}
\newcommand{\E}{\mathsf{E}}
\]</span></p>
</div>
<p>Have you ever begun reading a paper in the methodological causal inference literature and encountered the phrase â€œassume the treatment or exposure is a binaryâ€¦â€? (Most papers we read assume this!!) While assuming exposure variables are binary can simplify the definition of causal effects, many exposures of interest in reality are not binary.</p>
<p><strong>Instead, we will work in situations where</strong> <span class="math inline">\(A\)</span> <strong>is a binary, categorical, multivariate, or continuous variable!</strong></p>
<hr>
<p>In the previous section, we defined <span class="math inline">\(\dd(a_t, h_t, \epsilon_t)\)</span> as a function that maps values <span class="math inline">\(a_t\)</span>, <span class="math inline">\(h_t\)</span>, and potentially a randomizer <span class="math inline">\(\epsilon_t\)</span> to a new value of treatment. Let us see how this function is used to define a treatment effect. Our focus henceforth is estimating the causal effect of an intervention, characterized by <span class="math inline">\(\dd\)</span> on the outcome <span class="math inline">\(Y\)</span>, through the causal parameter</p>
<p><span class="math display">\[
\theta = \E[Y^{\bar A^{\dd}}]\text{,}
\]</span></p>
<p>where <span class="math inline">\(Y^{\bar A^{\dd}}\)</span> is the counterfactual outcome in a world, where possibly contrary to fact, each entry of <span class="math inline">\(\bar{A} = (A_1, \ldots, A_\tau)\)</span> was modified according to the function <span class="math inline">\(\dd\)</span> as follows.</p>
<ul>
<li><p>At time point <span class="math inline">\(t=1\)</span>, the post-intervention treatment is assigned as <span class="math inline">\(A_1^\dd = \dd(A_1, H_1)\)</span>. This generates a <em>counterfactual</em> treatment at time <span class="math inline">\(t=2\)</span>, denoted by <span class="math inline">\(A_2^{A_1^\dd}\)</span>. This is the treatment an individual would have gotten had the intervention been performed at time <span class="math inline">\(t=1\)</span> but not at time <span class="math inline">\(t=2\)</span>.</p></li>
<li><p>At time point <span class="math inline">\(t=2\)</span>, the post-intervention treatment is assigned as <span class="math inline">\(A_2^\dd = \dd(A_2^{A_1^\dd}, L_2^{A_1^\dd}, A_1^\dd, L_1)\)</span>. This generates a counterfactual treatment at time <span class="math inline">\(t=3\)</span>.</p></li>
<li><p>This process is iteratively repeated until the end of the study. At that time, the counterfactual outcome <span class="math inline">\(Y^{\bar A^{\dd}}\)</span> is generated.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/swig.png" class="img-fluid figure-img"></p>
<figcaption>Single World Intervention Graph.</figcaption>
</figure>
</div>
<p>This definition is agnostic to the type of outcome:</p>
<ul>
<li><p>When <span class="math inline">\(Y\)</span> is continuous, <span class="math inline">\(\theta\)</span> is the mean population value of <span class="math inline">\(Y\)</span> under intervention <span class="math inline">\(\dd\)</span>.</p></li>
<li><p>When <span class="math inline">\(Y\)</span> is dichotomous, <span class="math inline">\(\theta\)</span> is the population proportion of event <span class="math inline">\(Y\)</span> under intervention <span class="math inline">\(\dd\)</span>.</p></li>
<li><p>When <span class="math inline">\(Y\)</span> is the indicator of an event by end of the study, <span class="math inline">\(\theta\)</span> is defined as the cumulative incidence of <span class="math inline">\(Y\)</span> under intervention <span class="math inline">\(\dd\)</span>.</p></li>
</ul>
<p>But what is this function <span class="math inline">\(\dd\)</span>, how can it be defined, and how does using this function to define interventions solve the problem? Letâ€™s start from simple to more complex examples of functions <span class="math inline">\(\dd\)</span>.</p>
<section id="static-interventions" class="level2">
<h2 class="anchored" data-anchor-id="static-interventions">Static Interventions</h2>
<p>Let <span class="math inline">\(A\)</span> denote a binary vector, such as receiving a medication, and define <span class="math inline">\(\dd(a_t, h_t, \epsilon) = 1\)</span>. This intervention characterizes a hypothetical world where all members of the population receive treatment at all times.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>An intervention is static if the function <span class="math inline">\(\dd_t\)</span> always returns the same value regardless of the input.</p>
</div>
</div>
</div>
<section id="example" class="level4">
<h4 class="anchored" data-anchor-id="example">Example</h4>
<blockquote class="blockquote">
<p>Letâ€™s say we were interested in the effect of randomizing patients with opioid use disorder to injection naltrexone (<span class="math inline">\(A=1\)</span>) vs.&nbsp;sublingual buprenorphine (<span class="math inline">\(A=0\)</span>). We would contrast the counterfactual outcomes in a hypothetical world in which all units were treated with injection naltrexone <span class="math inline">\(\dd_1=1\)</span> versus a hypothetical world in which all units were treated with buprenorphine <span class="math inline">\(\dd_0=0\)</span>. This gives us the well-known average (comparative) treatment effect (ATE). <span class="math display">\[\E[Y^{\bar A^{\dd_1}} - Y^{\bar A^{\dd_0}}] = \E[Y^{A=1} - Y^{A=0}]\]</span></p>
</blockquote>
</section>
</section>
<section id="dynamic-treatment-regime" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-treatment-regime">Dynamic Treatment Regime</h2>
<p>Let <span class="math inline">\(A_t\)</span> denote a binary vector, such as receiving a medication, and <span class="math inline">\(L_t\)</span> a numeric vector, such as a measure of discomfort. For a given value of <span class="math inline">\(\delta\)</span>, define <span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
1 &amp;\text{ if } l_t &gt; \delta \\
0 &amp;\text{ otherwise.}
\end{cases}
\]</span></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Interventions where the output of the function <span class="math inline">\(\dd\)</span> depends <strong>only</strong> <strong>on the history</strong> <span class="math inline">\(H_t\)</span> are referred to as being dynamic.</p>
</div>
</div>
</div>
<section id="example-1" class="level4">
<h4 class="anchored" data-anchor-id="example-1">Example</h4>
<blockquote class="blockquote">
<p><span class="citation" data-cites="rudolph2022buprenorphine">Rudolph, Williams, et al. (<a href="#ref-rudolph2022buprenorphine" role="doc-biblioref">2022</a>)</span> examined a Buprenorphine (BUP-NX) dosing strategy among a population of patients who were taking BUP-NX for opioid use disorder. Under the hypothetical intervention, patients who reported opioid use during the week prior to a physicians exam received a BUP-NX dose increase while patients who did not report prior-week opioid use maintained the same dose. Let <span class="math inline">\(A_t\)</span> be a binary indicator for BUP-NX dose increase at week <span class="math inline">\(t\)</span> compared to week <span class="math inline">\(t-1\)</span> and <span class="math inline">\(L_t\)</span> be an indicator for opioid use at week <span class="math inline">\(t\)</span>. Then, <span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
1 \text{ if } l_{t-1} = 1\\
0 \text{ otherwise}
\end{cases}
\]</span></p>
</blockquote>
</section>
</section>
<section id="modified-treatment-policies" class="level2">
<h2 class="anchored" data-anchor-id="modified-treatment-policies">Modified Treatment Policies</h2>
<p>While much attention is given to static and dynamic interventions, their use is often accompanied by a few key problems.</p>
<ol type="1">
<li><p><strong>Defining causal effects in terms of hypothetical interventions where treatment is applied to all units may be inconceivable.</strong> For example, we may be interested to know if reducing surgery time reduces surgical complications. However, itâ€™s inconceivable to set all surgeries to a given duration, even if this duration depends on patient covariates.</p></li>
<li><p><strong>Defining causal effects in terms of hypothetical interventions where treatment is applied to all units may induce positivity violations.</strong></p></li>
</ol>
<p>A solution to these problems is to instead define causal effects using <strong>modified treatment policies (MTP).</strong></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>An intervention characterized by a hypothetical world where the <em>natural</em> value of treatment is modified is called a <em>modified treatment policy</em>.</p>
</div>
</div>
</div>
<section id="additive-and-multiplicative-shift-mtp" class="level3">
<h3 class="anchored" data-anchor-id="additive-and-multiplicative-shift-mtp">Additive and multiplicative shift MTP</h3>
<p>Let <span class="math inline">\(A_t\)</span> denote a numeric vector. Assume that <span class="math inline">\(A_t\)</span> has support in the data such that <span class="math inline">\(P(A_t \leq u(h_t) \mid H_t = h_t) = 1\)</span>. For an analyst-defined value of <span class="math inline">\(\delta\)</span>, define <span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
a_t + \delta &amp;\text{ if } a_t + \delta \leq u(h_t) \\
a_t &amp;\text{ otherwise.}
\end{cases}
\]</span></p>
<p>Under this intervention, the natural value of exposure at time <span class="math inline">\(t\)</span> is increased by the analyst-defined value <span class="math inline">\(\delta\)</span>, whenever such an increase is feasible. This MTP is referred to as an <em>additive shift</em> <em>MTP.</em></p>
<section id="example-2" class="level4">
<h4 class="anchored" data-anchor-id="example-2">Example</h4>
<blockquote class="blockquote">
<p><span class="citation" data-cites="diaz2023nonparametric">DÄ±Ìaz et al. (<a href="#ref-diaz2023nonparametric" role="doc-biblioref">2023</a>)</span> estimated the effect of increasing P/F ratio (<span class="math inline">\(A_t\)</span>)â€“a measure of hypoxemiaâ€“by 50 units on survival among those patients with acute respiratory failure (a P/F ratio &lt; 300). <span class="math display">\[
\dd_t(a_t, l_t, \epsilon) = \begin{cases}
a_t + 50 &amp;\text{ if } a_t \leq 300 \\
a_t &amp;\text{ otherwise}
\end{cases}
\]</span></p>
</blockquote>
<p>We can similarly define a <em>multiplicative shift MTP</em> as</p>
<p><span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
a_t \times \delta &amp;\text{ if } a_t \times \delta \leq u(h_t) \\
a_t &amp;\text{ otherwise}.
\end{cases}
\]</span></p>
</section>
<section id="example-3" class="level4">
<h4 class="anchored" data-anchor-id="example-3">Example</h4>
<blockquote class="blockquote">
<p><span class="citation" data-cites="nugent2023demonstration">Nugent and Balzer (<a href="#ref-nugent2023demonstration" role="doc-biblioref">2023</a>)</span> evaluated the association between county-level measures of mobility and incident COVID-19 cases in the United States in the Summer and Fall of 2022. They considered both hypothetical additive and multiplicative MTPs; for example, they defined a multiplicative MTP where a measure for the density of mobile devices visiting commercial locations was decreased by 25%: <span class="math display">\[
\dd(a_t, l_t, \epsilon) = a_t \times 0.75.
\]</span></p>
</blockquote>
</section>
</section>
</section>
<section id="randomized-interventions" class="level2">
<h2 class="anchored" data-anchor-id="randomized-interventions">Randomized Interventions</h2>
<p>Let <span class="math inline">\(A\)</span> denote a binary vector, <span class="math inline">\(\epsilon \sim U(0, 1)\)</span>, and <span class="math inline">\(\epsilon\)</span> be an analyst-defined value between 0 and 1. We may then define randomized interventions. For example, imagine we are interested in a hypothetical world where half of all smokers quit smoking. This intervention would be defined as</p>
<p><span class="math display">\[
\dd(a_t, \epsilon_t) = \begin{cases}
0 &amp;\text{ if } \epsilon_t &lt; 0.5 \text{ and } a_t = 1 \\
a_t &amp;\text{ otherwise}
\end{cases}.
\]</span></p>
</section>
<section id="incremental-propensity-score-interventions-based-on-the-risk-ratio" class="level2">
<h2 class="anchored" data-anchor-id="incremental-propensity-score-interventions-based-on-the-risk-ratio">Incremental Propensity Score Interventions Based on the Risk Ratio</h2>
<p>Let <span class="math inline">\(A\)</span> denote a binary variable, <span class="math inline">\(\epsilon \sim U(0, 1)\)</span>, and <span class="math inline">\(\delta\)</span> be an analyst-defined risk ratio limited to be between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>. In addition, define <span class="math inline">\(P(A_t = a_t\mid H_t)= \g(a_t \mid H_t)\)</span>.</p>
<p>If we were interested in an intervention that decreased the likelihood of receiving treatment, define</p>
<p><span class="math display">\[
\dd_t(a_t, h_t, \epsilon_t) = \begin{cases}
a_t &amp;\text{ if } \epsilon_t &lt; \delta \\
0 &amp;\text{ otherwise}
\end{cases}.
\]</span> In this case, we have <span class="math inline">\(\g^\dd(a_t \mid h_t) = a_t \delta \g_t(1 \mid H_t) + (1 - a_t) (1 - \delta \g_t(1\mid H_t))\)</span>, which leads to a risk ratio of <span class="math inline">\(\g_t^\dd(1 \mid H_t)/\g_t(1\mid H_t) = \delta\)</span> for comparing the propensity score post- vs pre-intervention.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>An intervention where the conditional probability of treatment is shifted is referred to as an incremental propensity score intervention.</p>
</div>
</div>
</div>
<p>Conversely, if we were interested in an intervention that increased the likelihood of receiving treatment, define</p>
<p><span class="math display">\[
\dd_t(a_t, h_t, \epsilon_t) = \begin{cases}
a_t &amp;\text{ if } \epsilon_t &lt; \delta \\
1 &amp;\text{ otherwise.}
\end{cases}
\]</span></p>
<p>Now <span class="math inline">\(\g_t^\dd(a_t \mid H_t) = a_t (1 - \delta \g_t(0\mid H_t)) + (1 - a_t) \delta \g_t(0 \mid H_t)\)</span>, which implies a risk ratio <span class="math inline">\(\g_t^\dd(0\mid H_t)/\g(0\mid H_t) = \delta\)</span>.</p>
<div class="callout callout-style-simple callout-caution">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Interventions where the shift is in the odds ratio scale were previously proposed, but the effects of odds-ratio shifts should not be estimated with <em>lmtp</em>, we will discuss this more later.</p>
</div>
</div>
</div>
<section id="example-4" class="level4">
<h4 class="anchored" data-anchor-id="example-4">Example</h4>
<blockquote class="blockquote">
<p>Using electronic health record data, <span class="citation" data-cites="wen2023intervention">Wen, Marcus, and Young (<a href="#ref-wen2023intervention" role="doc-biblioref">2023</a>)</span> estimated the effect of increasing the proportion of PrEP uptake on bacterial STI among cis-gender males being tested for STIs and that do not have HIV. Let <span class="math inline">\(A_t\)</span> be a binary indicator for PrEP initiation at week <span class="math inline">\(t\)</span>, and <span class="math inline">\(L_t\)</span> be a binary indicator for any STI testing and being HIV-free at week <span class="math inline">\(t\)</span>. They defined a â€œmediumâ€ successful PrEP uptake intervention as <span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
a_t &amp;\text{ if } l_t = 1 \text{ and } \epsilon_t &lt; 0.85 \\
1 &amp;\text{ otherwise}.
\end{cases}
\]</span></p>
</blockquote>
</section>
</section>
<section id="identification-of-the-causal-parameter" class="level2">
<h2 class="anchored" data-anchor-id="identification-of-the-causal-parameter">Identification of the causal parameter</h2>
<p>Recall that the fundamental problem of causal inference is that we canâ€™t observe the alternative worlds which we use to define causal effects. If we canâ€™t observe counterfactual variables, then how can we learn a causal effect? Under a set of certain assumptions, we can <em>identify</em> a causal parameter from observed data. These assumptions are called identification assumptions.</p>
<section id="identification-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="identification-assumptions">Identification Assumptions</h3>
<ol type="1">
<li><p><em>Positivity</em>. If <span class="math inline">\((a_t, h_t) \in \text{supp}\{A_t, H_t\}\)</span> then <span class="math inline">\(\dd(a_t, h_t) \in \text{supp}\{A_t, H_t\}\)</span> for <span class="math inline">\(t \in \{1, ..., \tau\}\)</span>.</p>
<blockquote class="blockquote">
<p>If there is a unit with observed treatment value <span class="math inline">\(a_t\)</span> and covariates <span class="math inline">\(h_t\)</span>, there must also be a unit with treatment value <span class="math inline">\(\dd(a_t, h_t)\)</span> and covariates <span class="math inline">\(h_t\)</span>.</p>
</blockquote></li>
<li><p><em>No unmeasured confounders.</em> All the common causes of <span class="math inline">\(A_t\)</span> and <span class="math inline">\((L_s, A_s, Y)\)</span> are measured and contained in <span class="math inline">\(H_t\)</span> for all <span class="math inline">\(s \in \{t+1, ..., \tau\}\)</span>.</p>
<blockquote class="blockquote">
<p>For all times <span class="math inline">\(t\)</span>, the history <span class="math inline">\(H_t\)</span> contains sufficient variables to adjust for confounding of <span class="math inline">\(A_t\)</span> and any subsequent variables, including future treatment.</p>
</blockquote></li>
</ol>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Question</strong>: When might these assumptions be violated?</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Under these assumptions, the distribution of the natural value of treatment at time <span class="math inline">\(t\)</span> is equal to the distribution of the observed value of treatment at time <span class="math inline">\(t\)</span> conditional on the observed history.</p>
</div>
</div>
</div>
<p>Assuming the above, <span class="math inline">\(\theta\)</span> is identified from the observed data with:</p>
<p>Set <span class="math inline">\(\m_{\tau+1} = Y\)</span>. In a slight abuse of notation, let <span class="math inline">\(A_t^\dd = \dd(A_t, H_t)\)</span>. For <span class="math inline">\(t = \tau, ..., 1\)</span>, recursively define</p>
<p><span class="math display">\[
\m_t: (a_t, h_t) \rightarrow \E[\m_{t + 1}(A^{\dd}_{t+1}, H_{t + 1}) \mid A_t = a_t, H_t = h_t],
\]</span></p>
<p>and define <span class="math inline">\(\theta = E[\m_1(A^{\dd}_1, L_1)]\)</span>.</p>
</section>
<section id="example-5" class="level3">
<h3 class="anchored" data-anchor-id="example-5">Example</h3>
<p>Consider the following data (here <span class="math inline">\(\tau = 2\)</span>):</p>
<div id="qwebr-insertion-location-1"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-24646a00bbf64eb77cad" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-24646a00bbf64eb77cad">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959","960","961","962","963","964","965","966","967","968","969","970","971","972","973","974","975","976","977","978","979","980","981","982","983","984","985","986","987","988","989","990","991","992","993","994","995","996","997","998","999","1000"],[-0.1007840650787596,0.3977771339538654,0.3615710994185271,1.097290478843439,-2.270324344305685,0.001525729866952272,-1.301316494766338,0.431088891418879,-2.154632049370653,-0.2968337316365002,0.4006674185475491,0.6469624805970682,0.7239914452292833,0.2531705749572135,0.9892479208083657,-1.947143659867536,0.4139214126945672,-0.724655630635509,-0.5007237951513689,-0.2069011810191737,-1.631216787550956,-3.093382648130906,0.2274917683445896,-1.09502177587486,-0.8090288103449202,-1.132573164372525,-0.637369044453291,-0.4587165794733342,-0.6365245124066206,0.1295434109640913,0.5840160598664276,0.7693575582302429,0.9949023284295783,0.3524920004093428,0.9728320111817551,0.1746000842925777,0.5286562563342254,-0.6759588482617485,0.827338576018236,0.1698585626133516,0.1968128363103888,-0.5246723790355418,0.6944701799599768,0.523528989085325,-0.7771808045691522,1.052511219812311,1.481170346488044,0.1565135439902781,0.2387032504647067,-0.02337222725934237,-0.3959479880774747,1.024204312629876,0.6749169217288588,0.6396684180649765,0.9549814951628089,-0.5024588331441729,-0.1425808903309211,-0.9479476203261551,-0.5453439592528816,-0.5381574089446995,-0.9003556672338062,-1.207674514553686,-0.3286883226446663,0.2548996746728215,0.174258294645267,0.9827619919203151,-0.00533615288530517,0.6807506287939822,-0.7293909839761737,0.3919475400231518,-0.7176820981825696,1.001966020733021,0.2098694036643234,-0.2924212291323956,-0.07322611783625296,0.1345031993037078,0.2867258951156425,-0.5963096426152122,0.7778627610631974,-2.316640684325397,-0.1412042034075097,-0.1512527095155884,1.168868228111824,0.6937768500221144,0.9241345138998883,-0.3945353795573929,-0.5792872563812396,1.322873081043211,1.695125212529307,0.614359756024627,-0.8428637718024008,0.7491231522295031,-2.07841388806595,1.524321776183344,0.3641935498928248,-0.1458363317836024,0.7357692272211416,-1.49676559214187,0.01109535506839108,1.600406897613892,-1.596264367538502,-0.9347692467643947,-0.8008902900621533,0.9755503643642232,0.3649110371266435,0.2938298992200861,0.4048961273308022,-0.08404485758462957,0.07716654593405307,0.19904455933743,-0.3898782447897673,2.18056639662356,0.2141991498238634,0.8773149729630499,0.7368041190575544,-0.08489281639086721,-0.2050575277631141,-1.355429058223959,1.110627839334208,-5.192785990258134e-05,-0.3868406256615144,0.3214207950524307,1.643903882355858,1.319643231111752,0.01421221084939525,-0.155660243669736,2.264636635349961,-1.256682432015928,-0.7153616199707309,-1.33673419197919,-0.04592664109916281,-1.131668972560842,-1.187845140654506,0.3172341635020366,1.55410863772527,0.7542723012073016,-1.375934568997798,0.7189791646192385,-0.2619529653703927,-0.6782831617523215,0.6221114036469509,-2.102737043362933,-1.134591319761733,-2.109620410895335,-1.890974546862512,1.075845855001242,-2.957576440702671,0.698528143542581,0.9906270418105503,1.733839871339603,-0.7943875737300783,-1.169223201314179,0.3486904179042621,-0.7399146210238631,-1.849712434966235,-1.896591491805679,-0.2985839717130132,0.6763853384384394,0.2732807202260351,-0.495027359401147,-0.9868882492023356,0.8965869182243249,-1.453183350144105,0.2865272838843896,0.2773103689859105,-0.04119298709309038,-0.8190183428338085,-0.7397118220768925,1.584844827660236,0.6215422886787569,0.7753362800593442,0.1609380253035006,0.9810852853351387,-1.448599059627113,-0.8446498913980113,-0.8989059254107364,0.6346507668017702,0.5168283842330542,-0.1071610760932712,0.8631712219020398,0.09583900591030521,0.7998850897805722,-0.3532793980507464,-1.127214192699483,-0.6060671079209405,-0.8195929792957598,1.88532726223234,1.287315159828493,1.693702075423558,1.35970955908296,-0.3769044288587179,0.9300520461359473,0.1395170055697844,0.305025279654022,0.7437799667389688,-1.129172974025445,-0.8080196728211151,0.1929756986640497,0.1230636784467071,0.8509203165329322,-0.2632865368198816,-0.8852330471721108,-2.376208724871548,-2.465735084472609,-0.4117295264904902,0.9217214774095389,-1.282673127252471,0.1846535028643538,-1.829337075619684,-0.1438114830827998,0.2940920680355915,0.1011915902698582,1.544575322916078,-0.8185557936803549,0.8778543202058978,-1.179594936972969,-0.3932406467129594,-0.8629087401525068,0.006909140910893416,-1.496467419064374,0.02154319019410117,0.904607567759063,1.054688633971288,0.4658072200745305,0.2700281726681433,-0.230121720027428,0.5131581737073975,-0.6134655958495534,-0.503783978868685,-1.008058807614769,1.119366501809041,0.5353331976144655,0.4382385596930891,0.4240163483955995,0.8406574908150195,0.7905002623374905,-0.7429509305011017,2.504565465561094,0.02860647569438083,0.8934027861800512,1.463353241345158,0.7379773842423561,-0.689869931706534,0.1948973936461433,-0.5268831905763746,-0.7484082321465683,-0.1498141782330652,-3.012147533507117,0.8374064780610825,-0.7842348128921315,-1.122459458137657,0.1226224116300676,0.6685989940719599,0.2099467604320733,0.1882600764998912,-0.06134425226231029,1.543312585327602,-0.3158433641289328,-0.2393200234311264,1.07254662652217,-0.9041508193154869,-1.652035864055993,0.04623265875226458,-1.492278928870562,0.8148011599444612,0.6778502631931405,-0.7684553123722502,0.06970284763879755,-0.4728995759188946,-1.171815513393033,-0.7892633057745488,-0.7973665539896281,-1.17509698048858,0.4988026043860971,1.28250017677014,-1.490267103768404,1.138996481941236,1.62772565842692,-0.7602084724763162,1.594919581064697,-1.444352534820545,-0.4898329455723469,0.06105872060234378,-1.155998250145503,-1.028988559138434,-0.4617232051170915,1.041015463443886,-0.3040656588581621,-0.8052662224910133,0.1889809438849759,-0.4487127058335721,-0.5650813785292673,-0.2034440412699731,-0.7550141673871327,-0.1429345831490247,0.08817431462982106,-0.3626692354524571,0.151836881614318,0.2908749601477381,-1.12365161817364,-0.02814661759297926,1.360722751269721,1.06947244547056,-0.5709657529098461,-0.8697156235091427,-1.076897842358956,-1.458768034790175,-1.2336396299849,-0.593957463334967,0.7345174114118083,-0.02597418042322223,-1.070182828787968,0.01008304762098413,2.434656224535509,0.5215207257341067,1.607149137916572,0.08257942514864557,-2.835182800340506,1.177302743233534,0.4843995644565346,-0.1301262173912218,-0.7405274169121963,0.5903523247186929,-0.2943347705855509,-0.8903436402184119,-0.1818143012507066,0.6963448570310959,-0.2887403731908734,0.8531473101872245,0.09039635115201575,-1.051603833286149,-1.105885329629927,-0.3691246842373938,1.281033851813762,-1.328959186756973,0.09095795217599814,-0.4154245745389495,1.538729889705168,-0.2116691309788884,-0.7259171065790097,-0.2679304330080469,-0.2040281289653519,0.16400738496582,-0.730302481929249,-1.869989742197883,-0.05821883389961648,0.4914222889346012,0.1195969490285378,-1.09558113846593,0.5217224382509047,1.847508500573769,0.4350640784635205,-1.63700643628914,-0.6192369265438382,-0.2222905504021379,-0.9540715189457362,-0.2876897593290975,0.6781281173651919,-0.950283537353604,0.4780866136566416,0.5873988592522809,0.9734547373360773,-1.548890119640183,0.6408198379906869,0.9219390107308231,-0.2593331678658199,-0.4265080492108214,-1.880361124421248,0.5692857706229776,0.6719310368696184,0.05913060736483552,-1.191563571140053,-0.43267826688137,1.69064977182741,-0.9512701510567613,0.9510583570762473,0.5624229111333459,-0.658945195465616,0.6813702687143618,-0.4536437995380857,-0.7189910726249966,-0.472916097927423,1.308079575822585,-1.419960038135222,-0.6760026585379374,1.066435813703541,-0.4358915847702449,0.3056166051788416,-0.3872474268406104,-1.42887585979375,-0.0769670698926318,0.9200508525706572,0.1609817330978351,-0.5840045538368009,-0.7586393926081709,-0.1448919770992377,-0.1192274005155964,-1.71117958163291,-1.107185808182196,0.3803726077108086,-0.8339948391257278,1.166215148395679,0.5720254519663082,-1.269948635963254,0.9436652765073735,-0.8630578296086044,1.432677848823922,-0.2545690282302922,0.6082947801029294,1.366631608534131,0.4506880903991331,0.8025000921611396,-0.4452797819019425,0.1236115654555404,1.278342931682533,-0.2038774563455067,0.525763881780057,-0.649285444689635,0.2864295524226114,-0.2488914101126503,1.803280998495263,-0.7556955530772522,-0.4083569292565425,-0.07419291269103113,-0.1748417955889535,-2.06789890227248,2.238086037115076,-1.934366346470149,-1.38096124115099,-0.3119412757415866,0.6807756416402744,0.1875270655658629,-0.6452123581768607,0.1451990241926165,-0.3886996460640185,-0.8019107555373096,0.5990791724652644,0.1798835461666479,0.8181970328122168,0.7680201759986911,-1.803240299901482,2.397503709448933,0.1238684535279512,0.3677079638437247,-1.053598452839211,-0.5140589254906929,-1.718177748903419,1.119378141138934,1.798586246653504,1.662476289426669,-0.5302391423247855,-0.04432348026370211,-1.279347234318626,-0.1750460268677,0.3347098711146254,0.5272284812030718,-0.1603794406557932,-0.7765025715267181,-0.5541925924776178,0.6252638469754901,-1.670532629620213,0.2072751343179198,-0.654663196441393,-0.2234468956574632,-0.7143147900168025,-0.9589144359930526,0.3475815915683307,0.5278440407707432,1.087566383430522,-0.6278822973877767,-1.626069430082399,-1.395205540644886,0.7703512157070924,-1.494257673883014,-0.3079211046043591,0.8608110459014184,-0.3107311892428529,1.081472300642827,-1.139115633468145,-0.4223250506095904,0.9687855801653059,-0.197685296369187,-1.143204852667819,-0.8025224987306691,1.7015561119876,-2.140636318751437,-1.887230852023053,-0.1923841901026425,-0.09125446729971534,-0.3474714326913709,0.9438460559720213,1.068751211651928,1.47912774853669,-0.5370571045450278,-1.033485824357081,-1.130251303148366,-1.609222503058046,-0.4881688413506655,-0.6349741333446963,1.575805591739952,1.258368258539778,1.324465070350052,-1.163262785670572,-0.6109205850951114,-0.991920940951255,1.519792742737724,0.5334133421233873,-0.9985941233867507,0.3124852860536434,-0.7603212515539817,-0.3707286971566172,0.1808051498346658,-0.9157288586110209,0.02443494564549096,0.1977009815502685,-0.5679206286328944,-1.101630580546517,1.312232616668831,-0.9837616629555899,1.475311085076005,0.8193066795405606,0.4520351594307306,-0.5251015162367161,-0.988536522981984,-1.432832784359856,1.30087333054629,-0.8440923354776947,0.4957075552468024,0.8850710424737036,-0.911667800592508,-0.8315900202097837,0.1981003619815904,0.9455238593259718,0.3399307014386957,-0.5986864842382772,1.055616174027465,-0.8987332374562026,2.15331054612295,-0.7421374402878803,1.820516567486323,-0.1342061842370568,-0.3590544351252349,1.376026281258432,-0.03908964299318122,0.5918524578302577,-0.5668982820095699,0.3243191913452002,-0.09433329589891712,1.854777605791535,-1.426603314052207,-1.875097749267407,0.5045519308959115,1.520601271108414,-1.480725250641626,-0.8151683027608487,-0.2290628528647331,-1.147427703807222,-0.5113590578174921,-0.4633809233297567,-0.5143426322811142,-0.7914134424275907,0.06862513766543826,0.03851896059636177,1.147188183913926,0.3292664104097263,1.139590008955432,-0.4809855773868388,-0.3044359715547985,-0.914473864396122,-1.177093464411615,0.08231248855202428,-0.3227389685663044,1.107429917606457,-0.1824981071488835,-0.2275851952774308,-0.7209349160249623,1.773145494919764,0.6146117690542846,-1.259857273541727,0.2612040517149146,-0.5731029680539808,0.02426118263145734,2.508003898557683,-0.2489473859687528,0.139419394237078,0.1555119208413341,-1.457550783732783,-0.5964735297339724,-0.9876849971285833,1.034080670416032,0.3538803977620258,-0.406723223895155,0.1968037390653159,-2.273620070605454,-0.5464691141272103,0.638222866696305,-0.4557610610007756,-0.3104887742127326,-0.2086977981490575,-1.187830542338632,-1.628524112992598,-0.7642536758038154,-0.3745713879788896,-0.8383675325664617,2.384310285831686,1.233777788890599,0.2492727179287325,-0.3665477364488679,-0.6844808683143287,-0.4302647940983631,-1.007163644105331,0.5109508451142899,-0.797256549552679,-0.13284139129354,-0.3375598475627746,-1.109630937284885,1.947204471509048,-0.9867483066976485,0.3957072964642588,-0.7973783051793381,0.9395122632954842,0.0198286513154989,0.2351415305405117,-0.2352274819155799,-0.9514971973283565,0.7310765189012389,1.543856289816652,-0.8034285429902658,-0.7968061408754633,0.2009359172504691,-0.1637488112162048,0.3671987386261962,-1.507692213929055,1.881044902414618,0.0230947040206831,-0.1960030856684283,0.1704893485492139,-1.500979626897005,-1.890570247907715,0.4256662744802568,0.7052562282499391,-0.3243706638810376,0.8532990581854681,-1.62332294418569,-0.2679581552380822,0.8299110257550861,0.6603427972652721,0.2847929377739291,0.8400508005536695,0.5888241480968308,-0.05491409374682768,0.06786525637016586,0.6191350474668036,2.330197830335917,0.2834841112726388,-0.2062018168633175,-1.727792256851445,-0.4907074512661576,0.1660476419935469,-0.03617330296434317,0.03346957182025813,-0.9972262096197215,0.5329230739787871,1.62838343560124,-1.341167167510388,-0.7894666040393796,0.3788916631597477,0.1039138119150351,-0.9427217280209512,0.728756104752298,0.665603589624554,-0.4949418611005066,0.1857569035242587,1.322899530396654,-0.0953473474043175,1.222962244060943,-1.460399764969252,0.5190795683056937,0.593348569852028,-1.093647256128995,-1.231398569058375,-0.3290199941726556,0.7741510332829312,-1.435516876577494,-0.3176523240684139,0.2587527914714879,-0.6040728773986573,-0.553057542861462,-0.6828850623963353,-1.267814985668077,-2.058411452168657,-1.22317908305324,1.914486453391341,0.7209365431200614,-1.079376857330607,-0.07125404693293573,0.4072753675438069,-0.4286457518060112,-0.5589328897546245,-3.223738426374109,-1.691366529912642,1.792467083337127,0.07319114052851318,-0.1144057196882216,-0.9384275251779642,-0.3143554207419875,0.02547777473100959,1.423571936618225,-1.505893661729808,1.025882842604328,0.5642771893215927,-0.4913631374821133,-0.152880757158996,0.307037015301516,1.697165398083923,0.841510610032391,0.1071484657383782,-0.9461289772537103,0.1513702134944429,-0.1974816001625783,-2.210654428475592,0.08728542654465098,1.284547954913551,-0.2781681916530463,-0.8219560313205285,-1.655627588847921,1.309620966017664,1.494314903120334,-0.00707200338737791,1.354460126650046,-1.193517914555032,1.07690621419186,-0.7869623831633306,0.7776163724666142,-0.0789837648028682,2.167528288320301,-0.9662927339074697,0.3617310114107165,-1.021329729006876,-1.535338776709956,1.581927791767345,0.2164155524857484,-1.166943614564524,0.5254699722741939,0.1302435574805078,0.3333779351674594,1.564623138254337,1.239173374359086,1.064394176305459,1.449077990676396,0.3042262174930777,-0.7392868122561091,-1.267621202530204,0.5103076052013291,-0.4698535573020968,-0.6448461630642042,0.9113040811556831,1.107286885396845,2.111887831789346,-2.113942542744987,-1.025777302122164,-0.6377130523100897,-0.3955827395583419,-0.2304609399877667,0.6751588098662401,-1.480807146575282,1.206106542188427,0.1007277025373198,0.8873173696960702,0.9448361914586556,-0.8035602104870058,0.1577529883416014,-0.08699087941635202,-0.3940199754347243,0.6151384242679222,0.6106131048455041,1.660055658108276,-0.00879000505704342,-0.2062187377173365,-0.2229852117708131,-0.249342275815016,1.446384663179444,0.336303535935622,-0.3374945869051373,-0.3747868507476699,0.5347816487812787,0.1835159620797893,0.7111191598360588,0.3992150418952621,0.4658407102319181,-0.4266128092231495,-0.437672025670345,0.633470108063355,1.15704755167031,-0.2364662099146819,0.5530703402274407,0.111519346813776,2.071659201678501,0.5384305158872434,1.676710560763281,-0.130696224458499,1.821017660331772,-1.176201825305301,-0.9234237131820016,0.3887683972559156,0.2850512625261935,0.4831858683861606,-0.5020279754023643,1.01565815926795,-1.07343238245187,-0.86691574151664,1.23743918621369,-0.8674888638411705,-0.4679380807410065,1.441456191469711,1.164613909486543,-0.6617894876171433,0.6032104118882188,0.3698855403092204,-0.6407414150224887,0.2715433268624959,0.7828914328171835,0.8072577483393285,1.376435874081429,-0.291045660622393,-1.196841407560864,0.7876172242217065,1.369140577027412,0.1193154298296323,-2.642509847829968,-0.0750304918542854,0.09364042598676511,-1.819781531898426,-0.03221137394827783,1.704103931245005,-0.5122698980521435,-0.1515779579269149,-1.492748464167944,0.2575794384225092,2.666458689605074,-0.5059993864986917,-1.605160855612101,-0.5412468258904359,-0.8434367203830243,-0.9243659561282667,0.2521485869259484,1.223798861901774,-0.5351301016961153,0.4107744835770756,2.269408875330829,-1.638567530969834,1.167860935289929,1.546033626624776,0.394808974885161,1.84554735791456,1.057850028452135,1.130070215519319,-0.2609716071035233,0.2455505601414437,0.1026982741756757,0.9869310955789969,0.07975197342628984,0.3018688376302284,-0.6901997939447394,-1.63568510437995,-1.012802298538647,0.1751215231450303,-1.714904824178852,0.01411230421612339,1.390250387278376,0.9661098132543782,-0.07544029137147108,0.1828441136815298,0.1969806591881038,-0.5934306684863758,0.56392834653831,0.3802616345533059,0.5130635321386093,0.8502154071079772,-0.4553579265035664,0.003488943432721883,0.8856833711687169,0.1586165485746255,-0.8319019232178585,-0.0566182913499098,-1.303820027384814,0.9556112450691072,-0.6301490580168004,1.111418928083601,-0.5636644777972453,0.9342176902497664,-1.125943404134168,-0.9807796643528237,0.6672214451096611,0.418487466071339,-0.4278461010294112,-0.4721798142152387,0.9927475392444476,1.744702939617486,0.7931517766062336,0.2983041131778264,0.9618561879718572,0.9234423508461492,2.045202500876572,-0.6561772682307867,1.702354071798158,-0.110825955195231,1.535828793634035,-1.368512769874906,-0.3469319096176546,0.5396409277033358,-0.9684394441709209,-1.442521841448738,-1.237634619508474,1.6795879831595,0.2726799760353703,0.4564470428145835,-1.303070473605968,-0.5536568807956426,0.8605879911052514,-0.2960572104508807,0.4718196727455867,-0.9082729484774702,-0.7484870448921952,0.6131927273549587,0.9773672916935139,-0.01616547198485052,1.252388974125004,-1.693908613416821,-0.3940809856110754,0.7599719581082282,-0.2780910534245075,-0.9248643508555012,-0.2682075517384933,-0.2155982468468442,-0.3629660501972432,0.9482454346513558,-0.6620941479113718,1.000442654411092,-1.599834566057828,1.306444405935162,2.044996759893505,0.4791040406933377,-0.3306980277638882,1.725118812024481,0.1784947231284363,1.022768308839797,1.468414922482704,-0.4840744275015582,-0.2290172895732911,0.01748328977558245,-2.378420114410869,1.156738711633427,0.5715715184611493,-1.183138916301688,-0.7080570786791404,0.0369693457453103,-2.305919833493381,1.197204450391074,-3.005172065284322,0.7287767914178148,1.724416697690985,-0.1296072206026219,0.3363306850515719,0.6188752776258353,1.616342049932124,1.056915065921823,0.67844793678334,-0.399116566752051,0.3142440966799594,0.5394173662335917,0.6619137574409724,1.131919047750583,-1.57718251310518,2.550057568042572,0.6066362624350622,-0.6566599702187945,0.7970726287265045,0.5036180035692316,1.609024860299545,-2.530775145632554,1.524709329157509,-0.256726109023609,-0.5966412263522408,0.8973806905198176,-0.750191221778443,-0.2703693863624775,-0.3985308244618599,1.129715479357148,-0.4160420803685705,0.5911733018018591,1.408618600944277,-0.0637971277554633,-0.5122921815974749,0.1767641174758287,-0.8229453518778195,-0.1495298607558412,0.8388292867082547,-1.472947393750016,1.582037053130204],[0,1,1,1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,1,0,0,0,0,0,0,1,1,0,1,0,1,0,1,1,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,0,1,1,0,1,0,0,1,0,1,0,1,0,0,1,0,0,1,0,1,1,0,0,0,0,0,1,0,0,1,1,0,0,0,1,0,0,0,1,1,0,0,1,0,0,1,0,0,1,1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0,0,0,1,1,0,0,0,1,1,1,1,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,0,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1,1,0,1,1,1,0,0,0,0,1,1,1,0,0,0,1,0,0,1,1,0,0,0,1,1,0,1,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,0,0,1,0,1,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0,0,1,1,0,1,1,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,1,0,1,0,1,0,1,1,0,1,0,0,1,1,1,0,0,0,1,0,1,1,0,0,1,0,0,1,1,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,1,1,1,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,1,1,0,0,1,0,0,0,1,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,1,1,1,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,1,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,1,1,1,0,0,0,0,1,0,1,0,0,0,1,1,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,1,0,1,0,0,0,0,0,0,1,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0,1,1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,0,1,0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,0,0,0,1,0,0,0,1,0,1,1,0,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,0,0,0,1,0,0,1,0,1,1,1,0,0,1,0,0,1,1,0,0,0,1,1,1,0,0,0,0,0,1,0,1,0,1,1,1,0,0,0,0,0,1,1,0,1,0,1,1,1,1,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,1,1,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,0,1,0,1,0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,1,1,0,0,1,1,1,1,0,0,1,0,1,1,0,0,1,0,1,0,0,1,0,0,1,0,0,0,0,0,1,1,0,0,1,0,0,0,1,1,0,0,0,0,0,0,1,0,1,1,0,1,1,1,1,0,1,1,0,1],[-0.5685553067216649,0.04573209585491138,-0.7898785553904419,-0.009774541579129697,0.3769212494905623,-1.361689637630347,2.216501123947421,-0.6043540135453989,-0.9324762841334446,0.8594622303647147,-0.2023501010568644,-0.8036741622545298,-0.3780319426831509,-0.740227514921297,-0.6577170798338966,-0.5514330431995358,0.9718749407159264,0.5029889039429178,-0.2692808605561593,1.161562202736691,0.4333314082726659,-0.6408718901165501,-1.864838406859703,0.9624692903586278,0.7721983267897118,-0.3471482142060213,-0.9223917993769866,1.286771965373191,-2.006733915288872,0.8802677494100705,0.6059094434817525,0.4753917322817804,2.423081798155092,1.240022696835667,0.4682078925122955,1.43310115735425,-1.500330592867169,-2.235053287922768,-0.08603103591885863,-0.06201176447693257,1.073458717933332,1.361949439507996,0.8642650839463809,0.5336731974553202,0.04978515259639649,0.2290813214266241,-0.8222198204570681,0.09943434403024058,1.186001442026156,3.213023119023051,-0.02917133093655329,0.3888455692921775,-1.879447235560231,-0.02409687758702792,-0.6312947657406878,-0.4376710838267833,0.8517948425910853,-0.1271301901692833,2.166038774660349,0.1889730587139194,0.3147262471437454,0.5452794868192204,0.3605440165746941,0.08097729712149339,1.507157645769746,-1.709188130492326,1.076592389781579,-1.039687128603291,-1.365650439361786,0.3808012081855328,-0.7289205397643531,-1.363974438055826,-1.79498804796055,0.1045301120123705,-0.3370468706171711,-1.35019718551455,-1.874932715649888,0.802895356712921,-0.1856782338018546,-0.2782202785105107,-0.7196953776009326,-1.144205332567189,1.167073532648066,-0.729661222704041,0.2534505235237026,1.438633260174033,-0.2513101523882448,1.608602781830207,0.9947040899343341,1.089448709628836,0.4324510613286507,0.2878666145920092,-1.350661484692412,-0.5992608704551187,-0.7176526405963123,-0.2920563138355574,0.2841689686121744,-1.914506585932705,-0.2880030813510594,0.07322756038005081,-0.5666737587773867,-0.6518438253654031,-0.6389228351861307,-0.4430404402748909,1.056115524387184,-1.364721896925227,-0.07533977883281166,-0.6305794131083836,-1.02038149998433,-1.251200109132869,-0.6927715393189774,0.7050985881238816,0.6895897981495445,0.2066154065113594,-4.198595960577737,-1.272242569408145,-1.368428806466822,-0.05433600667845023,-0.5011269057655487,-0.6214866430788747,2.018102965900034,-0.2290687896148349,0.8840223519731334,-0.7016193124207408,0.6508426738423509,1.503719468164714,-1.546565470319139,-0.8179219295032613,0.9933253667189693,-2.065296192708059,-0.8536542721855148,-1.328223187829069,-1.078770396168954,0.5561776582117102,0.2586225591724413,0.1658651699886522,-0.8785528642153144,-0.0759453979215491,-0.1782742762494697,0.9945823010085859,-1.119241280685418,-0.2227792872636653,0.8375219751062455,0.4418460074009986,1.689588883021446,0.6592332007676183,0.1208677272371268,-0.02140390634873062,-0.2031399880611793,-0.5686637323484619,-0.05042758357986241,-0.9289238183264465,-0.5059771100389873,-0.363450189953767,0.3371580107049464,-0.4894720842204886,0.9787255684574727,1.025720636683357,2.136975276044863,-0.7593035310552474,0.8741806781354222,-1.398104438635711,0.07325191705992749,-0.2393016483145183,-0.7177155932847109,-0.609190345244445,-0.4650789250469505,0.750266031903901,-0.9935282235492895,0.08527522376004051,1.301410961456966,-1.477256313301994,-0.6096136571735683,1.333964453730966,-0.5840526507343847,-0.02788559157884774,0.7575859284930234,-0.3040846826226201,-0.8993833823767611,1.96535722576175,0.5995048644137524,-1.055505572922065,1.2848900657519,-0.05765437811447186,-0.09445124285521654,1.702403046097459,1.147343721536546,-0.5272628745126785,1.453845914323028,1.329160020185808,-0.3838097024189542,-0.2176756820799184,1.131201831855193,-1.469295085911514,-1.051524853684316,-0.1004321139981746,1.17243281798394,0.4012578277607892,1.086989635928556,1.415928402751724,-0.3340796662891943,-0.1584288017073859,0.6910370145707426,0.4132868503849659,-0.745506255211461,-1.181018318688474,-0.3991287927265048,-0.02504753256176459,-0.9981449945768005,-0.2947317212444797,0.563008327375571,0.292932683790493,-0.7287792309063376,-0.4499266047251751,0.2435765085776224,-0.9342759647555421,0.4692551663899386,-1.451656492933503,1.119088100666054,1.19395093120175,-0.5702069716412903,-0.4843573902770435,-0.865910715369774,-0.08201080498699249,-0.3445989737081906,-2.275095373998673,0.4008164662573076,-0.738630521957778,-1.12456281832688,0.417590421607024,0.07331518366708142,0.1154556356884244,0.3809642630977543,-1.679804859910365,0.3999770955423147,-0.6685260176551812,-1.023683689888801,0.8545274602990071,0.1124116287721316,-1.364231659173407,-0.1413009194479936,-0.09510019146624338,-0.3957446468972733,-0.3670968351579914,-0.5123545003606351,0.3497293456190266,1.15442042986722,-0.006207406064801289,-0.2474896655508599,0.2754219349493155,0.02664050469356524,0.6841760537887749,0.5099469025894042,-1.37487906365687,0.1653517579510979,1.252131391425196,-0.746205528343675,1.264986122617804,0.3217463005485086,2.74279331378124,-0.1653560699822004,-0.347284136740853,-1.822812965437477,0.1650507779184266,-0.160760001677395,0.2063681019386218,2.072816954434388,0.8654121188383171,1.541917124657328,0.6535069992434318,0.2925902629699992,-1.734145590160465,-0.1408056486364186,-0.6902111463426659,1.116621752397108,-0.06585036177629024,0.05784854684762968,-1.952267867286977,-1.438163982303098,-0.9829330923324007,0.7941113621355417,0.3723472809526769,0.7291698982071838,1.01028343889879,0.03943767186164881,0.7314304675283736,-0.6419951007185292,-0.2208986899040692,-1.880558957446212,-0.1515987492983201,1.313701385667389,0.0660767513505529,-0.8311305515402457,-0.7396625114366853,-0.8125579040458829,1.301835515356777,0.1854617185953963,0.4316436955754868,0.1203776629971757,0.9507057952410498,0.1266191074716884,3.091003555185469,-0.2702487136360524,-0.9443830970953333,-0.1559222105720675,-0.8144266075561623,0.2232052702910102,-0.1700543559577703,1.331556099472835,-0.2085394868666633,-0.7652569596106654,-0.1253965810809485,0.9353788655892492,-1.59484435025564,-0.4181498647442625,1.083196187272048,-1.630500173941472,-0.4256062406475903,-0.2987656892563023,0.7525588085748922,-0.8344632798860532,-2.053057143750938,-1.014136448566623,0.06501637706669194,-0.4648008582767253,-0.622275989593518,-0.719676226635813,0.3250495695653623,1.589010548537872,2.283815136002117,-0.8112658282213056,0.5777492521674458,0.5559030183209691,0.3776907629918168,-0.2159431609742362,1.020312705992663,0.1406202101072881,-0.741307643931166,-0.8387559985391054,-1.142590356314967,0.3265956981564686,-0.4409696228194492,0.2154855174471892,-1.036547616306387,-0.6529257561536818,-0.5188730448330772,1.073730090308982,-0.0936080288928765,0.506620303684007,0.03680014133064476,1.216953842330192,0.2563077620724614,-0.7156686905041703,1.638654753999154,-1.146910217190486,0.1738883180451353,1.614081981984609,0.3235808622245756,2.439560673187396,0.3859244858154229,-0.06710215773339286,-0.9388041387102156,-0.8841807898812387,0.3268448753369042,-0.6848673282557093,0.6628100440629465,0.908296566119459,0.2190295766636311,-1.058151514486096,-0.4294716265269872,1.085555391220517,-2.199685084593357,-2.021736985372286,1.699660756419077,1.731076420156736,-0.7850077096216328,0.6100123513106874,1.273330036342431,-0.4036541697610036,-1.404174574068158,1.804547041786934,1.76738744929164,1.5404007769729,1.153173855571497,0.2773770240791552,-1.208009069330346,0.8824972442664017,0.2675804655511599,0.4157082513248773,1.240315312516422,-0.8154084519303372,0.04944542258980004,-2.882189923150213,0.4027025156461762,-0.4500733125657491,1.654424921874083,-1.412685886559902,-0.3513891824653289,-1.068905458214477,0.4928771757028305,0.5081367585793058,0.03399987819069768,-0.5971533887787389,0.8998332159595877,1.137383409897941,0.7486535750676742,2.502546791768004,-0.9869282013823865,-0.9851011234292707,0.3538710758190141,0.07668102646347881,-1.136441739032562,-0.6304701189735251,0.07553558485116807,-0.8102231787367323,-0.4243977526892894,-0.879874075742498,1.322106494127088,0.6367295009766895,-2.177398260476235,-1.214829135397517,-0.3935100325274019,0.3690545034264679,0.5574163220155173,0.1084888775308616,-0.6878190199543025,-0.2013292115859915,-0.1301001673067779,-0.4149450702532124,0.8386372842300761,-0.1090216318991095,-0.4566089053069385,0.1641094575449169,1.419898485318279,-0.1080042676163841,0.5814247763536405,-0.2995629939529613,0.1958238334456383,0.2195108056550137,1.365472896114134,-2.166039249543985,-0.8842276236557743,-0.4559901324895547,3.074229566829942,0.632556859296731,0.2166315850249363,-0.9044258200748809,0.02475382186808169,-0.0547746237033685,-0.1751474467946034,-0.1271230022733518,1.608178400733129,-0.1256155135201647,1.662198594514163,-0.6434515382671974,-0.09899672179625933,-0.6422845306025937,1.668229089505596,1.093969472194167,1.877113054704792,0.5113513223067101,-0.2053505130208745,1.993661134819686,0.9016186501310508,0.9892433625305158,0.5540070490997159,-0.6400027727419675,-1.070723692032105,-1.533806724481835,-0.3901346399528532,1.249024527994851,0.3677867189355061,-0.8345776405794381,-1.158367158096825,0.6636942983588486,1.276321045167423,0.5233690371982267,-1.80391520118503,-0.4761518290087282,-1.543139824714101,-1.653134650450829,2.047628635406007,-0.4142719679864365,-0.1456162424367856,-1.089014608631121,1.736628521991889,-1.326132430769808,-0.4974829147217099,-0.3421432760671939,1.395268979484096,-0.3804982907983171,0.5571743152954211,0.09979215038478993,1.914343956366482,-0.8261845853954355,0.3705870541935556,-0.160172971357649,-0.4614057497959316,0.6376009568779304,-0.7263414971786223,-0.6648542316778959,-1.5905433845018,1.691410783851906,-1.337324575583327,1.110392944163775,-0.8576003251773973,-0.9876041811789205,0.8376377127686739,1.533616625610811,-0.6983794790351316,-0.08133686363244309,-1.008158454082105,0.1212064008561794,0.08396031728973419,-0.2870680297471455,0.06393292862927387,1.707862729381887,-0.295506498686701,0.1209765062309427,1.394021224393261,-1.43088227085155,-0.3969736674968273,-0.9196872249044959,0.9482314807312826,0.007079660487231009,0.9449023931011569,-0.1852422360080957,-0.5241994380601235,-1.977752609861855,0.03104552373730186,1.72899563961797,0.3614811249007825,2.608407843655957,-0.6103949502453365,1.131219307322338,0.4736272385656153,0.1582665160547707,0.9111057219626705,-0.03938796565287817,0.7968705857652403,-2.121260667949685,0.4938488832578229,-0.239381785674005,-0.7235746803924412,1.472716282854113,-1.166666754468794,-1.133835682803657,0.9753772589359511,1.46501344545631,-0.2170001540281416,0.7351513878180093,1.679056887081732,0.5206234975980416,0.9184508878210625,-0.006213459826409129,-0.8097762808960419,-3.087337905013764,0.8864947208426147,2.112211718163445,-0.09142921471680908,0.2991309316867762,-0.006050495234676314,0.5869093652570609,-0.46957519747202,-0.5235904171591522,0.4996199378178539,0.1502686910224082,-0.08434694657962427,0.2937684884287456,-1.971504769063994,-0.9460083906720034,-0.532272811943167,-0.4078445884678885,-0.1720833608559367,-0.5996327054937062,0.3846526035545927,0.1736757899672919,-0.3110866340627486,-0.07986289020097571,0.6873620775010004,0.2832024286959082,-1.689660711869103,1.294056883104121,-0.8377934569202536,-2.080972803984485,0.680692985855009,0.2919252244631136,1.271503338917515,-0.7358316900797945,-0.9071971729822033,-0.5282078263955455,-0.3084307192896381,0.2195387376787665,-0.6073015894816208,0.0910188061376816,0.06278399190120083,0.09437974498214938,0.6203010566354898,1.542085187347538,0.2225409998641579,0.9252443471326679,0.5322725048453916,0.3647129467708764,-0.6576054923497925,-0.2876384886345547,0.6373157618582552,0.3975992015148096,0.2926876091551514,1.014096119814634,0.586442704516287,-0.4181705934911448,0.5778044697132043,0.5718345152374296,1.614950064726659,0.1987448665630784,-1.306766769810399,-0.488533253101883,-0.6544001391002613,-0.04154372064769325,2.557503033500216,0.812767009099061,-2.001476117572115,-0.6031043563838132,-0.3744044079968096,0.8742914699381854,-0.05790101902760409,1.144737713170892,0.2800882031939739,-1.965383424041958,0.9568634189133602,0.114335905597645,-0.167820817604346,1.006802097555461,-0.2978303155916803,-0.7810247781187439,-0.1318445888995491,-0.2042933917346076,-0.2353667392982528,0.6938972949033376,1.031700125666596,-0.5309403486175184,-0.5156836925501539,-1.213095284897346,0.9140991933569012,2.441138318327564,0.4264710978401029,-0.1016928963727586,0.243404626096051,-0.04053799699908885,0.2185399709165143,1.05355508103076,-0.2541886477855319,2.045392552468472,-0.9798508737835067,0.9657350439392447,-0.7760062627907043,-0.007956239540028042,-0.8140294824120698,0.4164566656517111,1.047049409811848,0.1764753889144762,0.8908707687137549,-0.586990040774256,-0.882375977834465,0.3357418355863649,0.6296176663948054,1.012196804209501,-2.684592292358494,1.832786909674632,0.6510862006696007,-0.03344714279938891,0.3458117168886553,0.3632081199264298,-0.3455151873314548,1.231751663925444,-0.2741887258250024,-0.09736674320253574,0.1210842411862417,0.9238506068029562,0.3124864091119732,0.5895833889920783,-0.3301329004919543,0.1234625906695691,0.2852400129207147,1.783366566943047,-1.043114532994269,0.8884130050694319,-2.154107226005471,-1.328260415106789,0.2771117828904083,-0.9171306390781012,-0.9694985649011958,0.7157510862510313,1.563167893650034,1.116986249761304,-0.329174231950528,1.118135648747668,0.04066165787794579,-0.7165192361020944,-1.376724977343251,-0.3763186079610341,-1.351928465502076,0.7575578006345971,-0.3850735902214048,-0.1084624279335194,0.009600145556594311,0.6594804272735866,0.05550870978425327,-0.5577553128077642,-1.30128620173538,-0.4241525337029334,-1.474281367925812,0.1512880483569645,-1.241717590230857,-2.048468480100052,-0.8543979129207044,1.862368822821454,1.725245673720236,-0.6723746074898601,-0.6688143587213601,0.958127900624851,2.249843061598743,0.8204630339578423,1.480296958692915,0.8226124414781146,-0.1663381635285194,-1.593866429964161,0.5930518496171284,-2.44754007176162,0.4549714922868862,0.1323317349948763,-0.8805601477413735,-0.7877546180383243,-1.051143676622139,-1.385710409953244,2.116636140215001,-0.8688434490279685,-0.2216072153076289,1.380836178207733,-0.7266481446105966,0.1538021611850986,0.03378925828331836,-1.144653842997599,-0.5940340695746709,-1.820655617448922,-0.1015333078487581,1.594464641911387,-2.210148342592836,-0.1793025115776464,-0.8260031580094919,-1.177773425455531,0.4374481812964058,-0.3213566741613891,1.181439728530194,-0.2083583773511815,1.99092459239447,-0.05372965065572322,0.4379866016661009,-0.8385964296086383,1.608312303130758,0.3798113917398998,-2.120976554823767,-1.338567220221605,1.437094284125487,-1.074222899251585,-0.2850147543539377,-1.211859851033561,-1.320844561604795,0.9000408797100122,1.756125750980654,0.2003971545383776,1.019001943345924,-0.8555446633794828,-1.34883997704852,-0.8966633466441941,-0.4802522422409719,0.07321482186783261,-1.510377882499638,0.004754225388463401,2.095881753714353,-0.3040039259404836,0.2319058037897743,-0.603063121832346,-0.8368118002150443,-0.9593054284587589,-0.7082245137595481,0.4481895187026907,1.088993220286973,-0.2654264770511607,-1.060580396362082,0.105746273258557,-0.7560071421416427,0.1743839980081373,0.2175962629999096,-2.129266132996348,-0.6636818356042218,-1.592900690326611,-0.01294989984059794,0.6612336062458681,1.058211832928249,0.1715170429642081,-1.64839978580582,-0.5270246728836696,-0.004857300204931928,-2.19079437264366,-0.03091419061648307,-1.086866594505715,-0.02972511743146481,0.1395818976449485,-0.1501235886866337,0.1629691128168291,0.8882528236495481,-1.492525796626969,0.8069432070326665,0.04068190274753089,0.7590307630166445,-0.4604773026872656,0.8307399953981112,-0.3108172867529962,0.1787550226068998,-0.1125810557199564,0.5064437752718952,-0.153922579567623,-1.349581800937657,-1.344394472752029,0.4002907139120968,0.2564790880504652,-0.2937830935907506,-2.081379597951509,-1.877952335567845,-1.655476387073762,1.732715293101777,-0.1429014234667694,-1.113889623544567,0.7737017763597611,-0.1431826494810145,-0.717643700169234,-0.4205176040964296,0.1881065139440053,-0.7738246770419398,-0.8061985417751057,0.7722191422073595,1.05045319959829,-2.372943489522207,1.019863163603699,-1.619220852423585,-0.7043848400379309,-0.334293046524143,0.359195427070567,-0.5151915195547943,0.4136072696708703,0.5642790150906802,1.405120645924623,-0.1163184070239612,-0.4746190346892936,-0.612661942877173,-0.1211809914358642,-0.8302456828709955,-2.250298995719375,0.1549648559256898,0.7120086551414063,0.8440832360109446,-0.9332552132587005,-2.368916393076676,-0.8780583409536692,-0.05123703500022223,-1.20264640542618,-1.498371378168135,1.424907168297148,1.281853508990721,-1.943505638655972,-1.868968435154978,0.5747891599338448,-1.473142167745901,0.533886353235172,-0.1628951675503352,0.909397590887451,1.829595452435723,0.7008643598047206,-1.637818428221216,-0.05143773080945111,0.8217348471904364,1.450631196737207,-2.216751189438013,0.4349203804703002,-0.7520949043834613,-0.3204734960605383,-0.2427532034728943,-0.9450923110287636,-0.4379588527097935,1.146546640656949,0.1276452075002812,-0.7026187419903431,-0.4524395838595127,-0.9024725820540581,-0.2860103280346452,1.415607897906889,1.367859105257414,0.4133845312018354,0.914960921875727,0.2333154377079935,-1.188395502430607,-1.044652307025776,-0.4470201981646876,0.04623687197296347,1.887576620820575,-0.24099390688005,0.9459382992699926,-0.2003245614053782,-0.2482331408603503,-1.307993173432336,0.6771515587343837,0.09463816358189568,0.3039721441200107,1.228865384166476,-0.4705005475360433,-0.605476965466661,0.3338829164707139,-0.9886213145669926,-1.00822029354737,-0.1918156171642817,1.307742995887427,0.8738507782066572,0.2704989420859176,-0.6534932071017552,-0.6529202182667403,0.2886465127773057,-0.09854047621388362,-0.8543433258515336,-0.6073082743774096,1.357399742027449,1.254946812040812,0.2297360463640849,0.6542654381283152,0.639816186907838,-1.059730044306943,-1.521821070092371,-0.5897788265425042,1.50112386933573,-1.408697384660176,-0.2346238429201818,-1.033220640201225,-0.4421943326558298,0.2644732379989286,-0.2521812694168541,-0.4668308695959615,-0.08607705066256091,-1.557315178999796,-2.153140352736077,0.8913775316216821,-0.399305798776674,-1.349331108697986,1.082592982257576,1.772941215303578,0.7817686006450472,0.6899962412073597,0.5520407370326205,1.118695794634225,0.8378618018525464,0.07502322936693426,0.3861058767931359,-0.2976446786823781,-0.2282755721832154,0.3323528817727433,0.5659042893741852,-0.8196564141592989,0.4753859688520275,-1.249658455255512,-0.5444285329785458,0.2210479125970959,-0.4457727595030763,-1.792487322366199,-0.2966398539399128,0.3025858011474281,0.6027840589136597,0.02210782897674742,1.12888700118759,-1.193145816648133,0.9165529399232191,0.5036600145519444,-0.9782107941562082,-0.1580616760139819,0.1520712942336878,-0.06515037158708747,1.095236116847404,-1.300187670088977,-0.5859687278003809,0.5271330918585357,0.02850339633270637,-0.7673430571344347,1.326112557300167,0.7717721452800727,-0.7686404802303956,-0.01349183264930518,1.844817304780036,-0.159946666457309,-1.684529692477942,0.06790940825949073,2.062197845542115,0.4364868262401448],[0,1,1,1,1,0,1,0,0,1,1,0,0,1,0,0,1,0,1,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,1,0,0,1,0,1,0,1,1,1,1,0,1,1,1,0,1,0,1,1,0,1,1,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,1,0,0,0,0,0,1,0,1,1,1,0,1,1,0,0,0,0,0,0,0,1,1,0,0,1,0,0,0,0,0,0,1,1,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,0,1,0,1,1,1,0,1,0,0,0,1,0,1,1,0,0,1,0,0,0,1,0,1,1,1,1,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,0,1,0,0,1,1,1,1,0,1,0,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,1,1,1,1,1,0,0,0,1,1,0,0,0,0,1,0,0,0,1,0,1,1,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,1,0,0,0,1,0,1,1,1,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,1,0,0,1,1,1,1,0,0,1,0,0,1,1,0,0,1,1,1,0,0,0,1,1,0,0,1,0,0,1,1,0,0,1,0,1,0,1,1,1,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,0,0,1,0,0,1,0,1,1,1,0,0,0,0,1,1,0,0,1,0,0,1,1,0,1,0,0,0,1,1,0,1,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,1,1,0,0,0,1,0,1,0,0,0,0,1,1,1,0,1,1,0,1,0,1,0,0,1,0,1,0,1,1,1,0,0,1,0,1,0,1,0,0,1,1,1,1,0,1,1,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,1,0,0,1,1,1,1,0,0,0,1,0,0,0,1,1,0,1,1,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,1,0,1,1,1,0,1,0,1,0,1,0,0,1,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,1,0,0,1,0,1,0,1,0,1,0,0,0,1,0,1,1,0,1,1,1,1,0,1,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,1,0,0,1,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,1,0,0,0,0,0,1,1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,1,0,0,1,0,1,0,1,1,0,1,1,0,0,0,1,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,1,1,1,0,0,0,1,0,1,1,0,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,0,0,1,0,0,1,0,1,1,1,0,0,1,0,0,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,0,1,1,0,0,1,0,1,0,0,1,1,1,0,1,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,1,1,0,0,0,0,1,0,1,1,0,0,1,1,1,0,1,0,1,0,0,0,0,0,0,1,0,0,0,1,1,1,0,0,0,1,1,1,1,1,1,0,1,0,0,1,1,1,0,0,0,0,0,1,0,1,1,0,0,1,0,0,1,0,1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,1,0,1,1,1,1,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,1,1,0,1,1,0,0,1,1,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,1],[1.668531435930096,0.5603068952327777,2.712587360408608,0.6012700085493539,1.44771065136448,5.202810613594322,-2.490120447769446,-2.321057605041767,2.193837298115392,-0.3063635952968879,0.635791441816898,-2.675008653835181,-1.079294246418487,4.15714998654454,-0.1857181971855657,1.2943538361369,-2.193148623698839,-1.618221959720914,-0.1422053217690578,-1.817644612290818,1.568402202257731,4.434868687610308,-0.1441562742531795,-3.346505146600582,-0.5177236952667703,1.611832862518491,2.220539041326645,-3.502393791416532,4.047279670656272,-3.199214390988685,-2.445413188563253,2.080374562918441,-3.122411988301404,-3.291506693567781,-3.544749593101737,-1.050269828374778,2.739504971463882,6.87861413939999,0.7393172449305627,-0.2590851870092975,-3.591895995190322,-2.284374000459811,-1.551069990365894,-1.889745448441239,-0.05745392740741706,1.83153705265427,-0.4714710459736811,1.762689437922739,0.3296685845520442,-2.78928258760937,0.8379075756179235,0.914642790554457,6.412548041052497,1.203197775287918,1.440643889992524,1.869458974669315,0.3501331623601829,3.030143648383677,-3.279202178819764,1.722311181555628,0.9139433517706179,-0.7999894423476618,-1.798120197096689,-2.274615399841929,-4.583182437141146,-0.5079583775343923,0.3292909284157019,1.970781732393863,1.271512917726856,-0.5977180217740918,0.6135195836992557,3.201255534160908,2.095892522994751,2.885155472667022,3.827640157042674,2.242036847164629,6.382838166083455,-2.543032863743555,-2.902754519832825,1.508045083256128,2.078605773301765,2.020601539819956,1.282720067361684,2.454297695433488,1.143065131480488,-0.6572675169241675,1.550202408907914,-1.476232543440924,-1.83056387073894,0.2880834843995446,-0.3282595445114689,0.215797265293972,5.073380201127323,2.259166484684785,3.649059838161648,1.629667175170449,0.8035357576667412,5.810499309387733,-1.524846159176629,0.2572071489737051,3.524596457660244,3.238980466579167,0.98265489938335,3.226389709656321,-2.729747857557859,0.02031034016721533,2.45230818607644,2.004324589836449,3.130484022937028,3.808116541496541,1.92931861717689,-1.656311585903304,2.916080702724507,-1.615228394824062,5.613682483635414,2.823909777295222,1.2031610101496,0.2079036968513504,3.599632038507563,1.908282411644222,-3.863646647431507,4.805834379366616,-0.8306510905158264,-2.275180494876297,0.1143968494899328,-3.760468473690752,2.719446764991154,4.066013443006899,-2.50499697473797,4.94320172702914,2.787047340525494,5.726510427988456,4.579136142091134,-0.5627960508517941,1.316527939954836,-2.596124012927991,2.266097694352328,3.512336769102551,-0.331511144056109,-2.462229242332473,4.909270451696703,2.559152461846073,-0.4553828828313261,-0.9939090226238836,-0.6804955129353276,-2.775409904420759,3.253911298012122,2.117701964883309,-1.258601577946947,0.5149800743615445,-1.173349786074646,2.90494591384691,1.915458524941156,-0.9016753237194691,-0.2341438677156429,1.443850513193095,-0.740098706159331,-2.272652845239306,-4.802793115564852,2.48640149467049,-1.034356978557229,1.356492989616932,1.700303747872652,0.4327401360299912,0.8373209740218458,2.913061545351182,3.776958000322935,-1.938822134753005,-1.186398524727491,-4.679680264434664,-3.725265703196439,5.262117424084059,2.615577165895686,-1.557704395367146,1.745161975200952,1.072408302720389,0.5899546066815036,1.003691602322106,6.012576814744301,-1.610780475310002,1.239663949408457,1.129872733786963,-0.9847005876484514,3.313171156404163,-0.8897469033186293,-3.013286966285464,-1.730584245540255,0.4508666534961817,-5.011049487026765,1.453015474599703,0.3083181909743787,-2.733048901168559,0.5231387352841311,0.1302899327967524,3.4365817999343,1.261606869884704,-0.04546850399449331,-2.369302695259872,-3.851758224409554,-2.070529181575296,4.270395333558884,0.9869688566998067,-0.6329414341138415,3.984425118570584,1.925677113484955,3.555886562600052,1.459882522723357,1.411118182056665,5.293270692373485,0.365098970587571,-0.9699190098996557,-3.069760346905328,2.80008057124041,0.9919782622603915,-0.5305602490045066,2.806054069351187,-2.256645864244133,3.637114638489789,-0.6140912413917752,-1.570103112278062,1.591324927827454,1.365047401354566,4.634166283511139,-0.3840625038284742,2.592157682495239,7.799661939311131,1.136222110660943,0.7070938696740593,1.0112674586377,-1.362027459017528,-1.350776412131817,1.180416015201776,3.440035061621213,4.740215380902063,-3.575833498836447,-0.9984040191184284,1.714366941967045,-3.121797740896571,-2.156165532000776,1.22661128472124,1.247018357484076,0.7608027740877628,-1.608720556572624,-1.871374864513624,0.224298773160851,3.528617560632773,1.154825667689271,3.681730049973127,1.160616445985899,-0.2251354595167092,0.5705764180654171,0.1531075406216921,-3.841737459413095,2.117583000298878,0.6162318023593282,0.1031440134700765,2.203271319942091,-2.041302145063825,-1.801336766051775,-7.786843740452459,1.273973772527089,1.161118692354773,3.094420779042157,-1.218190543355923,3.920456351281548,3.68451323924891,-2.380426022892557,-3.404914701941694,-2.242725523787037,-0.2351196037807548,0.29622623203695,1.620178468673051,1.096818745314537,1.186235676773162,-2.762166374170623,-0.6094423020137127,-3.085750647605194,4.390864166666601,3.475822326029683,3.883431813583472,0.2214538024172064,-0.6426801621715744,-1.454766186510255,-0.405502723017807,3.311199656278918,-0.9820972645912724,1.296826927204585,-0.7164517460361171,1.504945417002584,4.016556191284269,1.906050135707476,-0.2749861466215729,1.339472734739395,2.185817487142556,0.4006296910321063,-1.880503781005694,2.915405675443309,-2.740580995739036,2.013133208170296,-0.6773622792265881,-1.845106893013612,-4.049480132364239,1.528489618395977,2.507220358360725,0.2102890064219217,1.378617998392286,2.684677393760254,2.70452922002926,-3.635823559266511,4.360091056255539,0.9281372829532827,-0.07424730708686322,-0.4555694488162945,2.487487578641736,-0.5563194107948791,-1.686601996996827,6.689691471838772,5.099187880987462,-0.002530543919172845,-1.972224802571367,2.292341445135535,4.573546748831742,0.2374276100885859,-0.442792210384751,-0.8757146331267067,0.9365076355128918,2.505776372131679,-2.160208653528045,1.228063397899271,-2.950941110506871,1.825828246696707,0.9794403231296704,0.8891497986978798,-1.569145951033426,1.472947010482205,-0.8632644665254607,-1.193850814381491,0.804803397267201,2.937089473073893,3.364712800906662,0.4953183303899373,0.7310262324893068,-2.25039022173177,1.458757484566154,3.37133299129973,-1.020602281489404,-3.48753826167488,-0.3864558313977868,0.02090790672158299,-0.7203453804627575,-1.933054998453315,-2.685437964193421,1.893076457859201,-2.438952581051857,2.057428712317654,0.7757415653120449,-3.934005825993936,2.649934135947128,-4.327697907078598,-2.361469053369494,-3.553180248161834,-1.53684653935743,3.514145156278471,1.377407258134014,0.5077823023380792,0.9176407783029272,-2.314567607241623,0.6780346129945326,2.860602192798253,-2.554479320016259,-4.602120889738973,5.655494593142585,3.040962104069237,-3.454742262739561,-3.690795457589739,-0.6029230082404603,-3.897088692986025,-2.128095230332964,2.719689483063493,3.526983201724044,-3.031074541803671,-1.925679523300276,-4.883903204747081,1.897533627916766,-2.198345163684439,4.730717467959914,-3.229751086018361,-1.229756573343205,-2.597757408799293,-2.409054542938441,1.524903618330969,0.2963281046882014,4.793062358818296,-2.63152388456022,0.4430402377967914,-4.035856886780997,3.616539923727465,1.755686089777499,4.03570487886307,1.768949617708145,-2.186914298969449,-1.022134196500937,1.64982113050455,0.397484829452774,-1.204598330133723,-1.161508261424561,-5.710730776412329,2.442043823301431,1.245433830911288,-0.5614451534366328,0.1997368446901058,2.761975537043444,3.36202034092238,1.878526248004182,0.6692558634934216,1.828648662650473,4.428131341086768,-2.634133759502451,-1.666875652038451,3.286556864213154,1.080829757524273,1.782338695126141,1.25549434972172,3.071642980652812,-1.991817448454833,3.982344237861575,0.4877927443746491,2.574441332841706,1.960507207257588,3.125977519509812,1.906833645927847,0.1286695990852127,-1.276467835974185,-2.915380227911413,3.075342913621641,1.08279579062877,-0.3738585620289453,0.2736688014356408,0.8201235065481038,-2.989164460191005,4.195576139579752,-1.460644414369934,-0.1388642893301828,-4.802106297835092,1.307683908349272,-0.2968603550949707,2.884122924404149,0.5356952262355055,-0.6304176073204245,-0.8553033515394554,2.203195021998843,-4.360766042124851,1.957927266558407,-4.735173399261591,-1.151901506518394,1.490008045430918,2.28243942075568,-1.302684057780199,0.2958078851241155,-2.371411332659685,-0.2438704305437591,0.881513036304457,-3.164262616929163,-3.834503400007057,-2.898486921439587,1.59474327610132,2.132748470167665,1.21969074800511,2.824345868784691,2.048596426420305,-0.7447909106433495,-0.1461213043823912,3.339498862807885,3.143474941505979,-1.56947738375399,-3.618922628605459,1.722068936594216,3.749556174994939,0.5623865534689222,2.132593605145043,5.373329644058584,-5.573547325305768,2.243537723458216,-0.06599209963322367,1.338080950197961,0.06603966865621314,2.025060907376536,3.95103168174556,2.718169682097941,-1.64817489380657,-2.126697706336963,0.2958770972264895,-2.781980027854776,-4.342739867872648,4.736553185678508,3.205414529983683,2.187463995061227,0.1174416911026608,0.01883207398215486,-1.194431010834577,1.423070661386481,5.134497145475662,-4.131106274691867,1.331446346170522,-1.974371271166188,1.343561612985293,1.518989533782387,-0.7125498260430572,-3.447606853424047,2.434719108173365,-0.1582386400027681,0.5276229562188128,-0.2950004479828722,1.640111326180543,1.743119326068997,2.547210420700807,-0.9597600186255617,1.204672900517853,-0.01848755773709065,-2.968824197241584,2.812623455055754,-1.847007055786744,3.499683980271923,-0.1741773054020455,-0.5340486785070703,-3.274359819690724,0.5857928890807289,-0.6156382481221256,1.527785015154812,1.231158113560156,-3.599217167648265,1.762037062935327,-3.862617164617745,0.5393758088258989,-1.147667546823042,-0.998607737795032,0.5866738063204624,-2.81862409082092,-0.3770537823872673,-0.212958640002807,3.396470565570053,-1.907966434264493,0.9173980321233607,0.4042287308849384,-1.204290565701042,2.898220288812706,4.597130629684889,1.379923421798875,-3.010708747959101,1.149947153771197,-0.6955780274943302,-2.283811688035068,-2.424973304360092,1.514861096061559,0.317009804526289,2.76583556076155,5.088487600175252,-0.05737432063490955,-3.802305058151486,3.183328400383476,0.3609780356607796,0.360905857709498,-1.399502456624193,2.242232056398596,3.541001900749156,-1.290175661573019,-0.2169513187613242,-1.572323734948876,-1.327576785572317,5.783596505915572,2.492933457814729,1.82897312182619,2.645069651803985,-0.7654493312658019,1.110505296400576,-2.204114809995985,0.6217286987890889,0.3709899985609217,3.508607942557459,2.377576777687163,-1.362016039171968,0.7584766909353382,-1.88920192266284,2.840873758048029,4.028448227762349,1.082192338814179,1.346556637078529,0.4109372802140012,5.136564402438378,3.543433443667964,-0.7223090508997065,-0.3534636275939234,0.9559584206226556,2.561477057802468,-1.796175306459533,-2.399217324041591,1.016949092243863,0.2490130890266975,-3.851110787485263,2.402920745937587,0.7361878273449922,-2.228628203504869,1.037906018853755,1.582497609352289,-0.03266721050618876,-3.85440938744228,-2.338260434347324,0.5749096557082638,-0.1902628746009082,2.190044993958488,1.632876531242683,0.5036048481986215,-4.029923492048622,-4.605451033199933,1.980035290842727,3.625862762323184,1.582703103174334,0.8146219777198623,1.781487569971699,-3.117707067116537,-3.839174970446295,1.181207114548611,-0.4494706620036775,-0.03207690486250869,-0.5723389303536087,-0.003832450373678409,0.248637179824621,0.4369745526103941,4.790138536537946,-0.2936571913754724,3.385997906391797,1.688289777730835,-0.2286473810971832,2.567841804569798,-0.7779235939383256,-0.03949805799995254,0.3990156046182701,1.67654137521913,-1.143327704494873,-1.104666073324531,-1.258029133149879,0.1260068463254451,3.478390001103795,-1.305475543368344,-4.039310400261984,0.9458313567847515,-1.052147819978281,1.606932709260497,0.8031620710929546,-1.886954564642562,-2.316616886001987,0.7647774812642956,-3.320374965680809,-1.038775454016251,0.4099604495900647,0.3247700123513999,-0.132676912533173,0.7599816828461705,-0.7827341363831066,-4.337943291958369,2.183349131529201,-0.8878979974998976,2.073750354401693,3.377413694361802,0.2780131726225826,0.6399942227748068,-1.562614405475536,2.83490211305464,-1.767897040340582,-0.901034898381345,2.165078528611618,0.2914040192771753,0.1161384418010979,-2.93694206097119,-1.287723327127922,-2.296384010327412,2.772462380138351,2.204225754442448,-0.3547587812064525,1.305264661332503,-0.5141411562984309,1.323926755312538,0.8511576886426568,1.159317161959469,-0.8979173990787593,-0.5468660081739607,-0.5389892634969373,4.410431177047563,1.580668632524837,-1.677861528755433,3.18717465559139,3.130660054716312,-0.1783768030218648,-1.735146635421128,-0.8469583689151876,3.573402331185007,-0.6511678093741112,1.300874951982682,1.205752347886352,6.016202143342937,1.635364080086442,1.851643543999244,-1.364628554681817,-0.2675173586833869,4.670477696176791,0.3916670181419598,-2.104920487556049,-3.547067375172618,0.9505710665753787,1.106755275694716,-0.6261670205923657,5.65258736942101,-2.638730581433708,3.995310783837042,3.286642926256153,0.4584074548182087,-1.250653887130131,-0.675101629992845,1.511135669458796,0.5544418112458168,-0.3870509710013142,-3.436275656431253,-0.544858951551396,-3.677789893341714,-1.861906766403362,-0.03465233521212285,3.826728365608619,-2.587511925318623,5.292779175208723,0.1973666279544601,1.370490893694672,-1.093453228357258,3.955491363121391,3.730682787302296,3.437898205540295,-4.0245102303003,0.6815830947623618,-1.071407593514574,-0.8285957000216232,2.347540540211458,-2.273134261395606,-1.507988564418799,1.690680382046267,1.354082114995812,2.501329865977095,0.4976156386738682,-0.1369680928128449,5.403843435735376,0.5691253582495437,1.60708540722932,4.744468168116162,0.0593978215787391,3.225377947067047,-2.269497261792498,-0.8423352193551308,-2.209388510011413,2.259001204012652,-1.130462959219353,2.52845467408542,0.8257207204978882,-0.3723803656851065,2.94617269610441,3.343205337652939,-2.651280839386971,2.769047045929341,1.114308443697415,3.390985565989258,2.943574768115268,-3.777185323104172,-2.101549409167454,-0.6673870494731419,-2.926550757329943,4.885528263410401,2.495748617954312,2.430076989345641,-0.3040387061124579,-2.483425966261166,2.933826152316164,-1.649580472817688,-5.16317122773585,0.8831263825450423,1.550227803321177,-0.1523467379938615,1.903696349833618,1.144853524519808,1.720083086032293,-3.660401135288552,-0.3901886363398271,2.307893191463813,2.703131925965064,1.100529092293705,2.287005487621426,-3.798761204881554,0.7920809065169023,3.438225873832688,2.451283437740337,3.704647575911956,-0.4111534726217494,1.82776053896972,-1.01207305610951,1.017272608130856,2.578954088015637,1.410582177562725,-1.208369893958786,3.462840283933102,-0.5516549457692858,1.646095404610264,-1.448058234133482,0.5992097981814084,0.2278286604610658,-2.638368802572903,0.4735819882087684,2.215857316268391,1.652481291961098,0.523984065499191,-0.02936516031310132,0.5471525238113566,-4.249106442529693,2.212671357174662,-0.5721959378496566,0.1273051338204112,0.1788407789547818,2.921828381533598,-0.482667960403622,1.101853827458533,1.135626485805225,2.141669892091151,1.546125464652559,5.001406526436861,5.119743608712847,3.228872098058069,-3.869386774853213,2.267379779624892,1.95746177652089,-0.2177938279302321,-0.35668439365521,3.193077374109965,1.208307389994544,1.392026708530933,0.6936271855782158,3.180000502093427,-1.384244705112506,-2.494997477791238,5.400598013905649,0.7671903325626366,0.5920953693957276,2.77447491939881,2.989319164795472,-0.944542569812606,1.32480540985501,-0.9743434052099998,0.229870635071876,-2.563771558483694,1.184716165149171,1.846800578135806,-0.859280436384699,1.269341719311371,2.120151296478642,2.182015118162322,3.376992868952205,-4.302624070844258,-1.737883224487373,2.443536962154906,8.007109671977032,3.227681309466534,1.036342172806239,4.420912495029106,2.900869926820153,-2.406724868132792,-1.95641409816879,1.448541256905881,4.286938105590673,-2.182467022170757,1.955597980709987,-1.426216885300627,-0.737612306233546,-2.027006913892936,-3.983927613511771,-4.551926886087399,4.226408241156054,4.218720960644148,-1.210344368293061,0.1325047153109958,4.161318997427079,0.7316338510024671,0.4726450908388531,4.841383995310096,-0.9983603577493361,0.6313994449132734,1.430636112019749,-4.076808571425289,-1.197792989387435,1.464339896393079,-0.9183991570933666,-0.1556256987829485,-1.053332931336187,-2.110501856330776,-1.706432818897508,-0.453276232209639,-1.51128026033693,-1.024802772238438,3.18341409417205,2.061750340497853,1.67837579717688,0.05343425716458361,-4.564654306060921,0.9099471087946325,-0.6550089910927942,3.609603205689756,4.087087671077654,3.022436486693971,-2.437476231182163,-1.388840598389788,0.6206470237339115,-1.386955739896033,2.458738526453786,-0.5172286210081,0.01732919762858456,2.310283835666169,2.391505261352044,-0.4317109242556472,-3.424833156463269,-0.3189027128058337,2.538058050635738,2.942921939477296,-2.465865240745574,-2.116595942937835,1.619055126486571,2.987340209713882,0.4436896232192187,-1.152698365988592,-2.678920825426322,1.816952789907295,-1.316957644955433,-2.046823467782748,2.506484211473797,0.8524599188965895,1.473764470785251,-2.765529626050265,3.210264120718366,0.5683574227911909,2.529263563490748,0.1830103442232399,-0.4968198384315882,2.988530981559772,3.944942067868556,0.005961759398721289,3.163648454954628,5.226325108632757,-3.611274111479017,3.66191859263355,2.136534928581263,-1.972855074301337,-1.755312348965455,1.156690682894443,-0.05023636031550155,0.8642481838268387,0.9054659451898744,0.9292028532919554,2.005639954805098,-3.182193945807594,2.256769972638198,-2.229458223437487,-2.072039694492062,1.295967141540854,-0.2958875131832686,-1.862937277305203,1.874219561580463,1.754506244614872,-1.582229899954084,0.8396134303960197,5.246521943969276,-2.105134859975354,1.858487193505307,-2.870715170199115,-1.327318891592144,-0.3893419762233721,0.1356491782832319,0.5306427626948731,0.9526508858576663,4.144980715682268,-2.869428202845409,1.273952190399478,1.533406335740016,-3.416609093630495,1.575182684077568,3.036122288095115,-0.2914402906226248,0.847167418762943,5.243151507330393,-4.339289315499246,0.0681422590436489,3.433132007705208,4.472949929210737,-0.6390638719459792,2.4454633975173,5.205710579664167,0.7284132202418808,-2.378262150111411,0.7892329357438539]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>L1<\/th>\n      <th>A1<\/th>\n      <th>L2<\/th>\n      <th>A2<\/th>\n      <th>Y<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"lengthChange":false,"ordering":false,"info":false,"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":0,"visible":false},{"className":"dt-left","targets":"_all"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"L1","targets":1},{"name":"A1","targets":2},{"name":"L2","targets":3},{"name":"A2","targets":4},{"name":"Y","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<p>and the intervention</p>
<p><span class="math display">\[
\dd(a_t, \epsilon_t) = \begin{cases}
0 &amp;\text{ if } \epsilon_t &lt; 0.5 \text{ and } a_t = 1 \\
a_t &amp;\text{ otherwise.}
\end{cases}
\]</span></p>
<p>The true value under this intervention is approximately <span class="math inline">\(-0.37\)</span>. First, letâ€™s translate this intervention into an R function.</p>
<div id="qwebr-insertion-location-2"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p>We can then compute the identification formula in the following steps:</p>
<ol type="1">
<li><p>Set <span class="math inline">\(\m_3(A_3^\dd, H_3) = Y\)</span></p>
<div id="qwebr-insertion-location-3"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Compute the regression of <span class="math inline">\(\m_3(A_3^\dd, H_3)\)</span> on <span class="math inline">\((A_2, H_2)\)</span>. This gives a predictive function, call that predictive function <span class="math inline">\(\m_2(A_2,H_2)\)</span>.</p>
<div id="qwebr-insertion-location-4"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Use the predictive function to compute what would have occurred if the intervention had been implemented at time <span class="math inline">\(t=2\)</span>, i.e., compute <span class="math inline">\(\m_2(A_2^\dd,H_2)\)</span>.</p>
<div id="qwebr-insertion-location-5"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Compute the regression of <span class="math inline">\(\m_2(A_2^\dd,H_2)\)</span> on <span class="math inline">\((A_1, H_1)\)</span>. This gives a predictive function, call that predictive function <span class="math inline">\(\m_1(A_1,H_1)\)</span>.</p>
<div id="qwebr-insertion-location-6"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Use the predictive function to compute what would have occurred if the intervention had been implemented at time <span class="math inline">\(t=1\)</span>, i.e., compute <span class="math inline">\(\m_1(A_1^\dd,H_1)\)</span>.</p>
<div id="qwebr-insertion-location-7"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Compute the mean of <span class="math inline">\(\m_1(A_1^\dd,H_1)\)</span>. This mean is equal to <span class="math inline">\(\theta\)</span>.</p>
<div id="qwebr-insertion-location-8"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
</ol>
<!-- ### Identification proof (for two time points) -->
<!-- Here we show the proof for identification in a very simple -->
<!-- setup. Though simple, this contains the main elements of the proof, -->
<!-- which is shown in the original papers. -->
<!-- Consider a setup with no baseline covariates and an intervention that -->
<!-- does not depend on covariates but depends on the natural value of -->
<!-- treatment: -->
<!-- \begin{align*} -->
<!--     A_1&=f_{A,1}(U_{A,1})\\ -->
<!--     A_1^\dd&=\dd_1(A_1)\\ -->
<!--     L_2&=f_{L,2}(A_1, U_{L,2})\\ -->
<!--     L_2(A_1^\dd)&=f_{L,2}(A_1^\dd, U_{L,2})\\ -->
<!--     A_2&=f_{A,2}(A_1, L_2, U_{A,2})\\ -->
<!--     A_2(A_1^\dd)&=f_{A,2}(A_1^\dd, L_2(A_1^\dd), U_{A,2})\\ -->
<!--     A_2^\dd&=\dd_2(A_2(A_1^\dd))\\ -->
<!--     Y&=f_{Y}(A_2, L_2, A_1, U_{Y})\\ -->
<!--     Y(\bar A^\dd)&=f_{Y}(A_2^\dd, L_2(A_1^\dd), A_1^\dd, U_{Y}) -->
<!-- \end{align*} -->
<!-- Then identification proceeds as: -->
<!-- \begin{align*} -->
<!--     E[Y(\bar A^\dd)]&=\int E[f_{Y}(\dd(A_2(\dd(a_1))), L_2(\dd(a_1)), \dd(a_1), U_{Y})\mid A_1=a_1]dP(a_1)\\ -->
<!--     &=\int E[f_{Y}(f_{Y}(\dd(A_2(\dd(a_1))), L_2(\dd(a_1)), \dd(a_1)), U_{Y})\mid A_1=\dd(a_1)]dP(a_1)\\ -->
<!--     &=\int E[f_{Y}(f_{Y}(\dd(A_2(A_1)), L_2(A_1), A_1), U_{Y})\mid A_1=\dd(a_1)]dP(a_1)\\ -->
<!--     &=\int E[f_{Y}(f_{Y}(\dd(A_2), L_2, A_1), U_{Y})\mid A_1=\dd(a_1)]dP(a_1)\\ -->
<!--     &=\int E[f_{Y}(f_{Y}(\dd(a_2), L_2, A_1), U_{Y})\mid A_1=\dd(a_1), A_2=a_2, L_2=l_2]dP(a_2, l_2)dP(a_1)\\ -->
<!--     &=\int E[f_{Y}(f_{Y}(\dd(a_2), L_2, A_1), U_{Y})\mid A_1=\dd(a_1), A_2=\dd(a_2), L_2=l_2]dP(a_2, l_2)dP(a_1)\\ -->
<!--     &=\int E[f_{Y}(f_{Y}(A_2, L_2, A_1), U_{Y})\mid A_1=\dd(a_1), A_2=\dd(a_2), L_2=l_2]dP(a_2, l_2)dP(a_1)\\ -->
<!--     &=\int E[Y\mid A_1=\dd(a_1), A_2=\dd(a_2), L_2=l_2]dP(a_2, l_2)dP(a_1)\\ -->
<!--       &= E[Y\mid A_1, A_2=\dd(A_2), L_2]dP(a_2, l_2)dP(a_1)\\ -->
<!--        &=\int m_2(d(a_2), l_2, d(a_1))dP(a_2, l_2)dP(a_1)\\ -->
<!--       &= \int E[Y\mid A_1, A_2=\dd(A_2), L_2]dP(a_2, l_2)dP(a_1)\\ -->
<!--              &=\int E[ m_2(d(A_2), L_2, A_1)\mid A_1=d(a_1)]dP(a_1)\\ -->
<!-- &=\int m_1(d(a_1)]dP(a_1) -->
<!-- \end{align*} -->



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-diaz2024causal" class="csl-entry" role="listitem">
DÄ±Ìaz, IvÃ¡n, Katherine L Hoffman, and Nima S Hejazi. 2024. <span>â€œCausal Survival Analysis Under Competing Risks Using Longitudinal Modified Treatment Policies.â€</span> <em>Lifetime Data Analysis</em> 30 (1): 213â€“36.
</div>
<div id="ref-diaz2023nonparametric" class="csl-entry" role="listitem">
DÄ±Ìaz, IvÃ¡n, Nicholas Williams, Katherine L Hoffman, and Edward J Schenck. 2023. <span>â€œNonparametric Causal Effects Based on Longitudinal Modified Treatment Policies.â€</span> <em>Journal of the American Statistical Association</em> 118 (542): 846â€“57.
</div>
<div id="ref-haneuse2013estimation" class="csl-entry" role="listitem">
Haneuse, Sebastian, and Andrea Rotnitzky. 2013. <span>â€œEstimation of the Effect of Interventions That Modify the Received Treatment.â€</span> <em>Statistics in Medicine</em> 32 (30): 5260â€“77.
</div>
<div id="ref-kennedy2019nonparametric" class="csl-entry" role="listitem">
Kennedy, Edward H. 2019. <span>â€œNonparametric Causal Effects Based on Incremental Propensity Score Interventions.â€</span> <em>Journal of the American Statistical Association</em> 114 (526): 645â€“56.
</div>
<div id="ref-nugent2023demonstration" class="csl-entry" role="listitem">
Nugent, Joshua R, and Laura B Balzer. 2023. <span>â€œA Demonstration of Modified Treatment Policies to Evaluate Shifts in Mobility and COVID-19 Case Rates in US Counties.â€</span> <em>American Journal of Epidemiology</em> 192 (5): 762â€“71.
</div>
<div id="ref-rudolph2022effects" class="csl-entry" role="listitem">
Rudolph, Kara E, Catherine Gimbrone, Ellicott C Matthay, Ivan Diaz, Corey S Davis, Katherine Keyes, and Magdalena CerdÃ¡. 2022. <span>â€œWhen Effects Cannot Be Estimated: Redefining Estimands to Understand the Effects of Naloxone Access Laws.â€</span> <em>Epidemiology</em> 33 (5): 689â€“98.
</div>
<div id="ref-rudolph2022buprenorphine" class="csl-entry" role="listitem">
Rudolph, Kara E, Nicholas T Williams, Alicia T Singham Goodwin, Matisyahu Shulman, Marc Fishman, IvÃ¡n DÄ±Ìaz, Sean Luo, John Rotrosen, and Edward V Nunes. 2022. <span>â€œBuprenorphine &amp; Methadone Dosing Strategies to Reduce Risk of Relapse in the Treatment of Opioid Use Disorder.â€</span> <em>Drug and Alcohol Dependence</em> 239: 109609.
</div>
<div id="ref-wen2023intervention" class="csl-entry" role="listitem">
Wen, Lan, Julia L Marcus, and Jessica G Young. 2023. <span>â€œIntervention Treatment Distributions That Depend on the Observed Treatment Process and Model Double Robustness in Causal Survival Analysis.â€</span> <em>Statistical Methods in Medical Research</em> 32 (3): 509â€“23.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script type="module">
// Handle cell initialization initialization
qwebrCellDetails.map(
  (entry) => {
    // Handle the creation of the element
    qwebrCreateHTMLElement(entry);
    // In the event of interactive, initialize the monaco editor
    if (entry.options.context == EvalTypes.Interactive) {
      qwebrCreateMonacoEditorInstance(entry);
    }
  }
);

// Identify non-interactive cells (in order)
const filteredEntries = qwebrCellDetails.filter(entry => {
  const contextOption = entry.options && entry.options.context;
  return ['output', 'setup'].includes(contextOption) || (contextOption == "interactive" && entry.options && entry.options.autorun === 'true');
});

// Condition non-interactive cells to only be run after webR finishes its initialization.
qwebrInstance.then(
  async () => {
    const nHiddenCells = filteredEntries.length;
    var currentHiddenCell = 0;


    // Modify button state
    qwebrSetInteractiveButtonState(`ðŸŸ¡ Running hidden code cells ...`, false);

    // Begin processing non-interactive sections
    // Due to the iteration policy, we must use a for() loop.
    // Otherwise, we would need to switch to using reduce with an empty
    // starting promise
    for (const entry of filteredEntries) {

      // Determine cell being examined
      currentHiddenCell = currentHiddenCell + 1;
      const formattedMessage = `Evaluating hidden cell ${currentHiddenCell} out of ${nHiddenCells}`;

      // Update the document status header
      if (qwebrShowStartupMessage) {
        qwebrUpdateStatusHeader(formattedMessage);
      }

      // Display the update in non-active areas
      qwebrUpdateStatusMessage(formattedMessage);

      // Extract details on the active cell
      const evalType = entry.options.context;
      const cellCode = entry.code;
      const qwebrCounter = entry.id;

      if (['output', 'setup'].includes(evalType)) {
        // Disable further global status updates
        const activeContainer = document.getElementById(`qwebr-non-interactive-loading-container-${qwebrCounter}`);
        activeContainer.classList.remove('qwebr-cell-needs-evaluation');
        activeContainer.classList.add('qwebr-cell-evaluated');

        // Update status on the code cell
        const activeStatus = document.getElementById(`qwebr-status-text-${qwebrCounter}`);
        activeStatus.innerText = " Evaluating hidden code cell...";
        activeStatus.classList.remove('qwebr-cell-needs-evaluation');
        activeStatus.classList.add('qwebr-cell-evaluated');
      }

      switch (evalType) {
        case 'interactive':
          // TODO: Make this more standardized.
          // At the moment, we're overriding the interactive status update by pretending its
          // output-like. 
          const tempOptions = entry.options;
          tempOptions["context"] = "output"
          // Run the code in a non-interactive state that is geared to displaying output
          await qwebrExecuteCode(`${cellCode}`, qwebrCounter, tempOptions);
          break;
        case 'output':
          // Run the code in a non-interactive state that is geared to displaying output
          await qwebrExecuteCode(`${cellCode}`, qwebrCounter, entry.options);
          break;
        case 'setup':
          const activeDiv = document.getElementById(`qwebr-noninteractive-setup-area-${qwebrCounter}`);

          // Store code in history
          qwebrLogCodeToHistory(cellCode, entry.options);

          // Run the code in a non-interactive state with all output thrown away
          await mainWebR.evalRVoid(`${cellCode}`);
          break;
        default: 
          break; 
      }

      if (['output', 'setup'].includes(evalType)) {
        // Disable further global status updates
        const activeContainer = document.getElementById(`qwebr-non-interactive-loading-container-${qwebrCounter}`);
        // Disable visibility
        activeContainer.style.visibility = 'hidden';
        activeContainer.style.display = 'none';
      }
    }
  }
).then(
  () => {
    // Release document status as ready

    if (qwebrShowStartupMessage) {
      qwebrStartupMessage.innerText = "ðŸŸ¢ Ready!"
    }
  
    qwebrSetInteractiveButtonState(
      `<i class="fa-solid fa-play qwebr-icon-run-code"></i> <span>Run Code</span>`, 
      true
    );  
  }
);
</script>




</body></html>