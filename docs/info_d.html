<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Defining General, Hypothetical Interventions â€“ Beyond the Average Treatment Effect</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/editor/editor.main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
<style type="text/css">
.monaco-editor pre {
  background-color: unset !important;
}

.qwebr-editor-toolbar {
  width: 100%;
  display: flex;
  justify-content: space-between;
  box-sizing: border-box;
}

.qwebr-editor-toolbar-left-buttons, .qwebr-editor-toolbar-right-buttons {
  display: flex;
}

.qwebr-non-interactive-loading-container.qwebr-cell-needs-evaluation, .qwebr-non-interactive-loading-container.qwebr-cell-evaluated {
  justify-content: center;
  display: flex;
  background-color: rgba(250, 250, 250, 0.65);
  border: 1px solid rgba(233, 236, 239, 0.65);
  border-radius: 0.5rem;
  margin-top: 15px;
  margin-bottom: 15px;
}

.qwebr-r-project-logo {
  color: #2767B0; /* R Project's blue color */
}

.qwebr-icon-status-spinner {
  color: #7894c4;
}

.qwebr-icon-run-code {
  color: #0d9c29
}

body.quarto-light .qwebr-output-code-stdout {
  color: #111;
}

body.quarto-dark .qwebr-output-code-stdout {
  color: #EEE;
}

.qwebr-output-code-stderr {
  color: #db4133;
}

body.quarto-light .qwebr-editor {
  border: 1px solid #EEEEEE;
}

body.quarto-light .qwebr-editor-toolbar {
  background-color: #EEEEEE;
  padding: 0.2rem 0.5rem;
}

body.quarto-dark .qwebr-editor {
  border: 1px solid #111;
}

body.quarto-dark .qwebr-editor-toolbar {
  background-color: #111;
  padding: 0.2rem 0.5rem;
}

.qwebr-button {
  display: inline-block;
  font-weight: 400;
  line-height: 1;
  text-decoration: none;
  text-align: center;
  padding: 0.375rem 0.75rem;
  font-size: .9rem;
  border-radius: 0.25rem;
  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
}

body.quarto-light .qwebr-button {
  background-color: #EEEEEE;
  color: #000;
  border-color: #dee2e6;
  border: 1px solid rgba(0,0,0,0);
}

body.quarto-dark .qwebr-button {
  background-color: #111;
  color: #EEE;
  border-color: #dee2e6;
  border: 1px solid rgba(0,0,0,0);
}

body.quarto-light .qwebr-button:hover {
  color: #000;
  background-color: #d9dce0;
  border-color: #c8ccd0;
}

body.quarto-dark .qwebr-button:hover {
  color: #d9dce0;
  background-color: #323232;
  border-color: #d9dce0;
}

.qwebr-button:disabled,.qwebr-button.disabled,fieldset:disabled .qwebr-button {
  pointer-events: none;
  opacity: .65
}

.qwebr-button-reset {
  color: #696969; /*#4682b4;*/
}

.qwebr-button-copy {
  color: #696969;
}


/* Custom styling for RevealJS Presentations*/

/* Reset the style of the interactive area */
.reveal div.qwebr-interactive-area {
  display: block;
  box-shadow: none;
  max-width: 100%;
  max-height: 100%;
  margin: 0;
  padding: 0;
} 

/* Provide space to entries */
.reveal div.qwebr-output-code-area pre div {
  margin: 1px 2px 1px 10px;
}

/* Collapse the inside code tags to avoid extra space between line outputs */
.reveal pre div code.qwebr-output-code-stdout, .reveal pre div code.qwebr-output-code-stderr {
  padding: 0;
  display: contents;
}

body.reveal.quarto-light pre div code.qwebr-output-code-stdout {
  color: #111;
}

body.reveal.quarto-dark pre div code.qwebr-output-code-stdout {
  color: #EEEEEE;
}

.reveal pre div code.qwebr-output-code-stderr {
  color: #db4133;
}


/* Create a border around console and output (does not effect graphs) */
body.reveal.quarto-light div.qwebr-console-area {
  border: 1px solid #EEEEEE;
  box-shadow: 2px 2px 10px #EEEEEE;
}

body.reveal.quarto-dark div.qwebr-console-area {
  border: 1px solid #111;
  box-shadow: 2px 2px 10px #111;
}


/* Cap output height and allow text to scroll */
/* TODO: Is there a better way to fit contents/max it parallel to the monaco editor size? */
.reveal div.qwebr-output-code-area pre {
  max-height: 400px;
  overflow: scroll;
}

</style>
<script type="module">
// Document level settings ----

// Determine if we need to install R packages
globalThis.qwebrInstallRPackagesList = ['lmtp', 'dplyr'];

// Specify possible locations to search for the repository
globalThis.qwebrPackageRepoURLS = ['https://repo.r-wasm.org/'];

// Check to see if we have an empty array, if we do set to skip the installation.
globalThis.qwebrSetupRPackages = !(qwebrInstallRPackagesList.indexOf("") !== -1);
globalThis.qwebrAutoloadRPackages = true;

// Display a startup message?
globalThis.qwebrShowStartupMessage = true;
globalThis.qwebrShowHeaderMessage = false;

// Describe the webR settings that should be used
globalThis.qwebrCustomizedWebROptions = {
  "baseURL": "https://webr.r-wasm.org/v0.3.3/",
  "serviceWorkerUrl": "",
  "homedir": "/home/web_user", 
  "channelType": "ChannelType.Automatic"
};

// Store cell data
globalThis.qwebrCellDetails = [{"id":1,"options":{"label":"unnamed-chunk-1","dpi":72,"comment":"","read-only":"false","results":"markup","editor-max-height":"","out-width":"700px","fig-cap":"","classes":"","editor-font-scale":1,"message":"true","out-height":"","autorun":"true","fig-width":7,"output":"true","fig-height":5,"context":"setup","editor-quick-suggestions":"false","warning":"true"},"code":"set.seed(786543)\nn <- 500\nl0 <- rnorm(n)\na1 <- rbinom(n, 1, plogis(-1 + l0*1.5))\nl1 <- rnorm(n)\na2 <- rbinom(n, 1, plogis(-1 + l1*1.5 + a1*2))\ny <- rnorm(n, -1 - 1.2*l0 + 2.4*a1 - 2*l1 + 1.2*a2)\nfoo <- data.frame(\n  L1 = l0, \n  A1 = a1, \n  L2 = l1, \n  A2 = a2, \n  Y = y\n)"},{"id":2,"options":{"label":"unnamed-chunk-2","dpi":72,"comment":"","read-only":"false","results":"markup","editor-max-height":"","out-width":"700px","fig-cap":"","classes":"","editor-font-scale":1,"message":"true","out-height":"","autorun":"false","fig-width":7,"output":"true","fig-height":5,"context":"interactive","editor-quick-suggestions":"false","warning":"true"},"code":"m3_d <- foo$Y"},{"id":3,"options":{"label":"unnamed-chunk-3","dpi":72,"comment":"","read-only":"false","results":"markup","editor-max-height":"","out-width":"700px","fig-cap":"","classes":"","editor-font-scale":1,"message":"true","out-height":"","autorun":"false","fig-width":7,"output":"true","fig-height":5,"context":"interactive","editor-quick-suggestions":"false","warning":"true"},"code":"m2 <- glm(m3_d ~ L1 + A1 + L2 + A2, \n          data = dplyr::rename(foo, m3_d = Y))"},{"id":4,"options":{"label":"unnamed-chunk-4","dpi":72,"comment":"","read-only":"false","results":"markup","editor-max-height":"","out-width":"700px","fig-cap":"","classes":"","editor-font-scale":1,"message":"true","out-height":"","autorun":"false","fig-width":7,"output":"true","fig-height":5,"context":"interactive","editor-quick-suggestions":"false","warning":"true"},"code":"m2_d <- predict(m2, dplyr::mutate(foo, A2 = 1))"},{"id":5,"options":{"label":"unnamed-chunk-5","dpi":72,"comment":"","read-only":"false","results":"markup","editor-max-height":"","out-width":"700px","fig-cap":"","classes":"","editor-font-scale":1,"message":"true","out-height":"","autorun":"false","fig-width":7,"output":"true","fig-height":5,"context":"interactive","editor-quick-suggestions":"false","warning":"true"},"code":"m1 <- glm(m2_d ~ L1 + A1, data = dplyr::mutate(foo, m2_d = m2_d))"},{"id":6,"options":{"label":"unnamed-chunk-6","dpi":72,"comment":"","read-only":"false","results":"markup","editor-max-height":"","out-width":"700px","fig-cap":"","classes":"","editor-font-scale":1,"message":"true","out-height":"","autorun":"false","fig-width":7,"output":"true","fig-height":5,"context":"interactive","editor-quick-suggestions":"false","warning":"true"},"code":"m1_d <- predict(m1, dplyr::mutate(foo, A1 = 1))"},{"id":7,"options":{"label":"unnamed-chunk-7","dpi":72,"comment":"","read-only":"false","results":"markup","editor-max-height":"","out-width":"700px","fig-cap":"","classes":"","editor-font-scale":1,"message":"true","out-height":"","autorun":"false","fig-width":7,"output":"true","fig-height":5,"context":"interactive","editor-quick-suggestions":"false","warning":"true"},"code":"mean(m1_d)"}];

</script>
<script type="module">
// Declare startupMessageQWebR globally
globalThis.qwebrStartupMessage = document.createElement("p");

// Verify if OffScreenCanvas is supported
globalThis.qwebrOffScreenCanvasSupport = function() {
  return typeof OffscreenCanvas !== 'undefined'
}

// Function to set the button text
globalThis.qwebrSetInteractiveButtonState = function(buttonText, enableCodeButton = true) {
  document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
    btn.innerHTML = buttonText;
    btn.disabled = !enableCodeButton;
  });
}

// Function to update the status message in non-interactive cells
globalThis.qwebrUpdateStatusMessage = function(message) {
  document.querySelectorAll(".qwebr-status-text.qwebr-cell-needs-evaluation").forEach((elem) => {
    elem.innerText = message;
  });
}

// Function to update the status message
globalThis.qwebrUpdateStatusHeader = function(message) {
  qwebrStartupMessage.innerHTML = `
    <i class="fa-solid fa-spinner fa-spin qwebr-icon-status-spinner"></i>
    <span>${message}</span>`;
}

function qwebrPlaceMessageContents(content, html_location = "title-block-header", revealjs_location = "title-slide") {

  // Get references to header elements
  const headerHTML = document.getElementById(html_location);
  const headerRevealJS = document.getElementById(revealjs_location);

  // Determine where to insert the quartoTitleMeta element
  if (headerHTML || headerRevealJS) {
    // Append to the existing "title-block-header" element or "title-slide" div
    (headerHTML || headerRevealJS).appendChild(content);
  } else {
    // If neither headerHTML nor headerRevealJS is found, insert after "webr-monaco-editor-init" script
    const monacoScript = document.getElementById("qwebr-monaco-editor-init");
    const header = document.createElement("header");
    header.setAttribute("id", "title-block-header");
    header.appendChild(content);
    monacoScript.after(header);
  }
}


function qwebrOffScreenCanvasSupportWarningMessage() {
  
  // Verify canvas is supported.
  if(qwebrOffScreenCanvasSupport()) return;

  // Create the main container div
  var calloutContainer = document.createElement('div');
  calloutContainer.classList.add('callout', 'callout-style-default', 'callout-warning', 'callout-titled');

  // Create the header div
  var headerDiv = document.createElement('div');
  headerDiv.classList.add('callout-header', 'd-flex', 'align-content-center');

  // Create the icon container div
  var iconContainer = document.createElement('div');
  iconContainer.classList.add('callout-icon-container');

  // Create the icon element
  var iconElement = document.createElement('i');
  iconElement.classList.add('callout-icon');

  // Append the icon element to the icon container
  iconContainer.appendChild(iconElement);

  // Create the title container div
  var titleContainer = document.createElement('div');
  titleContainer.classList.add('callout-title-container', 'flex-fill');
  titleContainer.innerText = 'Warning: Web Browser Does Not Support Graphing!';

  // Append the icon container and title container to the header div
  headerDiv.appendChild(iconContainer);
  headerDiv.appendChild(titleContainer);

  // Create the body container div
  var bodyContainer = document.createElement('div');
  bodyContainer.classList.add('callout-body-container', 'callout-body');

  // Create the paragraph element for the body content
  var paragraphElement = document.createElement('p');
  paragraphElement.innerHTML = 'This web browser does not have support for displaying graphs through the <code>quarto-webr</code> extension since it lacks an <code>OffScreenCanvas</code>. Please upgrade your web browser to one that supports <code>OffScreenCanvas</code>.';

  // Append the paragraph element to the body container
  bodyContainer.appendChild(paragraphElement);

  // Append the header div and body container to the main container div
  calloutContainer.appendChild(headerDiv);
  calloutContainer.appendChild(bodyContainer);

  // Append the main container div to the document depending on format
  qwebrPlaceMessageContents(calloutContainer, "title-block-header"); 

}


// Function that attaches the document status message and diagnostics
function displayStartupMessage(showStartupMessage, showHeaderMessage) {
  if (!showStartupMessage) {
    return;
  }

  // Create the outermost div element for metadata
  const quartoTitleMeta = document.createElement("div");
  quartoTitleMeta.classList.add("quarto-title-meta");

  // Create the first inner div element
  const firstInnerDiv = document.createElement("div");
  firstInnerDiv.setAttribute("id", "qwebr-status-message-area");

  // Create the second inner div element for "WebR Status" heading and contents
  const secondInnerDiv = document.createElement("div");
  secondInnerDiv.setAttribute("id", "qwebr-status-message-title");
  secondInnerDiv.classList.add("quarto-title-meta-heading");
  secondInnerDiv.innerText = "WebR Status";

  // Create another inner div for contents
  const secondInnerDivContents = document.createElement("div");
  secondInnerDivContents.setAttribute("id", "qwebr-status-message-body");
  secondInnerDivContents.classList.add("quarto-title-meta-contents");

  // Describe the WebR state
  qwebrStartupMessage.innerText = "ðŸŸ¡ Loading...";
  qwebrStartupMessage.setAttribute("id", "qwebr-status-message-text");
  // Add `aria-live` to auto-announce the startup status to screen readers
  qwebrStartupMessage.setAttribute("aria-live", "assertive");

  // Append the startup message to the contents
  secondInnerDivContents.appendChild(qwebrStartupMessage);

  // Add a status indicator for COOP and COEP Headers if needed
  if (showHeaderMessage) {
    const crossOriginMessage = document.createElement("p");
    crossOriginMessage.innerText = `${crossOriginIsolated ? 'ðŸŸ¢' : 'ðŸŸ¡'} COOP & COEP Headers`;
    crossOriginMessage.setAttribute("id", "qwebr-coop-coep-header");
    secondInnerDivContents.appendChild(crossOriginMessage);
  }

  // Combine the inner divs and contents
  firstInnerDiv.appendChild(secondInnerDiv);
  firstInnerDiv.appendChild(secondInnerDivContents);
  quartoTitleMeta.appendChild(firstInnerDiv);

  // Place message on webpage
  qwebrPlaceMessageContents(quartoTitleMeta); 
}

displayStartupMessage(qwebrShowStartupMessage, qwebrShowHeaderMessage);
qwebrOffScreenCanvasSupportWarningMessage();
</script>
<script type="module">
// Supported Evaluation Types for Context
globalThis.EvalTypes = Object.freeze({
  Interactive: 'interactive',
  Setup: 'setup',
  Output: 'output',
});

// Function that obtains the font size for a given element 
globalThis.qwebrCurrentFontSizeOnElement = function(element, cssProperty = 'font-size') {

  const currentFontSize = parseFloat(
    window
    .getComputedStyle(element)
    .getPropertyValue(cssProperty)
  );
  
  return currentFontSize;
}

// Function to determine font scaling
globalThis.qwebrScaledFontSize = function(div, qwebrOptions) {
  // Determine if we should compute font-size using RevealJS's `--r-main-font-size` 
  // or if we can directly use the document's `font-size`.
  const cssProperty = document.body.classList.contains('reveal') ? 
    "--r-main-font-size" : "font-size";
  
  // Get the current font size on the div element
  const elementFontSize = qwebrCurrentFontSizeOnElement(div, cssProperty);

  // Determine the scaled font size value
  const scaledFontSize = ((qwebrOptions['editor-font-scale'] ?? 1) * elementFontSize) ?? 17.5;

  return scaledFontSize;
}


// Function that dispatches the creation request
globalThis.qwebrCreateHTMLElement = function (
  cellData
) {

  // Extract key components
  const evalType = cellData.options.context;
  const qwebrCounter = cellData.id;

  // We make an assumption that insertion points are defined by the Lua filter as:
  // qwebr-insertion-location-{qwebrCounter} 
  const elementLocator = document.getElementById(`qwebr-insertion-location-${qwebrCounter}`);

  // Figure out the routine to use to insert the element.
  let qwebrElement;
  switch ( evalType ) {
    case EvalTypes.Interactive:
      qwebrElement = qwebrCreateInteractiveElement(qwebrCounter, cellData.options);
      break;
    case EvalTypes.Output: 
      qwebrElement = qwebrCreateNonInteractiveOutputElement(qwebrCounter, cellData.options);
      break;
    case EvalTypes.Setup: 
      qwebrElement = qwebrCreateNonInteractiveSetupElement(qwebrCounter, cellData.options);
      break;
    default: 
      qwebrElement = document.createElement('div');
      qwebrElement.textContent = 'Error creating `quarto-webr` element';
  }

  // Insert the dynamically generated object at the document location.
  elementLocator.appendChild(qwebrElement);
};

// Function that setups the interactive element creation
globalThis.qwebrCreateInteractiveElement = function (qwebrCounter, qwebrOptions) {

  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = 'qwebr-interactive-area-' + qwebrCounter;
  mainDiv.className = `qwebr-interactive-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }

  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }

  // Create toolbar div
  var toolbarDiv = document.createElement('div');
  toolbarDiv.className = 'qwebr-editor-toolbar';
  toolbarDiv.id = 'qwebr-editor-toolbar-' + qwebrCounter;

  // Create a div to hold the left buttons
  var leftButtonsDiv = document.createElement('div');
  leftButtonsDiv.className = 'qwebr-editor-toolbar-left-buttons';

  // Create a div to hold the right buttons
  var rightButtonsDiv = document.createElement('div');
  rightButtonsDiv.className = 'qwebr-editor-toolbar-right-buttons';

  // Create Run Code button
  var runCodeButton = document.createElement('button');
  runCodeButton.className = 'btn btn-default qwebr-button qwebr-button-run';
  runCodeButton.disabled = true;
  runCodeButton.type = 'button';
  runCodeButton.id = 'qwebr-button-run-' + qwebrCounter;
  runCodeButton.textContent = 'ðŸŸ¡ Loading webR...';
  runCodeButton.title = `Run code (Shift + Enter)`;

  // Append buttons to the leftButtonsDiv
  leftButtonsDiv.appendChild(runCodeButton);

  // Create Reset button
  var resetButton = document.createElement('button');
  resetButton.className = 'btn btn-light btn-xs qwebr-button qwebr-button-reset';
  resetButton.type = 'button';
  resetButton.id = 'qwebr-button-reset-' + qwebrCounter;
  resetButton.title = 'Start over';
  resetButton.innerHTML = '<i class="fa-solid fa-arrows-rotate"></i>';

  // Create Copy button
  var copyButton = document.createElement('button');
  copyButton.className = 'btn btn-light btn-xs qwebr-button qwebr-button-copy';
  copyButton.type = 'button';
  copyButton.id = 'qwebr-button-copy-' + qwebrCounter;
  copyButton.title = 'Copy code';
  copyButton.innerHTML = '<i class="fa-regular fa-copy"></i>';

  // Append buttons to the rightButtonsDiv
  rightButtonsDiv.appendChild(resetButton);
  rightButtonsDiv.appendChild(copyButton);

  // Create console area div
  var consoleAreaDiv = document.createElement('div');
  consoleAreaDiv.id = 'qwebr-console-area-' + qwebrCounter;
  consoleAreaDiv.className = 'qwebr-console-area';

  // Create editor div
  var editorDiv = document.createElement('div');
  editorDiv.id = 'qwebr-editor-' + qwebrCounter;
  editorDiv.className = 'qwebr-editor';

  // Create output code area div
  var outputCodeAreaDiv = document.createElement('div');
  outputCodeAreaDiv.id = 'qwebr-output-code-area-' + qwebrCounter;
  outputCodeAreaDiv.className = 'qwebr-output-code-area';
  outputCodeAreaDiv.setAttribute('aria-live', 'assertive');

  // Create pre element inside output code area
  var preElement = document.createElement('pre');
  preElement.style.visibility = 'hidden';
  outputCodeAreaDiv.appendChild(preElement);

  // Create output graph area div
  var outputGraphAreaDiv = document.createElement('div');
  outputGraphAreaDiv.id = 'qwebr-output-graph-area-' + qwebrCounter;
  outputGraphAreaDiv.className = 'qwebr-output-graph-area';

  // Append buttons to the toolbar
  toolbarDiv.appendChild(leftButtonsDiv);
  toolbarDiv.appendChild(rightButtonsDiv);

  // Append all elements to the main div
  mainDiv.appendChild(toolbarDiv);
  consoleAreaDiv.appendChild(editorDiv);
  consoleAreaDiv.appendChild(outputCodeAreaDiv);
  mainDiv.appendChild(consoleAreaDiv);
  mainDiv.appendChild(outputGraphAreaDiv);

  return mainDiv;
}

// Function that adds output structure for non-interactive output
globalThis.qwebrCreateNonInteractiveOutputElement = function(qwebrCounter, qwebrOptions) {
  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = 'qwebr-noninteractive-area-' + qwebrCounter;
  mainDiv.className = `qwebr-noninteractive-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }
  
  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }
  
  // Create a status container div
  var statusContainer = createLoadingContainer(qwebrCounter);

  // Create output code area div
  var outputCodeAreaDiv = document.createElement('div');
  outputCodeAreaDiv.id = 'qwebr-output-code-area-' + qwebrCounter;
  outputCodeAreaDiv.className = 'qwebr-output-code-area';
  outputCodeAreaDiv.setAttribute('aria-live', 'assertive');

  // Create pre element inside output code area
  var preElement = document.createElement('pre');
  preElement.style.visibility = 'hidden';
  outputCodeAreaDiv.appendChild(preElement);

  // Create output graph area div
  var outputGraphAreaDiv = document.createElement('div');
  outputGraphAreaDiv.id = 'qwebr-output-graph-area-' + qwebrCounter;
  outputGraphAreaDiv.className = 'qwebr-output-graph-area';

  // Append all elements to the main div
  mainDiv.appendChild(statusContainer);
  mainDiv.appendChild(outputCodeAreaDiv);
  mainDiv.appendChild(outputGraphAreaDiv);

  return mainDiv;
};

// Function that adds a stub in the page to indicate a setup cell was used.
globalThis.qwebrCreateNonInteractiveSetupElement = function(qwebrCounter, qwebrOptions) {
  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = `qwebr-noninteractive-setup-area-${qwebrCounter}`;
  mainDiv.className = `qwebr-noninteractive-setup-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }


  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }

  // Create a status container div
  var statusContainer = createLoadingContainer(qwebrCounter);

  // Append status onto the main div
  mainDiv.appendChild(statusContainer);

  return mainDiv;
}


// Function to create loading container with specified ID
globalThis.createLoadingContainer = function(qwebrCounter) {

  // Create a status container
  const container = document.createElement('div');
  container.id = `qwebr-non-interactive-loading-container-${qwebrCounter}`;
  container.className = 'qwebr-non-interactive-loading-container qwebr-cell-needs-evaluation';

  // Create an R project logo to indicate its a code space
  const rProjectIcon = document.createElement('i');
  rProjectIcon.className = 'fa-brands fa-r-project fa-3x qwebr-r-project-logo';

  // Setup a loading icon from font awesome
  const spinnerIcon = document.createElement('i');
  spinnerIcon.className = 'fa-solid fa-spinner fa-spin fa-1x qwebr-icon-status-spinner';

  // Add a section for status text
  const statusText = document.createElement('p');
  statusText.id = `qwebr-status-text-${qwebrCounter}`;
  statusText.className = `qwebr-status-text qwebr-cell-needs-evaluation`;
  statusText.innerText = 'Loading webR...';

  // Incorporate an inner container
  const innerContainer = document.createElement('div');

  // Append elements to the inner container
  innerContainer.appendChild(spinnerIcon);
  innerContainer.appendChild(statusText);

  // Append elements to the main container
  container.appendChild(rProjectIcon);
  container.appendChild(innerContainer);

  return container;
}
</script>
<script type="module">
// Function to install a single package
async function qwebrInstallRPackage(packageName) {
  await mainWebR.evalRVoid(`webr::install('${packageName}');`);
}

// Function to load a single package
async function qwebrLoadRPackage(packageName) {
  await mainWebR.evalRVoid(`require('${packageName}', quietly = TRUE)`);
}

// Generic function to process R packages
async function qwebrProcessRPackagesWithStatus(packages, processType, displayStatusMessageUpdate = true) {
  // Switch between contexts
  const messagePrefix = processType === 'install' ? 'Installing' : 'Loading';

  // Modify button state
  qwebrSetInteractiveButtonState(`ðŸŸ¡ ${messagePrefix} package ...`, false);

  // Iterate over packages
  for (let i = 0; i < packages.length; i++) {
    const activePackage = packages[i];
    const formattedMessage = `${messagePrefix} package ${i + 1} out of ${packages.length}: ${activePackage}`;

    // Display the update in header
    if (displayStatusMessageUpdate) {
      qwebrUpdateStatusHeader(formattedMessage);
    }

    // Display the update in non-active areas
    qwebrUpdateStatusMessage(formattedMessage);

    // Run package installation
    if (processType === 'install') {
      await qwebrInstallRPackage(activePackage);
    } else {
      await qwebrLoadRPackage(activePackage);
    }
  }

  // Clean slate
  if (processType === 'load') {
    await mainWebR.flush();
  }
}

// Start a timer
const initializeWebRTimerStart = performance.now();

// Encase with a dynamic import statement
globalThis.qwebrInstance = import(qwebrCustomizedWebROptions.baseURL + "webr.mjs").then(
  async ({ WebR, ChannelType }) => {
    // Populate WebR options with defaults or new values based on `webr` meta
    globalThis.mainWebR = new WebR(qwebrCustomizedWebROptions);

    // Initialization WebR
    await mainWebR.init();

    // Setup a shelter
    globalThis.mainWebRCodeShelter = await new mainWebR.Shelter();

    // Setup a pager to allow processing help documentation 
    await mainWebR.evalRVoid('webr::pager_install()'); 

    // Override the existing install.packages() to use webr::install()
    await mainWebR.evalRVoid('webr::shim_install()'); 

    // Specify the repositories to pull from
    // Note: webR does not use the `repos` option, but instead uses `webr_pkg_repos`
    // inside of `install()`. However, other R functions still pull from `repos`.
    await mainWebR.evalRVoid(`
      options(
        webr_pkg_repos = c(${qwebrPackageRepoURLS.map(repoURL => `'${repoURL}'`).join(',')}),
        repos = c(${qwebrPackageRepoURLS.map(repoURL => `'${repoURL}'`).join(',')})
      )
    `);

    // Check to see if any packages need to be installed
    if (qwebrSetupRPackages) {
      // Obtain only a unique list of packages
      const uniqueRPackageList = Array.from(new Set(qwebrInstallRPackagesList));

      // Install R packages one at a time (either silently or with a status update)
      await qwebrProcessRPackagesWithStatus(uniqueRPackageList, 'install', qwebrShowStartupMessage);

      if (qwebrAutoloadRPackages) {
        // Load R packages one at a time (either silently or with a status update)
        await qwebrProcessRPackagesWithStatus(uniqueRPackageList, 'load', qwebrShowStartupMessage);
      }
    }
  }
);

// Stop timer
const initializeWebRTimerEnd = performance.now();

</script>
<script type="module">
// Function to verify a given JavaScript Object is empty
globalThis.qwebrIsObjectEmpty = function (arr) {
    return Object.keys(arr).length === 0;
}

// Global version of the Escape HTML function that converts HTML 
// characters to their HTML entities.
globalThis.qwebrEscapeHTMLCharacters = function(unsafe) {
    return unsafe
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  };

// Passthrough results
globalThis.qwebrIdentity = function(x) {
    return x;
};

// Append a comment
globalThis.qwebrPrefixComment = function(x, comment) {
    return `${comment}${x}`;
};

// Function to parse the pager results
globalThis.qwebrParseTypePager = async function (msg) { 

    // Split out the event data
    const { path, title, deleteFile } = msg.data; 

    // Process the pager data by reading the information from disk
    const paged_data = await mainWebR.FS.readFile(path).then((data) => {
        // Obtain the file content
        let content = new TextDecoder().decode(data);

        // Remove excessive backspace characters until none remain
        while(content.match(/.[\b]/)){
        content = content.replace(/.[\b]/g, '');
        }

        // Returned cleaned data
        return content;
    });

    // Unlink file if needed
    if (deleteFile) { 
        await mainWebR.FS.unlink(path); 
    } 

    // Return extracted data with spaces
    return paged_data;
} 

// Function to run the code using webR and parse the output
globalThis.qwebrComputeEngine = async function(
    codeToRun, 
    elements, 
    options) {

    // Call into the R compute engine that persists within the document scope.
    // To be prepared for all scenarios, the following happens: 
    // 1. We setup a canvas device to write to by making a namespace call into the {webr} package
    // 2. We use values inside of the options array to set the figure size.
    // 3. We capture the output stream information (STDOUT and STERR)
    // 4. We disable the current device's image creation.
    // 5. Piece-wise parse the results into the different output areas

    // Create a pager variable for help/file contents
    let pager = [];

    // Handle how output is processed
    let showMarkup = options.results === "markup" && options.output !== "asis";
    let processOutput;

    if (showMarkup) {
        processOutput = qwebrEscapeHTMLCharacters;
    } else {
        processOutput = qwebrIdentity;
    }

    // ---- 
    // Convert from Inches to Pixels by using DPI (dots per inch)
    // for bitmap devices (dpi * inches = pixels)
    let fig_width = options["fig-width"] * options["dpi"]
    let fig_height = options["fig-height"] * options["dpi"]

    // Initialize webR
    await mainWebR.init();

    // Configure capture output
    let captureOutputOptions = {
        withAutoprint: true,
        captureStreams: true,
        captureConditions: false,
        // env: webR.objs.emptyEnv, // maintain a global environment for webR v0.2.0
    };
    
    // Determine if the browser supports OffScreen
    if (qwebrOffScreenCanvasSupport()) {
        // Mirror default options of webr::canvas()
        // with changes to figure height and width.
        captureOutputOptions.captureGraphics = {
            width: fig_width,
            height: fig_height,
            bg: "white", // default: transparent
            pointsize: 12,
            capture: true
        };
    }  else {
        // Disable generating graphics
        captureOutputOptions.captureGraphics = false;
    }

    // Setup a webR canvas by making a namespace call into the {webr} package
    // Evaluate the R code
    // Remove the active canvas silently
    const result = await mainWebRCodeShelter.captureR(
        `${codeToRun}`,
        captureOutputOptions
    );

    // -----

    // Start attempting to parse the result data
    processResultOutput:try {
        
        // Avoid running through output processing
        if (options.results === "hide" || options.output === "false") { 
            break processResultOutput; 
        }

        // Merge output streams of STDOUT and STDErr (messages and errors are combined.)
        // Require both `warning` and `message` to be true to display `STDErr`. 
        const out = result.output
        .filter(
            evt => evt.type === "stdout" || 
            ( evt.type === "stderr" && (options.warning === "true" && options.message === "true")) 
        )
        .map((evt, index) => {
            const className = `qwebr-output-code-${evt.type}`;
            const outputResult = qwebrPrefixComment(processOutput(evt.data), options.comment);
            return `<code id="${className}-editor-${elements.id}-result-${index + 1}" class="${className}">${outputResult}</code>`;
        })
        .join("\n");


        // Clean the state
        // We're now able to process pager events.
        // As a result, we cannot maintain a true 1-to-1 output order 
        // without individually feeding each line
        const msgs = await mainWebR.flush();

        // Use `map` to process the filtered "pager" events asynchronously
        const pager = await Promise.all(
            msgs.filter(msg => msg.type === 'pager').map(
                async (msg) => {
                    return await qwebrParseTypePager(msg);
                }
            )
        );

        // Nullify the output area of content
        elements.outputCodeDiv.innerHTML = "";
        elements.outputGraphDiv.innerHTML = "";

        // Design an output object for messages
        const pre = document.createElement("pre");
        if (/\S/.test(out)) {
            // Display results as HTML elements to retain output styling
            const div = document.createElement("div");
            div.innerHTML = out;

            // Calculate a scaled font-size value
            const scaledFontSize = qwebrScaledFontSize(
                elements.outputCodeDiv, options);

            // Override output code cell size
            pre.style.fontSize = `${scaledFontSize}px`;
            pre.appendChild(div);
        } else {
            // If nothing is present, hide the element.
            pre.style.visibility = "hidden";
        }

        elements.outputCodeDiv.appendChild(pre);

        // Determine if we have graphs to display
        if (result.images.length > 0) {
            // Create figure element
            const figureElement = document.createElement('figure');

            // Place each rendered graphic onto a canvas element
            result.images.forEach((img) => {
                // Construct canvas for object
                const canvas = document.createElement("canvas");

                // Set canvas size to image
                canvas.width = img.width;
                canvas.height = img.height;

                // Apply output truncations
                canvas.style.width = options["out-width"] ? options["out-width"] : `${fig_width}px`;
                if (options["out-height"]) {
                    canvas.style.height = options["out-height"];
                }

                // Apply styling
                canvas.style.display = "block";
                canvas.style.margin = "auto";

                // Draw image onto Canvas
                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, img.width, img.height);
          
                // Append canvas to figure output area
                figureElement.appendChild(canvas);
            });

            if (options['fig-cap']) {
                // Create figcaption element
                const figcaptionElement = document.createElement('figcaption');
                figcaptionElement.innerText = options['fig-cap'];
                // Append figcaption to figure
                figureElement.appendChild(figcaptionElement);    
            }

            elements.outputGraphDiv.appendChild(figureElement);
        }

        // Display the pager data
        if (pager) {
        // Use the `pre` element to preserve whitespace.
        pager.forEach((paged_data, index) => {
            let pre_pager = document.createElement("pre");
            pre_pager.innerText = paged_data;
            pre_pager.classList.add("qwebr-output-code-pager");
            pre_pager.setAttribute("id", `qwebr-output-code-pager-editor-${elements.id}-result-${index + 1}`);
            elements.outputCodeDiv.appendChild(pre_pager);
        });
        }
    } finally {
        // Clean up the remaining code
        mainWebRCodeShelter.purge();
    }
}

// Function to execute the code (accepts code as an argument)
globalThis.qwebrExecuteCode = async function (
    codeToRun,
    id,
    options = {}) {

    // If options are not passed, we fall back on the bare minimum to handle the computation
    if (qwebrIsObjectEmpty(options)) {
        options = { 
            "context": "interactive", 
            "fig-width": 7, "fig-height": 5, 
            "out-width": "700px", "out-height": "", 
            "dpi": 72,
            "results": "markup", 
            "warning": "true", "message": "true",
        };
    }

    // Next, we access the compute areas values
    const elements = {
        runButton: document.getElementById(`qwebr-button-run-${id}`),
        outputCodeDiv: document.getElementById(`qwebr-output-code-area-${id}`),
        outputGraphDiv: document.getElementById(`qwebr-output-graph-area-${id}`),
        id: id,
    }

    // Disallowing execution of other code cells
    document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
        btn.disabled = true;
    });

    if (options.context == EvalTypes.Interactive) {
        // Emphasize the active code cell
        elements.runButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin qwebr-icon-status-spinner"></i> <span>Run Code</span>';
    }

    // Evaluate the code and parse the output into the document
    await qwebrComputeEngine(codeToRun, elements, options);

    // Switch to allowing execution of code
    document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
        btn.disabled = false;
    });

    if (options.context == EvalTypes.Interactive) {
        // Revert to the initial code cell state
        elements.runButton.innerHTML = '<i class="fa-solid fa-play qwebr-icon-run-code"></i> <span>Run Code</span>';
    }
}

</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Beyond the Average Treatment Effect</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./instructors.html"> 
<span class="menu-text">Instructors</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title">Defining General, Hypothetical Interventions</h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
        <div class="sidebar-tools-collapse">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-collapse-item" href="https://github.com/nt-williams/lmtp-workshop">
            Source Code
            </a>
          </li>
      </ul>
    </div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./info_tldr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./info_d.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">2. Defining Interventions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./info_estimators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Estimators</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">4. Estimating Effects with lmtp</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lmtp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The lmtp package</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_static.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Static effects and the ATE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_dtr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Treatment Regimes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_mtp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modified Treatment Policies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_ipsi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IPSI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Survival Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R_multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate Exposures</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./info_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Final Remarks</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#static-interventions" id="toc-static-interventions" class="nav-link active" data-scroll-target="#static-interventions">Static Interventions</a></li>
  <li><a href="#dynamic-treatment-regime" id="toc-dynamic-treatment-regime" class="nav-link" data-scroll-target="#dynamic-treatment-regime">Dynamic Treatment Regime</a></li>
  <li><a href="#modified-treatment-policies" id="toc-modified-treatment-policies" class="nav-link" data-scroll-target="#modified-treatment-policies">Modified Treatment Policies</a>
  <ul class="collapse">
  <li><a href="#additive-and-multiplicative-shift-mtp" id="toc-additive-and-multiplicative-shift-mtp" class="nav-link" data-scroll-target="#additive-and-multiplicative-shift-mtp">Additive and multiplicative shift MTP</a></li>
  </ul></li>
  <li><a href="#randomized-interventions" id="toc-randomized-interventions" class="nav-link" data-scroll-target="#randomized-interventions">Randomized Interventions</a></li>
  <li><a href="#incremental-propensity-score-interventions-based-on-the-risk-ratio" id="toc-incremental-propensity-score-interventions-based-on-the-risk-ratio" class="nav-link" data-scroll-target="#incremental-propensity-score-interventions-based-on-the-risk-ratio">Incremental Propensity Score Interventions Based on the Risk Ratio</a></li>
  <li><a href="#identification-of-the-causal-parameter" id="toc-identification-of-the-causal-parameter" class="nav-link" data-scroll-target="#identification-of-the-causal-parameter">Identification of the causal parameter</a>
  <ul class="collapse">
  <li><a href="#identification-assumptions" id="toc-identification-assumptions" class="nav-link" data-scroll-target="#identification-assumptions">Identification Assumptions</a></li>
  <li><a href="#example-5" id="toc-example-5" class="nav-link" data-scroll-target="#example-5">Example</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/loader.js"></script>
<script type="module" id="qwebr-monaco-editor-init">

  // Configure the Monaco Editor's loader
  require.config({
    paths: {
      'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs'
    }
  });
</script>
<script type="module">
// Function to update Monaco Editors when body class changes
function updateMonacoEditorsOnBodyClassChange() {
    // Select the body element
    const body = document.querySelector('body');

    // Options for the observer (which mutations to observe)
    const observerOptions = {
        attributes: true,  // Observe changes to attributes
        attributeFilter: ['class'] // Only observe changes to the 'class' attribute
    };

    // Callback function to execute when mutations are observed
    const bodyClassChangeCallback = function(mutationsList, observer) {
        for(let mutation of mutationsList) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                // Class attribute has changed
                // Update all Monaco Editors on the page
                updateMonacoEditorTheme();
            }
        }
    };

    // Create an observer instance linked to the callback function
    const observer = new MutationObserver(bodyClassChangeCallback);

    // Start observing the target node for configured mutations
    observer.observe(body, observerOptions);
}

// Function to update all instances of Monaco Editors on the page
function updateMonacoEditorTheme() {
    // Determine what VS Theme to use
    const vsThemeToUse = document.body.classList.contains("quarto-dark") ? 'vs-dark' : 'vs' ;

    // Iterate through all initialized Monaco Editors
    qwebrEditorInstances.forEach( function(editorInstance) { 
        editorInstance.updateOptions({ theme: vsThemeToUse }); 
    });
}

// Call the function to start observing changes to body class
updateMonacoEditorsOnBodyClassChange();
</script>
<script type="module">
// Global array to store Monaco Editor instances
globalThis.qwebrEditorInstances = [];

// Function that builds and registers a Monaco Editor instance    
globalThis.qwebrCreateMonacoEditorInstance = function (cellData) {

  const initialCode = cellData.code;
  const qwebrCounter = cellData.id;
  const qwebrOptions = cellData.options;

  // Retrieve the previously created document elements
  let runButton = document.getElementById(`qwebr-button-run-${qwebrCounter}`);
  let resetButton = document.getElementById(`qwebr-button-reset-${qwebrCounter}`);
  let copyButton = document.getElementById(`qwebr-button-copy-${qwebrCounter}`);
  let editorDiv = document.getElementById(`qwebr-editor-${qwebrCounter}`);

  // Load the Monaco Editor and create an instance
  let editor;
  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(editorDiv, {
      value: initialCode,
      language: 'r',
      theme: 'vs-light',
      automaticLayout: true,           // Works wonderfully with RevealJS
      scrollBeyondLastLine: false,
      minimap: {
        enabled: false
      },
      fontSize: qwebrScaledFontSize(editorDiv, qwebrOptions),         
      renderLineHighlight: "none",      // Disable current line highlighting
      hideCursorInOverviewRuler: true,  // Remove cursor indictor in right hand side scroll bar
      readOnly: qwebrOptions['read-only'] ?? false,
      quickSuggestions: qwebrOptions['editor-quick-suggestions'] ?? false
    });

    // Store the official counter ID to be used in keyboard shortcuts
    editor.__qwebrCounter = qwebrCounter;

    // Store the official div container ID
    editor.__qwebrEditorId = `qwebr-editor-${qwebrCounter}`;

    // Store the initial code value and options
    editor.__qwebrinitialCode = initialCode;
    editor.__qwebrOptions = qwebrOptions;

    // Set at the model level the preferred end of line (EOL) character to LF.
    // This prevent `\r\n` from being given to the webR engine if the user is on Windows.
    // See details in: https://github.com/coatless/quarto-webr/issues/94
    // Associated error text: 
    // Error: <text>:1:7 unexpected input

    // Retrieve the underlying model
    const model = editor.getModel();
    // Set EOL for the model
    model.setEOL(monaco.editor.EndOfLineSequence.LF);

    // Dynamically modify the height of the editor window if new lines are added.
    let ignoreEvent = false;
    const updateHeight = () => {
      // Increment editor height by 2 to prevent vertical scroll bar from appearing
      const contentHeight = editor.getContentHeight() + 2;

      // Retrieve editor-max-height option
      const maxEditorHeight = qwebrOptions['editor-max-height'];

      // If editor-max-height is missing, allow infinite growth. Otherwise, threshold.
      const editorHeight = !maxEditorHeight ?  contentHeight : Math.min(contentHeight, maxEditorHeight);

      // We're avoiding a width change
      //editorDiv.style.width = `${width}px`;
      editorDiv.style.height = `${editorHeight}px`;
      try {
        ignoreEvent = true;

        // The key to resizing is this call
        editor.layout();
      } finally {
        ignoreEvent = false;
      }
    };

    // Helper function to check if selected text is empty
    function isEmptyCodeText(selectedCodeText) {
      return (selectedCodeText === null || selectedCodeText === undefined || selectedCodeText === "");
    }

    // Registry of keyboard shortcuts that should be re-added to each editor window
    // when focus changes.
    const addWebRKeyboardShortCutCommands = () => {
      // Add a keydown event listener for Shift+Enter to run all code in cell
      editor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {

        // Retrieve all text inside the editor
        qwebrExecuteCode(editor.getValue(), editor.__qwebrCounter, editor.__qwebrOptions);
      });

      // Add a keydown event listener for CMD/Ctrl+Enter to run selected code
      editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, () => {

        // Get the selected text from the editor
        const selectedText = editor.getModel().getValueInRange(editor.getSelection());
        // Check if no code is selected
        if (isEmptyCodeText(selectedText)) {
          // Obtain the current cursor position
          let currentPosition = editor.getPosition();
          // Retrieve the current line content
          let currentLine = editor.getModel().getLineContent(currentPosition.lineNumber);

          // Propose a new position to move the cursor to
          let newPosition = new monaco.Position(currentPosition.lineNumber + 1, 1);

          // Check if the new position is beyond the last line of the editor
          if (newPosition.lineNumber > editor.getModel().getLineCount()) {
            // Add a new line at the end of the editor
            editor.executeEdits("addNewLine", [{
            range: new monaco.Range(newPosition.lineNumber, 1, newPosition.lineNumber, 1),
            text: "\n", 
            forceMoveMarkers: true,
            }]);
          }
          
          // Run the entire line of code.
          qwebrExecuteCode(currentLine, editor.__qwebrCounter, editor.__qwebrOptions);

          // Move cursor to new position
          editor.setPosition(newPosition);
        } else {
          // Code to run when Ctrl+Enter is pressed with selected code
          qwebrExecuteCode(selectedText, editor.__qwebrCounter, editor.__qwebrOptions);
        }
      });
    }

    // Register an on focus event handler for when a code cell is selected to update
    // what keyboard shortcut commands should work.
    // This is a workaround to fix a regression that happened with multiple
    // editor windows since Monaco 0.32.0 
    // https://github.com/microsoft/monaco-editor/issues/2947
    editor.onDidFocusEditorText(addWebRKeyboardShortCutCommands);

    // Register an on change event for when new code is added to the editor window
    editor.onDidContentSizeChange(updateHeight);

    // Manually re-update height to account for the content we inserted into the call
    updateHeight();

    // Store the editor instance in the global dictionary
    qwebrEditorInstances[editor.__qwebrCounter] = editor;

  });

  // Add a click event listener to the run button
  runButton.onclick = function () {
    qwebrExecuteCode(editor.getValue(), editor.__qwebrCounter, editor.__qwebrOptions);
  };

  // Add a click event listener to the reset button
  copyButton.onclick = function () {
    // Retrieve current code data
    const data = editor.getValue();
    
    // Write code data onto the clipboard.
    navigator.clipboard.writeText(data || "");
  };
  
  // Add a click event listener to the copy button
  resetButton.onclick = function () {
    editor.setValue(editor.__qwebrinitialCode);
  };
  
}
</script>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Defining General, Hypothetical Interventions</h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">April 18, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<div class="hidden">
<p><span class="math display">\[
\renewcommand{\P}{\mathsf{P}}
\newcommand{\m}{\mathsf{m}}
\newcommand{\p}{\mathsf{p}}
\newcommand{\q}{\mathsf{q}}
\newcommand{\bb}{\mathsf{b}}
\newcommand{\g}{\mathsf{g}}
\newcommand{\rr}{\mathsf{r}}
\newcommand{\IF}{\mathbb{IF}}
\newcommand{\dd}{\mathsf{d}}
\newcommand{\Pn}{$\mathsf{P}_n$}
\newcommand{\E}{\mathsf{E}}
\]</span></p>
</div>
<p>Have you ever begun reading a paper in the methodological causal inference literature and encountered the phrase â€œassume the treatment or exposure is a binaryâ€¦â€? (Most papers we read assume this!!) While assuming exposure variables are binary can simplify the definition of causal effects, many exposures of interest in reality are not binary.</p>
<p><strong>Instead, we will work in situations where</strong> <span class="math inline">\(A\)</span> <strong>is a binary, categorical, multivariate, or continuous variable!</strong></p>
<hr>
<p>In the previous section, we defined <span class="math inline">\(\dd(a_t, h_t, \epsilon_t)\)</span> as a function that maps <span class="math inline">\(A_t\)</span>, <span class="math inline">\(H_t\)</span>, and potentially a randomizer <span class="math inline">\(\epsilon_t\)</span> to a new value of <span class="math inline">\(A_t\)</span>. Our focus henceforth is estimating the causal effect of an intervention, characterized by <span class="math inline">\(\dd\)</span> on the outcome <span class="math inline">\(Y\)</span>, through the causal parameter</p>
<p><span class="math display">\[
\theta = \E[Y^{\bar A^{\dd}}]\text{,}
\]</span></p>
<p>where <span class="math inline">\(Y^{\bar A^{\dd}}\)</span> is the counterfactual outcome in a world, where possibly contrary to fact, each entry of <span class="math inline">\(\bar{A} = (A_1, \ldots, A_\tau)\)</span> was modified according to the function <span class="math inline">\(\dd\)</span>.</p>
<ul>
<li><p>When <span class="math inline">\(Y\)</span> is continuous, <span class="math inline">\(\theta\)</span> is the mean population value of <span class="math inline">\(Y\)</span> under intervention <span class="math inline">\(\dd\)</span>.</p></li>
<li><p>When <span class="math inline">\(Y\)</span> is dichotomous, <span class="math inline">\(\theta\)</span> is the population proportion of event <span class="math inline">\(Y\)</span> under intervention <span class="math inline">\(\dd\)</span>.</p></li>
<li><p>When <span class="math inline">\(Y\)</span> is the indicator of an event by end of the study, <span class="math inline">\(\theta\)</span> is defined as the cumulative incidence of <span class="math inline">\(Y\)</span> under intervention <span class="math inline">\(\dd\)</span>.</p></li>
</ul>
<p>But what is this function <span class="math inline">\(\dd\)</span>, how can it be defined, and how does using this function to define interventions solve the problem? Letâ€™s start from simple to more complex examples of functions <span class="math inline">\(\dd\)</span>.</p>
<section id="static-interventions" class="level2">
<h2 class="anchored" data-anchor-id="static-interventions">Static Interventions</h2>
<p>Let <span class="math inline">\(A\)</span> denote a binary vector, such as receiving a medication, and define <span class="math inline">\(\dd(a_t, h_t, \epsilon) = 1\)</span>. This intervention characterizes a hypothetical world where all members of the population receive treatment.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>An intervention is static if the function <span class="math inline">\(\dd_t\)</span> always returns the same value regardless of the input.</p>
</div>
</div>
</div>
<section id="example" class="level4">
<h4 class="anchored" data-anchor-id="example">Example</h4>
<blockquote class="blockquote">
<p>Letâ€™s say we were interested in the effect of randomizing patients with opioid use disorder to injection naltrexone (<span class="math inline">\(A=1\)</span>) vs.&nbsp;sublingual buprenorphine (<span class="math inline">\(A=0\)</span>). We would contrast the counterfactual outcomes in a hypothetical world in which all units were treated with injection naltrexone <span class="math inline">\(\dd_1=1\)</span> versus a hypothetical world in which all units were treated with buprenorphine <span class="math inline">\(\dd_0=0\)</span>. This gives us the well-known average (comparative) treatment effect (ATE). <span class="math display">\[\E[Y^{\bar A^{\dd_1}} - Y^{\bar A^{\dd_0}}] = \E[Y^{A=1} - Y^{A=0}]\]</span></p>
</blockquote>
</section>
</section>
<section id="dynamic-treatment-regime" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-treatment-regime">Dynamic Treatment Regime</h2>
<p>Let <span class="math inline">\(A_t\)</span> denote a binary vector, such as receiving a medication, and <span class="math inline">\(H_t\)</span> a numeric vector, such as a measure of discomfort. For a given value of <span class="math inline">\(\delta\)</span>, define <span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
1 &amp;\text{ if } h_t &gt; \delta \\
0 &amp;\text{ otherwise.}
\end{cases}
\]</span></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Interventions where the output of the function <span class="math inline">\(\dd\)</span> depends <strong>only</strong> <strong>on the covariates</strong> <span class="math inline">\(H_t\)</span> are referred to as being dynamic.</p>
</div>
</div>
</div>
<section id="example-1" class="level4">
<h4 class="anchored" data-anchor-id="example-1">Example</h4>
<blockquote class="blockquote">
<p><span class="citation" data-cites="rudolph2022buprenorphine">Rudolph, Williams, et al. (<a href="#ref-rudolph2022buprenorphine" role="doc-biblioref">2022</a>)</span> examined a Buprenorphine (BUP-NX) dosing strategy among a population of patients who were taking BUP-NX for opioid use disorder. Under the hypothetical intervention, patients who reported opioid use during the week prior to a physicians exam received a BUP-NX dose increase while patients who did not report prior-week opioid use maintained the same dose. Let <span class="math inline">\(A_t\)</span> be a binary indicator for BUP-NX dose increase at week <span class="math inline">\(t\)</span> compared to week <span class="math inline">\(t-1\)</span> and <span class="math inline">\(X_t\)</span> be an indicator for opioid use at week <span class="math inline">\(t\)</span>. Then, <span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
1 \text{ if } x_{t-1} = 1\\
0 \text{ otherwise}
\end{cases}
\]</span></p>
</blockquote>
</section>
</section>
<section id="modified-treatment-policies" class="level2">
<h2 class="anchored" data-anchor-id="modified-treatment-policies">Modified Treatment Policies</h2>
<p>While much attention is given to static and dynamic interventions, their use is often accompanied by a few key problems.</p>
<ol type="1">
<li><p><strong>Defining causal effects in terms of hypothetical interventions where treatment is applied to all units may be inconceivable.</strong> For example, we may be interested to know if reducing surgery time reduces surgical complications. However, itâ€™s inconceivable to set all surgeries to a given duration, even if this duration depends on patient covariates.</p></li>
<li><p><strong>Defining causal effects in terms of hypothetical interventions where treatment is applied to all units may induce positivity violations.</strong></p></li>
</ol>
<p>A solution to these problems is to instead define causal effects using <strong>modified treatment policies (MTP).</strong></p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>An intervention characterized by a hypothetical world where the <em>natural</em> value of treatment is modified is called a <em>modified treatment policy</em>.</p>
</div>
</div>
</div>
<section id="additive-and-multiplicative-shift-mtp" class="level3">
<h3 class="anchored" data-anchor-id="additive-and-multiplicative-shift-mtp">Additive and multiplicative shift MTP</h3>
<p>Let <span class="math inline">\(A_t\)</span> denote a numeric vector. Assume that <span class="math inline">\(A_t\)</span> has support in the data such that <span class="math inline">\(P(A_t \leq u(h_t) \mid H_t = h_t) = 1\)</span>. For an analyst-defined value of <span class="math inline">\(\delta\)</span>, define <span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
a_t + \delta &amp;\text{ if } a_t + \delta \leq u(h_t) \\
a_t &amp;\text{ otherwise.}
\end{cases}
\]</span></p>
<p>Under this intervention, the natural value of exposure at time <span class="math inline">\(t\)</span> is increased by the analyst-defined value <span class="math inline">\(\delta\)</span>, whenever such an increase is feasible. This MTP is referred to as an <em>additive shift</em> <em>MTP.</em></p>
<section id="example-2" class="level4">
<h4 class="anchored" data-anchor-id="example-2">Example</h4>
<blockquote class="blockquote">
<p><span class="citation" data-cites="diaz2023nonparametric">DÄ±Ìaz et al. (<a href="#ref-diaz2023nonparametric" role="doc-biblioref">2023</a>)</span> estimated the effect of increasing P/F ratio (a measure of hypoxemia) by 50 units on survival among those patients with acute respiratory failure (a P/F ratio &lt; 300). <span class="math display">\[
\dd_t(a_t, h_t, \epsilon) = \begin{cases}
a_t + 50 &amp;\text{ if } a_t \leq 300 \\
a_t &amp;\text{ otherwise}
\end{cases}
\]</span></p>
</blockquote>
<p>We can similarly define a <em>multiplicative shift MTP</em> as</p>
<p><span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
a_t \times \delta &amp;\text{ if } a_t \times \delta \leq u(h_t) \\
a_t &amp;\text{ otherwise}.
\end{cases}
\]</span></p>
</section>
<section id="example-3" class="level4">
<h4 class="anchored" data-anchor-id="example-3">Example</h4>
<blockquote class="blockquote">
<p><span class="citation" data-cites="nugent2023demonstration">Nugent and Balzer (<a href="#ref-nugent2023demonstration" role="doc-biblioref">2023</a>)</span> evaluated the association between county-level measures of mobility and incident COVID-19 cases in the United States in the Summer and Fall of 2022. They considered both hypothetical additive and multiplicative MTPs; for example, they defined a multiplicative MTP where a measure for the density of mobile devices visiting commercial locations was decreased by 25%: <span class="math display">\[
\dd(a_t, h_t, \epsilon) = a_t \times 0.75.
\]</span></p>
</blockquote>
</section>
</section>
</section>
<section id="randomized-interventions" class="level2">
<h2 class="anchored" data-anchor-id="randomized-interventions">Randomized Interventions</h2>
<p>Let <span class="math inline">\(A\)</span> denote a binary vector, <span class="math inline">\(\epsilon \sim U(0, 1)\)</span>, and <span class="math inline">\(\epsilon\)</span> be an analyst-defined value between 0 and 1. We may then define randomized interventions. For example, imagine we are interested in a hypothetical world where half of all smokers quit smoking. This intervention would be defined as</p>
<p><span class="math display">\[
\dd(a_t, \epsilon_t) = \begin{cases}
0 &amp;\text{ if } \epsilon_t &lt; 0.5 \text{ and } a_t = 1 \\
a_t &amp;\text{ otherwise}
\end{cases}.
\]</span></p>
</section>
<section id="incremental-propensity-score-interventions-based-on-the-risk-ratio" class="level2">
<h2 class="anchored" data-anchor-id="incremental-propensity-score-interventions-based-on-the-risk-ratio">Incremental Propensity Score Interventions Based on the Risk Ratio</h2>
<p>Let <span class="math inline">\(A\)</span> denote a binary variable, <span class="math inline">\(\epsilon \sim U(0, 1)\)</span>, and <span class="math inline">\(\delta\)</span> be an analyst-defined risk ratio limited to be between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>. In addition, define <span class="math inline">\(P(A_t = a_t\mid H_t)= \g(a_t \mid H_t)\)</span>.</p>
<p>If we were interested in an intervention that decreased the likelihood of receiving treatment, define</p>
<p><span class="math display">\[
\dd_t(a_t, h_t, \epsilon_t) = \begin{cases}
a_t &amp;\text{ if } \epsilon_t &lt; \delta \\
0 &amp;\text{ otherwise}
\end{cases}.
\]</span> In this case, we have <span class="math inline">\(\g^\dd(a_t \mid H_t) = a_t \delta \g_t(1 \mid H_t) + (1 - a_t) (1 - \delta \g_t(1\mid H_t))\)</span>, which leads to a risk ratio of <span class="math inline">\(\g_t^\dd(1 \mid H_t)/\g_t(1\mid H_t) = \delta\)</span> for comparing the propensity score post- vs pre-intervention.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>An intervention where the conditional probability of treatment is shifted is referred to as an incremental propensity score intervention.</p>
</div>
</div>
</div>
<p>Conversely, if we were interested in an intervention that increased the likelihood of receiving treatment, define</p>
<p><span class="math display">\[
\dd_t(a_t, h_t, \epsilon_t) = \begin{cases}
a_t &amp;\text{ if } \epsilon_t &lt; \delta \\
1 &amp;\text{ otherwise.}
\end{cases}
\]</span></p>
<p>Now <span class="math inline">\(\g_t^\dd(a_t \mid H_t) = a_t (1 - \delta \g_t(0\mid H_t)) + (1 - a_t) \delta \g_t(0 \mid H_t)\)</span>, which implies a risk ratio <span class="math inline">\(\g_t^\dd(0\mid H_t)/\g(0\mid H_t) = \delta\)</span>.</p>
<div class="callout callout-style-simple callout-caution">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Interventions where the shift is in the odds ratio scale were previously proposed, but the effects of odds-ratio shifts should not be estimated with <code>lmtp</code>, we will discuss this more later.</p>
</div>
</div>
</div>
<section id="example-4" class="level4">
<h4 class="anchored" data-anchor-id="example-4">Example</h4>
<blockquote class="blockquote">
<p>Using electronic health record data, <span class="citation" data-cites="wen2023intervention">Wen, Marcus, and Young (<a href="#ref-wen2023intervention" role="doc-biblioref">2023</a>)</span> estimated the effect of increasing the proportion of PrEP uptake on bacterial STI among cis-gender males being tested for STIs and that do not have HIV. Let <span class="math inline">\(A_t\)</span> be a binary indicator for PrEP initiation at week <span class="math inline">\(t\)</span>, and <span class="math inline">\(L_t\)</span> be a binary indicator for any STI testing and being HIV-free at week <span class="math inline">\(t\)</span>. They defined a â€œmediumâ€ successful PrEP uptake intervention as <span class="math display">\[
\dd(a_t, h_t, \epsilon) = \begin{cases}
a_t &amp;\text{ if } l_t = 1 \text{ and } \epsilon_t &lt; 0.85 \\
1 &amp;\text{ otherwise}.
\end{cases}
\]</span></p>
</blockquote>
</section>
</section>
<section id="identification-of-the-causal-parameter" class="level2">
<h2 class="anchored" data-anchor-id="identification-of-the-causal-parameter">Identification of the causal parameter</h2>
<p>Recall that the fundamental problem of causal inference is that we canâ€™t observe the alternative worlds which we use to define causal effects. If we canâ€™t observe counterfactual variables, then how can we learn a causal effect? Under a set of certain assumptions, we can <em>identify</em> a causal parameter from observed data. These assumptions are called identification assumptions.</p>
<section id="identification-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="identification-assumptions">Identification Assumptions</h3>
<ol type="1">
<li><p><em>Positivity</em>. If <span class="math inline">\((a_t, h_t) \in \text{supp}\{A_t, H_t\}\)</span> then <span class="math inline">\(\dd(a_t, h_t) \in \text{supp}\{A_t, H_t\}\)</span> for <span class="math inline">\(t \in \{1, ..., \tau\}\)</span>.</p>
<blockquote class="blockquote">
<p>If there is a unit with observed treatment value <span class="math inline">\(a_t\)</span> and covariates <span class="math inline">\(h_t\)</span>, there must also be a unit with treatment value <span class="math inline">\(\dd(a_t, h_t)\)</span> and covariates <span class="math inline">\(h_t\)</span>.</p>
</blockquote></li>
<li><p><em>No unmeasured confounders.</em> All the common causes of <span class="math inline">\(A_t\)</span> and <span class="math inline">\((L_s, A_s, Y)\)</span> are measured and contained in <span class="math inline">\(H_t\)</span> for all <span class="math inline">\(s \in \{t+1, ..., \tau\}\)</span>.</p>
<blockquote class="blockquote">
<p>For all times <span class="math inline">\(t\)</span>, the history <span class="math inline">\(H_t\)</span> contains sufficient variables to adjust for confounding of <span class="math inline">\(A_t\)</span> and any subsequent variables, including future treatment.</p>
</blockquote></li>
</ol>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Question</strong>: When might these assumptions be violated?</p>
</div>
</div>
</div>
<p>Assuming the above, <span class="math inline">\(\theta\)</span> is identified from the observed data with:</p>
<p>Set <span class="math inline">\(\m_{\tau+1} = Y\)</span> For <span class="math inline">\(t = \tau, ..., 1\)</span>, recursively define</p>
<p><span class="math display">\[
\m_t: (a_t, h_t) \rightarrow \E[\m_{t + 1}(A^{\dd}_{t+1}, H_{t + 1}) \mid A_t = a_t, H_t = h_t],
\]</span></p>
<p>and define <span class="math inline">\(\theta = E[\m_1(A^{\dd}_1, L_1)]\)</span>.</p>
</section>
<section id="example-5" class="level3">
<h3 class="anchored" data-anchor-id="example-5">Example</h3>
<p>Consider the following data where <span class="math inline">\(\tau = 2\)</span>.</p>
<div id="qwebr-insertion-location-1"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c9a04c32628b2ec5d8cc" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c9a04c32628b2ec5d8cc">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500"],[-0.1007840650787596,0.3977771339538654,0.3615710994185271,1.097290478843439,-2.270324344305685,0.001525729866952272,-1.301316494766338,0.431088891418879,-2.154632049370653,-0.2968337316365002,0.4006674185475491,0.6469624805970682,0.7239914452292833,0.2531705749572135,0.9892479208083657,-1.947143659867536,0.4139214126945672,-0.724655630635509,-0.5007237951513689,-0.2069011810191737,-1.631216787550956,-3.093382648130906,0.2274917683445896,-1.09502177587486,-0.8090288103449202,-1.132573164372525,-0.637369044453291,-0.4587165794733342,-0.6365245124066206,0.1295434109640913,0.5840160598664276,0.7693575582302429,0.9949023284295783,0.3524920004093428,0.9728320111817551,0.1746000842925777,0.5286562563342254,-0.6759588482617485,0.827338576018236,0.1698585626133516,0.1968128363103888,-0.5246723790355418,0.6944701799599768,0.523528989085325,-0.7771808045691522,1.052511219812311,1.481170346488044,0.1565135439902781,0.2387032504647067,-0.02337222725934237,-0.3959479880774747,1.024204312629876,0.6749169217288588,0.6396684180649765,0.9549814951628089,-0.5024588331441729,-0.1425808903309211,-0.9479476203261551,-0.5453439592528816,-0.5381574089446995,-0.9003556672338062,-1.207674514553686,-0.3286883226446663,0.2548996746728215,0.174258294645267,0.9827619919203151,-0.00533615288530517,0.6807506287939822,-0.7293909839761737,0.3919475400231518,-0.7176820981825696,1.001966020733021,0.2098694036643234,-0.2924212291323956,-0.07322611783625296,0.1345031993037078,0.2867258951156425,-0.5963096426152122,0.7778627610631974,-2.316640684325397,-0.1412042034075097,-0.1512527095155884,1.168868228111824,0.6937768500221144,0.9241345138998883,-0.3945353795573929,-0.5792872563812396,1.322873081043211,1.695125212529307,0.614359756024627,-0.8428637718024008,0.7491231522295031,-2.07841388806595,1.524321776183344,0.3641935498928248,-0.1458363317836024,0.7357692272211416,-1.49676559214187,0.01109535506839108,1.600406897613892,-1.596264367538502,-0.9347692467643947,-0.8008902900621533,0.9755503643642232,0.3649110371266435,0.2938298992200861,0.4048961273308022,-0.08404485758462957,0.07716654593405307,0.19904455933743,-0.3898782447897673,2.18056639662356,0.2141991498238634,0.8773149729630499,0.7368041190575544,-0.08489281639086721,-0.2050575277631141,-1.355429058223959,1.110627839334208,-5.192785990258134e-05,-0.3868406256615144,0.3214207950524307,1.643903882355858,1.319643231111752,0.01421221084939525,-0.155660243669736,2.264636635349961,-1.256682432015928,-0.7153616199707309,-1.33673419197919,-0.04592664109916281,-1.131668972560842,-1.187845140654506,0.3172341635020366,1.55410863772527,0.7542723012073016,-1.375934568997798,0.7189791646192385,-0.2619529653703927,-0.6782831617523215,0.6221114036469509,-2.102737043362933,-1.134591319761733,-2.109620410895335,-1.890974546862512,1.075845855001242,-2.957576440702671,0.698528143542581,0.9906270418105503,1.733839871339603,-0.7943875737300783,-1.169223201314179,0.3486904179042621,-0.7399146210238631,-1.849712434966235,-1.896591491805679,-0.2985839717130132,0.6763853384384394,0.2732807202260351,-0.495027359401147,-0.9868882492023356,0.8965869182243249,-1.453183350144105,0.2865272838843896,0.2773103689859105,-0.04119298709309038,-0.8190183428338085,-0.7397118220768925,1.584844827660236,0.6215422886787569,0.7753362800593442,0.1609380253035006,0.9810852853351387,-1.448599059627113,-0.8446498913980113,-0.8989059254107364,0.6346507668017702,0.5168283842330542,-0.1071610760932712,0.8631712219020398,0.09583900591030521,0.7998850897805722,-0.3532793980507464,-1.127214192699483,-0.6060671079209405,-0.8195929792957598,1.88532726223234,1.287315159828493,1.693702075423558,1.35970955908296,-0.3769044288587179,0.9300520461359473,0.1395170055697844,0.305025279654022,0.7437799667389688,-1.129172974025445,-0.8080196728211151,0.1929756986640497,0.1230636784467071,0.8509203165329322,-0.2632865368198816,-0.8852330471721108,-2.376208724871548,-2.465735084472609,-0.4117295264904902,0.9217214774095389,-1.282673127252471,0.1846535028643538,-1.829337075619684,-0.1438114830827998,0.2940920680355915,0.1011915902698582,1.544575322916078,-0.8185557936803549,0.8778543202058978,-1.179594936972969,-0.3932406467129594,-0.8629087401525068,0.006909140910893416,-1.496467419064374,0.02154319019410117,0.904607567759063,1.054688633971288,0.4658072200745305,0.2700281726681433,-0.230121720027428,0.5131581737073975,-0.6134655958495534,-0.503783978868685,-1.008058807614769,1.119366501809041,0.5353331976144655,0.4382385596930891,0.4240163483955995,0.8406574908150195,0.7905002623374905,-0.7429509305011017,2.504565465561094,0.02860647569438083,0.8934027861800512,1.463353241345158,0.7379773842423561,-0.689869931706534,0.1948973936461433,-0.5268831905763746,-0.7484082321465683,-0.1498141782330652,-3.012147533507117,0.8374064780610825,-0.7842348128921315,-1.122459458137657,0.1226224116300676,0.6685989940719599,0.2099467604320733,0.1882600764998912,-0.06134425226231029,1.543312585327602,-0.3158433641289328,-0.2393200234311264,1.07254662652217,-0.9041508193154869,-1.652035864055993,0.04623265875226458,-1.492278928870562,0.8148011599444612,0.6778502631931405,-0.7684553123722502,0.06970284763879755,-0.4728995759188946,-1.171815513393033,-0.7892633057745488,-0.7973665539896281,-1.17509698048858,0.4988026043860971,1.28250017677014,-1.490267103768404,1.138996481941236,1.62772565842692,-0.7602084724763162,1.594919581064697,-1.444352534820545,-0.4898329455723469,0.06105872060234378,-1.155998250145503,-1.028988559138434,-0.4617232051170915,1.041015463443886,-0.3040656588581621,-0.8052662224910133,0.1889809438849759,-0.4487127058335721,-0.5650813785292673,-0.2034440412699731,-0.7550141673871327,-0.1429345831490247,0.08817431462982106,-0.3626692354524571,0.151836881614318,0.2908749601477381,-1.12365161817364,-0.02814661759297926,1.360722751269721,1.06947244547056,-0.5709657529098461,-0.8697156235091427,-1.076897842358956,-1.458768034790175,-1.2336396299849,-0.593957463334967,0.7345174114118083,-0.02597418042322223,-1.070182828787968,0.01008304762098413,2.434656224535509,0.5215207257341067,1.607149137916572,0.08257942514864557,-2.835182800340506,1.177302743233534,0.4843995644565346,-0.1301262173912218,-0.7405274169121963,0.5903523247186929,-0.2943347705855509,-0.8903436402184119,-0.1818143012507066,0.6963448570310959,-0.2887403731908734,0.8531473101872245,0.09039635115201575,-1.051603833286149,-1.105885329629927,-0.3691246842373938,1.281033851813762,-1.328959186756973,0.09095795217599814,-0.4154245745389495,1.538729889705168,-0.2116691309788884,-0.7259171065790097,-0.2679304330080469,-0.2040281289653519,0.16400738496582,-0.730302481929249,-1.869989742197883,-0.05821883389961648,0.4914222889346012,0.1195969490285378,-1.09558113846593,0.5217224382509047,1.847508500573769,0.4350640784635205,-1.63700643628914,-0.6192369265438382,-0.2222905504021379,-0.9540715189457362,-0.2876897593290975,0.6781281173651919,-0.950283537353604,0.4780866136566416,0.5873988592522809,0.9734547373360773,-1.548890119640183,0.6408198379906869,0.9219390107308231,-0.2593331678658199,-0.4265080492108214,-1.880361124421248,0.5692857706229776,0.6719310368696184,0.05913060736483552,-1.191563571140053,-0.43267826688137,1.69064977182741,-0.9512701510567613,0.9510583570762473,0.5624229111333459,-0.658945195465616,0.6813702687143618,-0.4536437995380857,-0.7189910726249966,-0.472916097927423,1.308079575822585,-1.419960038135222,-0.6760026585379374,1.066435813703541,-0.4358915847702449,0.3056166051788416,-0.3872474268406104,-1.42887585979375,-0.0769670698926318,0.9200508525706572,0.1609817330978351,-0.5840045538368009,-0.7586393926081709,-0.1448919770992377,-0.1192274005155964,-1.71117958163291,-1.107185808182196,0.3803726077108086,-0.8339948391257278,1.166215148395679,0.5720254519663082,-1.269948635963254,0.9436652765073735,-0.8630578296086044,1.432677848823922,-0.2545690282302922,0.6082947801029294,1.366631608534131,0.4506880903991331,0.8025000921611396,-0.4452797819019425,0.1236115654555404,1.278342931682533,-0.2038774563455067,0.525763881780057,-0.649285444689635,0.2864295524226114,-0.2488914101126503,1.803280998495263,-0.7556955530772522,-0.4083569292565425,-0.07419291269103113,-0.1748417955889535,-2.06789890227248,2.238086037115076,-1.934366346470149,-1.38096124115099,-0.3119412757415866,0.6807756416402744,0.1875270655658629,-0.6452123581768607,0.1451990241926165,-0.3886996460640185,-0.8019107555373096,0.5990791724652644,0.1798835461666479,0.8181970328122168,0.7680201759986911,-1.803240299901482,2.397503709448933,0.1238684535279512,0.3677079638437247,-1.053598452839211,-0.5140589254906929,-1.718177748903419,1.119378141138934,1.798586246653504,1.662476289426669,-0.5302391423247855,-0.04432348026370211,-1.279347234318626,-0.1750460268677,0.3347098711146254,0.5272284812030718,-0.1603794406557932,-0.7765025715267181,-0.5541925924776178,0.6252638469754901,-1.670532629620213,0.2072751343179198,-0.654663196441393,-0.2234468956574632,-0.7143147900168025,-0.9589144359930526,0.3475815915683307,0.5278440407707432,1.087566383430522,-0.6278822973877767,-1.626069430082399,-1.395205540644886,0.7703512157070924,-1.494257673883014,-0.3079211046043591,0.8608110459014184,-0.3107311892428529,1.081472300642827,-1.139115633468145,-0.4223250506095904,0.9687855801653059,-0.197685296369187,-1.143204852667819,-0.8025224987306691,1.7015561119876,-2.140636318751437,-1.887230852023053,-0.1923841901026425,-0.09125446729971534,-0.3474714326913709,0.9438460559720213,1.068751211651928,1.47912774853669,-0.5370571045450278,-1.033485824357081,-1.130251303148366,-1.609222503058046,-0.4881688413506655,-0.6349741333446963,1.575805591739952],[1,0,1,1,0,1,0,0,0,0,1,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,0,0,0,1,0,1,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,1,1,0,0,0,1,1,1,0,1,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,1,0,1,1,0,0,0,1,0,0,1,1,1,0,0,1,0,0,0,1,0,0,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,0,0,0,1,0,0,1,1,1,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,1,1,0,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1,1,0,1,1,0,1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,1,0,0,0,0,0,0,1,0,1,0,0,1,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,1,0,1,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1],[0.3042262174930777,-0.7392868122561091,-1.267621202530204,0.5103076052013291,-0.4698535573020968,-0.6448461630642042,0.9113040811556831,1.107286885396845,2.111887831789346,-2.113942542744987,-1.025777302122164,-0.6377130523100897,-0.3955827395583419,-0.2304609399877667,0.6751588098662401,-1.480807146575282,1.206106542188427,0.1007277025373198,0.8873173696960702,0.9448361914586556,-0.8035602104870058,0.1577529883416014,-0.08699087941635202,-0.3940199754347243,0.6151384242679222,0.6106131048455041,1.660055658108276,-0.00879000505704342,-0.2062187377173365,-0.2229852117708131,-0.249342275815016,1.446384663179444,0.336303535935622,-0.3374945869051373,-0.3747868507476699,0.5347816487812787,0.1835159620797893,0.7111191598360588,0.3992150418952621,0.4658407102319181,-0.4266128092231495,-0.437672025670345,0.633470108063355,1.15704755167031,-0.2364662099146819,0.5530703402274407,0.111519346813776,2.071659201678501,0.5384305158872434,1.676710560763281,-0.130696224458499,1.821017660331772,-1.176201825305301,-0.9234237131820016,0.3887683972559156,0.2850512625261935,0.4831858683861606,-0.5020279754023643,1.01565815926795,-1.07343238245187,-0.86691574151664,1.23743918621369,-0.8674888638411705,-0.4679380807410065,1.441456191469711,1.164613909486543,-0.6617894876171433,0.6032104118882188,0.3698855403092204,-0.6407414150224887,0.2715433268624959,0.7828914328171835,0.8072577483393285,1.376435874081429,-0.291045660622393,-1.196841407560864,0.7876172242217065,1.369140577027412,0.1193154298296323,-2.642509847829968,-0.0750304918542854,0.09364042598676511,-1.819781531898426,-0.03221137394827783,1.704103931245005,-0.5122698980521435,-0.1515779579269149,-1.492748464167944,0.2575794384225092,2.666458689605074,-0.5059993864986917,-1.605160855612101,-0.5412468258904359,-0.8434367203830243,-0.9243659561282667,0.2521485869259484,1.223798861901774,-0.5351301016961153,0.4107744835770756,2.269408875330829,-1.638567530969834,1.167860935289929,1.546033626624776,0.394808974885161,1.84554735791456,1.057850028452135,1.130070215519319,-0.2609716071035233,0.2455505601414437,0.1026982741756757,0.9869310955789969,0.07975197342628984,0.3018688376302284,-0.6901997939447394,-1.63568510437995,-1.012802298538647,0.1751215231450303,-1.714904824178852,0.01411230421612339,1.390250387278376,0.9661098132543782,-0.07544029137147108,0.1828441136815298,0.1969806591881038,-0.5934306684863758,0.56392834653831,0.3802616345533059,0.5130635321386093,0.8502154071079772,-0.4553579265035664,0.003488943432721883,0.8856833711687169,0.1586165485746255,-0.8319019232178585,-0.0566182913499098,-1.303820027384814,0.9556112450691072,-0.6301490580168004,1.111418928083601,-0.5636644777972453,0.9342176902497664,-1.125943404134168,-0.9807796643528237,0.6672214451096611,0.418487466071339,-0.4278461010294112,-0.4721798142152387,0.9927475392444476,1.744702939617486,0.7931517766062336,0.2983041131778264,0.9618561879718572,0.9234423508461492,2.045202500876572,-0.6561772682307867,1.702354071798158,-0.110825955195231,1.535828793634035,-1.368512769874906,-0.3469319096176546,0.5396409277033358,-0.9684394441709209,-1.442521841448738,-1.237634619508474,1.6795879831595,0.2726799760353703,0.4564470428145835,-1.303070473605968,-0.5536568807956426,0.8605879911052514,-0.2960572104508807,0.4718196727455867,-0.9082729484774702,-0.7484870448921952,0.6131927273549587,0.9773672916935139,-0.01616547198485052,1.252388974125004,-1.693908613416821,-0.3940809856110754,0.7599719581082282,-0.2780910534245075,-0.9248643508555012,-0.2682075517384933,-0.2155982468468442,-0.3629660501972432,0.9482454346513558,-0.6620941479113718,1.000442654411092,-1.599834566057828,1.306444405935162,2.044996759893505,0.4791040406933377,-0.3306980277638882,1.725118812024481,0.1784947231284363,1.022768308839797,1.468414922482704,-0.4840744275015582,-0.2290172895732911,0.01748328977558245,-2.378420114410869,1.156738711633427,0.5715715184611493,-1.183138916301688,-0.7080570786791404,0.0369693457453103,-2.305919833493381,1.197204450391074,-3.005172065284322,0.7287767914178148,1.724416697690985,-0.1296072206026219,0.3363306850515719,0.6188752776258353,1.616342049932124,1.056915065921823,0.67844793678334,-0.399116566752051,0.3142440966799594,0.5394173662335917,0.6619137574409724,1.131919047750583,-1.57718251310518,2.550057568042572,0.6066362624350622,-0.6566599702187945,0.7970726287265045,0.5036180035692316,1.609024860299545,-2.530775145632554,1.524709329157509,-0.256726109023609,-0.5966412263522408,0.8973806905198176,-0.750191221778443,-0.2703693863624775,-0.3985308244618599,1.129715479357148,-0.4160420803685705,0.5911733018018591,1.408618600944277,-0.0637971277554633,-0.5122921815974749,0.1767641174758287,-0.8229453518778195,-0.1495298607558412,0.8388292867082547,-1.472947393750016,1.582037053130204,-0.1329672757448064,0.4101982881050378,1.712717211339409,-0.1165138426147773,-0.4368597828742657,-0.2316741375563608,0.5731075198911867,0.7544166399202424,-0.689522840887532,-0.1424738865357272,0.3089890655893765,-0.2687300550053001,-0.2969485843407283,-1.392881577647849,-1.983011461626211,-0.7403417986223222,-0.1805385139899503,0.6230803949890955,-0.260566323664311,-1.180796820014329,-0.01334003322571425,0.2997682614259032,0.2213095033704947,0.7082506773129934,1.048397024249987,1.532852973659699,-0.893421319927874,-0.5796027938611839,1.517689419849361,-0.2302019958528943,-0.5354660267451772,0.04776424329439509,-0.9890274139325542,1.477673613930822,-0.07983118923981697,0.6137372340722688,-0.6623350541176609,1.260877468149798,1.309693522630255,0.2114570469836037,-0.03356356237369767,-1.026177411669846,-0.8932926477081877,-0.689292626809751,-0.2503070248312548,-1.284121477364966,0.3415328325802848,0.5017527734800812,-3.078558621345329,0.1445932045832882,0.8119599011262084,0.2281693143975423,-0.8858937464714348,1.423713822997181,-0.2289263772887984,-0.4119459511520606,0.649850977467664,1.343407157577646,-0.4975023528855192,-0.7028317860434647,0.4484963869618117,-1.193300223796544,0.5486557624674016,-0.3582830516930119,0.4595485117021044,1.091839868810374,-1.129064330178505,-0.6414215845336881,0.4632395011173869,0.6658517879140864,0.4631767082012909,-0.01669023194308635,-1.174010204938692,1.489852282102091,2.146375876960414,-0.3941787057978031,-0.5705883820751181,-0.818631558061977,0.1708359480837417,-0.1834704802379568,-0.09847030525326364,0.5112984945763859,-0.709573496871935,2.47838880581386,0.8830627180804815,0.8845264974632258,-0.09840159820244473,1.104101983219836,0.6751670670711156,0.9776430509318519,1.064661049579207,1.145644497269537,-0.4996210977709283,-0.8982974760730081,1.372718986117059,0.3287753791526672,0.7122094273182081,-0.8473662353520754,0.1072262936283759,-0.2221713179068132,2.250560752862475,-0.178292624713426,0.3040905083189707,-0.939582458284248,-1.538564105155767,-0.636278209307684,0.3504697912236291,-0.4929945600200891,-0.4822142523777638,0.4323300122810804,-0.1059770928248168,-0.8290633012854578,1.346803392948193,0.1550719344203852,-1.723592109684299,0.6152288415652878,0.8443795104879117,0.6883141732591275,0.4076206617331147,-1.029745814524159,-0.05836345889065895,0.6576872961623748,-0.7637103562082217,1.084655262093047,-0.1252982063094396,-0.3147400207730112,0.1023030825113357,-0.9605269950838221,-0.5097539945953563,0.7391608694438985,1.054829106499149,-1.392181165692898,-0.1765893610326567,0.7836426200976319,-0.2251805776962063,-0.01216239253118379,1.37336140487314,-0.7790374338947327,0.5312860710566134,0.7956858824006986,0.6345515007877681,0.5298205593891041,1.692500482603734,1.291508829920894,0.5638602279187616,1.735926649090336,-0.3213813297858867,-0.6266679725730094,1.164022775299099,0.5611119657559867,-0.1397790008897949,-1.078120982264641,-0.3869397404011486,0.2843725494438857,0.3888741727873024,0.1305663663934462,0.9169717486349476,-0.3020650517583747,1.166320365047983,-2.109576776774349,-0.4334707673313422,-0.355484672197639,0.2333780606753273,-2.11789914409065,-0.3985754244210298,-1.737443838351759,0.6167810811249383,-1.853059141869826,-0.3830821979578927,-0.7615288574937606,-0.3822815166989564,0.4574588264279125,0.03457597544785611,-1.684675070347805,-1.330651966454745,0.7127142963817925,0.599157760037471,-0.3834899954942125,-0.4571229756841337,-0.2447507047430295,-0.009325397728915023,0.1867048220682453,-0.01542181502377099,0.9180251075985457,0.6222507642669138,0.4661562521664558,-0.202926295811545,-0.3329973839367075,-0.164892368184188,-0.8008726060048613,0.8126661876582455,1.160977495483955,0.1723478575171097,0.06191017104849277,0.7148927918058378,-0.3339690082368595,-2.677371466494202,-0.01818624103852231,1.20100990533204,-1.297925912110204,-0.7462188652706101,1.248999155194296,-1.465268639457418,0.03516180216485282,1.343195841380919,-0.8366744723626908,-1.097219619666117,-0.1816238460151516,0.4099624370635608,-0.06093869259746221,0.8498036172330297,1.205138784630649,0.2412443933103256,1.061524600390331,0.5959847052798302,-0.7575468091547666,0.6654648087870551,1.609749520412584,-1.686222519819905,0.1373823310982914,-0.3356604341239702,-0.4477549816807894,0.8702638158937431,0.4541342160841307,0.1207940209018372,-2.745822384949636,-0.05791539266602361,0.1712045365666438,-1.236852703351873,1.304605627242653,-0.5185578321451818,0.04759760038111593,0.5574972717521662,0.7684848843920227,-0.3683327208215343,0.3381652005384448,-0.1834535419427221,0.4860896630156429,1.5781816739003,-1.316527264866115,-0.2124220640064021,0.8582610609038199,-0.396041062449946,0.4027438774989581,1.98450425428087,0.9418601595860281,0.9096002874462985,0.9129839591000468,0.6382912558018899,0.4157930442577016],[1,0,0,1,0,1,1,1,1,0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,1,1,1,0,1,1,0,1,1,1,0,0,0,1,0,1,1,0,1,1,1,1,0,0,0,0,1,1,0,0,1,1,1,0,1,0,0,1,0,0,1,1,0,0,0,0,1,1,1,1,1,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,0,1,0,1,0,1,1,1,0,0,0,1,0,1,0,1,1,0,1,1,1,0,0,1,0,1,0,0,0,0,1,1,0,1,0,1,0,1,0,0,0,1,1,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,1,0,1,1,0,0,1,1,0,0,0,0,0,1,0,1,0,1,0,1,1,1,0,1,1,0,1,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,1,1,0,0,1,0,0,0,1,1,0,1,0,0,1,1,1,0,0,0,0,0,1,0,1,0,0,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,0,0,0,0,0,1,0,0,1,0,1,1,1,0,0,1,1,0,0,0,0,1,0,0,1,0,0,1,1,0,1,0,0,1,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,1,0,0,1,0,0,0,0,0,0,1,0,1,1,0,0,1,0,0,0,1,1,0,1,0,1,1,1,1,1,0,0,1,0,1,0,1,0,0,0,0,1,0,1,0,1,0,0,1,0,1,1,0,1,1,1,0,1,0,1,1,1],[1.543933136386691,0.04697315962249131,2.711478530367732,0.2528616734060847,3.041017577261578,2.526171812657719,2.15547275535566,-3.136234454041743,-2.370693488467352,4.44354779381849,2.768403600930404,-1.304603034350832,-1.455656197841607,0.8168896751055802,-1.795132204536416,4.946753641792072,0.6629561611055914,0.171120255630889,-1.243047045766657,-0.2798287629576122,2.997911974307824,1.755681310957334,-2.963846770040506,2.064535372277909,0.7127560506677716,-0.009286626649999963,-3.27766026224959,0.8548118708552791,-0.6304670249662547,3.770786079794787,-0.5962252767279286,-0.740606663953399,3.156591932168354,4.09202147015473,-0.949616819410471,-0.8459822413594009,-3.501750024627818,-0.2461409896807876,-2.877267410931266,1.402476539923209,4.290508932807164,1.866900345691336,-1.036039348132302,-2.20865669278769,1.655334537908743,0.4599271771969693,-1.422662929870273,-5.231700312115096,-1.177303490305979,-1.1123513297923,3.307358703673415,-4.282234926527217,1.063056108975742,0.05514844709900327,-2.354809354447889,-0.2048230091061629,2.656520174215869,1.014462905026831,0.9891352072279067,1.981626714351298,2.128984530857593,-0.2803894681437359,1.489947731430635,-0.2890261510038795,1.015135309256004,-5.017730339769789,1.406574748478232,-4.063008706932507,-2.230152339208818,0.191946990202728,-0.2107886756702616,-1.532116528569818,-3.461346829036395,0.3025638388083878,2.932915792031118,-0.1179182095572711,-3.594238238232073,-1.019814226203648,-2.357744406736956,6.786768238339902,-1.40018934980335,-2.149982933122013,4.80399472271073,-0.09777069483402268,-4.063718755646173,1.936615511747191,-0.2530095288769275,4.406652012914241,-0.1546050419458523,-2.380700376810865,1.455886360488915,3.999240543140808,1.225928832767599,1.858426438890917,-0.3059529882111688,-1.621349889547131,-2.846351827856744,1.15187232802977,-2.12286647458728,-3.786078467418278,3.625978544208484,-1.665842599827987,-2.569921740361098,-1.003318827282281,-0.472872435993908,-4.833017832893601,-2.621355562668413,-1.007782369799782,-1.404082475388081,-1.495450128689137,-1.99877983672925,-0.6710850346769697,-1.171186856899548,1.934237026845178,0.7886093053130976,-0.1447665926618109,-1.272602819441146,4.001988511548005,0.7378950786011551,-3.201925104203743,-0.4499079098149057,2.13610683906519,1.145649465783044,-0.07915250813105124,0.8206493577958283,-0.437344932508223,-2.424652701845704,-1.336030075361367,0.3513284964678919,-0.5504993093258985,0.5944798102680368,-2.741587163093492,-0.9705893245327971,4.439300508444983,1.106928776601936,0.8683784633095182,-0.9386538715561716,-0.6784222794310345,-1.886768573972201,1.935851050705862,-1.134210345561292,3.55239197304019,3.160590887525973,0.6389476102560784,3.321783407113782,2.82391037682495,3.61431908451081,-3.845132757088723,-2.281298317468811,-1.635575131168453,0.5062292785405786,-1.249568352693146,-0.1712903132164004,-3.365957646478275,2.869167469126001,-1.418270437649991,1.758678244903551,-2.657599356710841,3.546063951523434,-0.4714068805385617,1.179164721771553,2.062870147836941,3.702115620130328,3.292134850041162,-1.809664002386804,-0.9051187128034773,-1.395150999275547,3.244061165608109,0.8119717448497119,0.2182484951350292,-0.03687815371248515,-0.01402128915736767,1.429629897379206,4.769257415067892,-0.5968582357666886,-1.903933064472992,-0.9716640476993997,-0.8290566919522925,5.217027135768808,0.7177137307014532,-2.03544585889507,-2.459185573809736,2.558554045123798,0.8314177566018947,1.264025780343601,2.411846721646857,-0.4115398624449731,-1.747852770484126,0.02051811499257394,1.897177681401912,-2.344413199658816,-2.823731657230066,0.205573343784776,-2.173929365968564,-2.794298437820042,1.097586008575486,-0.903480192310316,-0.1671428556014782,0.9074620767956235,2.252858602058788,0.1468975983434988,4.660691083720884,1.429010061149746,1.229025914829798,2.314847009180502,0.52903006577836,0.06614026848584037,3.365207930987773,1.402650595384672,7.288186189023524,1.352544262897232,-4.277330619915308,0.2769448227996133,0.05967897758810681,0.5524007690788744,-3.751446140252228,-2.172686189398155,0.8269381216828258,0.9090302650770841,1.36122364071908,-2.674893532341395,-0.2937139864698639,-4.195375171636485,3.91338555713393,-5.568747916995107,-4.212221834835884,0.09834659824601955,1.003382935608677,-1.327258050822921,-1.390788729854342,5.191625672761341,-4.576362859763953,1.768530209513266,-1.995342025280603,-1.003573274475344,2.483256111096716,-0.5914038005625241,1.246110550549415,-3.181347100775421,-0.2042308418523275,-2.879671412665901,-3.597910254445624,0.7596935266614939,-0.5763893443384135,-1.233622906620643,1.893709927950547,0.6332571652585806,2.130711060727229,3.093517348275872,-1.747570395840536,1.839526405948366,-0.08336741637738188,-3.517806312975766,-2.393787490945804,-0.1868407681002401,0.7890927692526898,-1.144395670519171,0.3351648797320383,0.9879760104409243,3.14068513502609,-0.6983532179823693,1.172619010136939,-2.284394987258737,3.741548647858799,4.227501529641674,-0.1263686166485024,5.956040357260989,-1.464392088306431,1.630529263088624,3.42127925534373,0.2663862963508862,-2.376842248224718,1.026691721208888,-0.1052756262319694,0.08082749177296544,-1.143235784573605,1.877895408373895,-0.1463330696769127,-3.36129265503024,0.1635674020957516,2.59826645741055,1.064618329050703,1.63395426134948,-0.3578658887882511,0.4338863213074036,0.2580238455243458,2.033456451384129,-2.17777483557387,-4.533626535717506,1.798710024072502,0.9192837574150705,1.796529228925366,0.1995875934000974,0.5449397430473759,-1.140422354604544,2.764269292530923,0.137599135977775,-1.754066109321857,7.328444953510547,2.209901327882842,-2.463524753669153,3.601797624866719,2.818171844742145,-2.906651839597881,0.3455892922165004,0.3017427055787062,3.274024957103892,-1.176501115131182,2.039309761245833,-0.6842968084739037,-2.631080717026422,2.545423261057701,0.02596768350926504,-2.399865716312227,-2.963071759029399,-0.4290625158485866,-0.4714668237628366,3.259456288828393,-0.03800798337131672,-0.9604242446011222,-2.604665235419168,1.46895622042987,-0.3745388283516713,-3.561486462434828,-3.48914024393546,-0.6157414164970639,-1.414113290922892,3.708801133518364,2.82356188014572,1.542280475095612,-0.3524006177713995,-0.1177853414294131,1.417999633149712,-5.916327470812417,-0.1873175730268318,1.742110168455014,1.035932895958917,-4.595987478017038,-2.935087175506671,-3.226775930283859,-2.48120988139229,-3.487424862600101,0.01791885103006172,0.6364103141547282,-0.9543760377503409,1.493438797541128,1.659604488951045,1.657608102977029,0.6068650825863714,-1.144924148756814,-5.301177864083281,-0.909183882656911,-0.3594419835951433,6.860903982420256,1.196966653603613,2.791330559395387,0.2583701107322673,-0.5041837585734763,3.544329422767248,0.3475605248652922,-1.560026603186496,0.9511767790574072,-2.719119432209404,0.6477172009073097,0.6559900782359015,-1.256447837628645,-1.268652795803379,0.09883457945087351,-3.556535762699898,2.223702758277789,0.1313255801640321,-1.885183391550043,-0.9751023526981983,0.1015705060400915,3.323197014043728,0.1032023034328928,-1.269501307071999,2.985118261068815,1.198209496972475,-2.138123753510253,-0.4423218840613672,4.119249098190343,1.723884008051111,0.2898406611384996,2.938941369717092,-3.463407260712228,-1.141155663755585,0.4589154071260153,0.01783302142038301,1.563594579467525,-1.792150969634715,0.4857432807268028,-7.460368968075085,-2.479509679591451,-1.667426497273467,0.9564419962124948,-1.626850346369413,1.955362260640182,-3.068328038994039,-0.8857938850621132,0.7884885673097689,2.190783664645164,2.090295549663988,0.8550264802277212,0.6272367325144876,0.5231902378111072,1.549389875909402,-1.077315263989286,-3.847695589648752,4.333066699126756,-0.5972031473527966,0.01152749476934867,-1.562890502041849,3.16299999448582,-2.547083847913713,2.295142871628837,-3.744352896128443,4.807367311494303,3.659178433985341,1.044329146646466,-0.01420330019392058,-1.401593021690524,-0.2100691323613934,3.015797957940365,1.979602965147095,-0.6317689299909116,-1.485347976199026,1.958119439445825,2.356454370496243,0.7024682246060391,-1.907301606409609,-2.055051028122465,-0.0307920825953083,2.009609441090047,-1.88606622087339,-0.3885948213344996,0.7873945907118112,0.845958345919076,2.16745910264873,1.045593896925427,-2.627483264978698,-3.483187065962404,-1.949327991757316,1.509159668120487,-0.5329105809078907,0.5014403120874869,5.512130411597626,-2.282127465421594,-2.015097930351653,-0.5742671698861977,2.201601699057611,1.763368266660979,3.340138446577023,0.8019302224256976,-1.131495066366587,2.341678045485436,0.7446100375165929,1.963279867367961,3.539075709040186,3.848673823529128,-0.1836167566150939,-2.664358243463676,1.296768183928707,-0.7532942758606553,0.8544516999910184,3.419797990600912,0.2119696998019254,-2.323635581782164,1.933558655041348,-0.911440545284104,6.471628712341669,1.937543331070949,-0.8995267312154354,-1.273526381605469,0.9916115820804051,4.734992559984993,0.01207724962169743,-2.04409103508971,2.364492337856793,-1.0455610184679,-2.778561682358832,2.3896557902868,-1.157420688289386,-0.5195590127440282,-0.9942165013731723,2.629061703416724,1.5054516755433,-2.238801212629825,-3.189001263108135,7.045289228445972,-2.088269429951938,-2.241849260494532,-0.6830790229593459,1.953324726822599,-4.555010104728679,0.04316829879953832,-1.048306542580591,-1.501571058375227,2.722987405287786,-0.848894295781968]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>L1<\/th>\n      <th>A1<\/th>\n      <th>L2<\/th>\n      <th>A2<\/th>\n      <th>Y<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"searching":false,"lengthChange":false,"ordering":false,"info":false,"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":0,"visible":false},{"className":"dt-left","targets":"_all"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"L1","targets":1},{"name":"A1","targets":2},{"name":"L2","targets":3},{"name":"A2","targets":4},{"name":"Y","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<p><br>
We can compute the identification formula in the following steps:</p>
<ol type="1">
<li><p>Set <span class="math inline">\(\m_3(A_3^\dd, H_3) = Y\)</span></p>
<div id="qwebr-insertion-location-2"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Compute the regression of <span class="math inline">\(\m_3(A_3^\dd, H_3)\)</span> on <span class="math inline">\((A_2, H_2)\)</span>. This gives a predictive function, call that predictive function <span class="math inline">\(\m_2(A_2,H_2)\)</span>.</p>
<div id="qwebr-insertion-location-3"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Use the predictive function to compute what would have occurred if the intervention had been implemented at time <span class="math inline">\(t=2\)</span>, i.e., compute <span class="math inline">\(\m_2(A_2^\dd,H_2)\)</span>.</p>
<div id="qwebr-insertion-location-4"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Compute the regression of <span class="math inline">\(\m_2(A_2^\dd,H_2)\)</span> on <span class="math inline">\((A_1, H_1)\)</span>. This gives a predictive function, call that predictive function <span class="math inline">\(\m_1(A_1,H_1)\)</span>.</p>
<div id="qwebr-insertion-location-5"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Use the predictive function to compute what would have occurred if the intervention had been implemented at time <span class="math inline">\(t=1\)</span>, i.e., compute <span class="math inline">\(\m_1(A_1^\dd,H_1)\)</span>.</p>
<div id="qwebr-insertion-location-6"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
<li><p>Compute the mean of <span class="math inline">\(\m_1(A_1^\dd,H_1)\)</span>. This mean is equal to <span class="math inline">\(\theta\)</span>.</p>
<div id="qwebr-insertion-location-7"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript></li>
</ol>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-diaz2024causal" class="csl-entry" role="listitem">
DÄ±Ìaz, IvÃ¡n, Katherine L Hoffman, and Nima S Hejazi. 2024. <span>â€œCausal Survival Analysis Under Competing Risks Using Longitudinal Modified Treatment Policies.â€</span> <em>Lifetime Data Analysis</em> 30 (1): 213â€“36.
</div>
<div id="ref-diaz2023nonparametric" class="csl-entry" role="listitem">
DÄ±Ìaz, IvÃ¡n, Nicholas Williams, Katherine L Hoffman, and Edward J Schenck. 2023. <span>â€œNonparametric Causal Effects Based on Longitudinal Modified Treatment Policies.â€</span> <em>Journal of the American Statistical Association</em> 118 (542): 846â€“57.
</div>
<div id="ref-haneuse2013estimation" class="csl-entry" role="listitem">
Haneuse, Sebastian, and Andrea Rotnitzky. 2013. <span>â€œEstimation of the Effect of Interventions That Modify the Received Treatment.â€</span> <em>Statistics in Medicine</em> 32 (30): 5260â€“77.
</div>
<div id="ref-kennedy2019nonparametric" class="csl-entry" role="listitem">
Kennedy, Edward H. 2019. <span>â€œNonparametric Causal Effects Based on Incremental Propensity Score Interventions.â€</span> <em>Journal of the American Statistical Association</em> 114 (526): 645â€“56.
</div>
<div id="ref-nugent2023demonstration" class="csl-entry" role="listitem">
Nugent, Joshua R, and Laura B Balzer. 2023. <span>â€œA Demonstration of Modified Treatment Policies to Evaluate Shifts in Mobility and COVID-19 Case Rates in US Counties.â€</span> <em>American Journal of Epidemiology</em> 192 (5): 762â€“71.
</div>
<div id="ref-rudolph2022effects" class="csl-entry" role="listitem">
Rudolph, Kara E, Catherine Gimbrone, Ellicott C Matthay, Ivan Diaz, Corey S Davis, Katherine Keyes, and Magdalena CerdÃ¡. 2022. <span>â€œWhen Effects Cannot Be Estimated: Redefining Estimands to Understand the Effects of Naloxone Access Laws.â€</span> <em>Epidemiology</em> 33 (5): 689â€“98.
</div>
<div id="ref-rudolph2022buprenorphine" class="csl-entry" role="listitem">
Rudolph, Kara E, Nicholas T Williams, Alicia T Singham Goodwin, Matisyahu Shulman, Marc Fishman, IvÃ¡n DÄ±Ìaz, Sean Luo, John Rotrosen, and Edward V Nunes. 2022. <span>â€œBuprenorphine &amp; Methadone Dosing Strategies to Reduce Risk of Relapse in the Treatment of Opioid Use Disorder.â€</span> <em>Drug and Alcohol Dependence</em> 239: 109609.
</div>
<div id="ref-wen2023intervention" class="csl-entry" role="listitem">
Wen, Lan, Julia L Marcus, and Jessica G Young. 2023. <span>â€œIntervention Treatment Distributions That Depend on the Observed Treatment Process and Model Double Robustness in Causal Survival Analysis.â€</span> <em>Statistical Methods in Medical Research</em> 32 (3): 509â€“23.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script type="module">
// Handle cell initialization initialization
qwebrCellDetails.map(
  (entry) => {
    // Handle the creation of the element
    qwebrCreateHTMLElement(entry);
    // In the event of interactive, initialize the monaco editor
    if (entry.options.context == EvalTypes.Interactive) {
      qwebrCreateMonacoEditorInstance(entry);
    }
  }
);

// Identify non-interactive cells (in order)
const filteredEntries = qwebrCellDetails.filter(entry => {
  const contextOption = entry.options && entry.options.context;
  return ['output', 'setup'].includes(contextOption) || (contextOption == "interactive" && entry.options && entry.options.autorun === 'true');
});

// Condition non-interactive cells to only be run after webR finishes its initialization.
qwebrInstance.then(
  async () => {
    const nHiddenCells = filteredEntries.length;
    var currentHiddenCell = 0;


    // Modify button state
    qwebrSetInteractiveButtonState(`ðŸŸ¡ Running hidden code cells ...`, false);

    // Begin processing non-interactive sections
    // Due to the iteration policy, we must use a for() loop.
    // Otherwise, we would need to switch to using reduce with an empty
    // starting promise
    for (const entry of filteredEntries) {

      // Determine cell being examined
      currentHiddenCell = currentHiddenCell + 1;
      const formattedMessage = `Evaluating hidden cell ${currentHiddenCell} out of ${nHiddenCells}`;

      // Update the document status header
      if (qwebrShowStartupMessage) {
        qwebrUpdateStatusHeader(formattedMessage);
      }

      // Display the update in non-active areas
      qwebrUpdateStatusMessage(formattedMessage);

      // Extract details on the active cell
      const evalType = entry.options.context;
      const cellCode = entry.code;
      const qwebrCounter = entry.id;

      if (['output', 'setup'].includes(evalType)) {
        // Disable further global status updates
        const activeContainer = document.getElementById(`qwebr-non-interactive-loading-container-${qwebrCounter}`);
        activeContainer.classList.remove('qwebr-cell-needs-evaluation');
        activeContainer.classList.add('qwebr-cell-evaluated');

        // Update status on the code cell
        const activeStatus = document.getElementById(`qwebr-status-text-${qwebrCounter}`);
        activeStatus.innerText = " Evaluating hidden code cell...";
        activeStatus.classList.remove('qwebr-cell-needs-evaluation');
        activeStatus.classList.add('qwebr-cell-evaluated');
      }

      switch (evalType) {
        case 'interactive':
          // TODO: Make this more standardized.
          // At the moment, we're overriding the interactive status update by pretending its
          // output-like. 
          const tempOptions = entry.options;
          tempOptions["context"] = "output"
          // Run the code in a non-interactive state that is geared to displaying output
          await qwebrExecuteCode(`${cellCode}`, qwebrCounter, tempOptions);
          break;
        case 'output':
          // Run the code in a non-interactive state that is geared to displaying output
          await qwebrExecuteCode(`${cellCode}`, qwebrCounter, entry.options);
          break;
        case 'setup':
          const activeDiv = document.getElementById(`qwebr-noninteractive-setup-area-${qwebrCounter}`);
          // Run the code in a non-interactive state with all output thrown away
          await mainWebR.evalRVoid(`${cellCode}`);
          break;
        default: 
          break; 
      }

      if (['output', 'setup'].includes(evalType)) {
        // Disable further global status updates
        const activeContainer = document.getElementById(`qwebr-non-interactive-loading-container-${qwebrCounter}`);
        // Disable visibility
        activeContainer.style.visibility = 'hidden';
        activeContainer.style.display = 'none';
      }
    }
  }
).then(
  () => {
    // Release document status as ready

    if (qwebrShowStartupMessage) {
      qwebrStartupMessage.innerText = "ðŸŸ¢ Ready!"
    }
  
    qwebrSetInteractiveButtonState(
      `<i class="fa-solid fa-play qwebr-icon-run-code"></i> <span>Run Code</span>`, 
      true
    );  
  }
);
</script>




</body></html>